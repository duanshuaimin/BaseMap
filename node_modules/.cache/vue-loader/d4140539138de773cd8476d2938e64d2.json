{"remainingRequest":"/Users/liangma/Desktop/workspace/BaseMap/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/liangma/Desktop/workspace/BaseMap/src/components/editor.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/liangma/Desktop/workspace/BaseMap/src/components/editor.vue","mtime":1589207515771},{"path":"/Users/liangma/Desktop/workspace/BaseMap/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/liangma/Desktop/workspace/BaseMap/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/liangma/Desktop/workspace/BaseMap/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/liangma/Desktop/workspace/BaseMap/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/liangma/Desktop/workspace/BaseMap/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBFZGl0b3JDb21wcyBmcm9tICcuL2VkaXRvci1jb21wcyc7CmltcG9ydCBFZGl0b3JDYW52YXMgZnJvbSAnLi9lZGl0b3ItY2FudmFzJzsKaW1wb3J0IEVkaXRvclNldHRpbmdzIGZyb20gJy4vZWRpdG9yLXNldHRpbmdzJzsKaW1wb3J0IEVkaXRvckhlbHAgZnJvbSAnLi9lZGl0b3ItaGVscCc7CmltcG9ydCBFZGl0b3JIaXN0b3J5IGZyb20gJy4vZWRpdG9yLWhpc3RvcnknOwppbXBvcnQgXyBmcm9tICdsb2Rhc2gnOyAgCgpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogJ0VkaXRvcicsCiAgY3JlYXRlZDpmdW5jdGlvbigpIHsKICAgIHRoaXMuaW5pdFN0b3JhZ2VEYXRhKCk7CiAgICB0aGlzLmluaXRCaW5kaW5nRXZlbnQoKTsKICB9LAogIGRhdGEoKXsKICAgICByZXR1cm4gewogICAgICAgIGVTdGF0ZXM6ewogICAgICAgICAgY3VycmVudEFjdGl2ZUluZGV4Oi0xLAogICAgICAgICAgY29weUJ5S2V5Qm9vbDpmYWxzZSwKICAgICAgICAgIG11bHRpcGxlQWN0aXZlQXJyOltdLAogICAgICAgIH0sCiAgICAgICAgZWRyYXdDb21wb25lbnRzOltdLAogICAgICAgIGNvbmZpZ3M6ewogICAgICAgICAgYmc6ImdyaWQiLAogICAgICAgICAgcGFnZU5hbWU6J+W6leWbvicsCiAgICAgICAgICBzcGFjaW5nOjEwLAogICAgICAgICAgc2NhbGU6MSwKICAgICAgICAgIElzb21ldHJpY19yb3c6MTAsCiAgICAgICAgICBJc29tZXRyaWNfY29sdToxMCwKICAgICAgICAgIGRvd2xvYWRJbWdUeXBlOidwbmcnLAogICAgICAgICAgYmdBbGxCb29sOmZhbHNlLAogICAgICAgICAgd2luZG93X3c6MTkyMCwKICAgICAgICAgIHdpbmRvd19oOjkwMCwKICAgICAgICAgIGJhY2tncm91bmRVcmw6IiIKICAgICAgICB9LAogICAgICAgIGhpc3RvcnlDdXJybmV0RGF0YTpbXSwKICAgICAgICBjdXJyZW50SGlzdG9yeUluZGV4Oi0xLAogICAgICAgIGFjdGl2ZUhpc3RvcnlCb29sOmZhbHNlCiAgICAgfQogIH0sCiAgY29tcG9uZW50czogewogICAgJ2VkaXRvci1jb21wcyc6RWRpdG9yQ29tcHMsCiAgICAnZWRpdG9yLWNhbnZhcyc6RWRpdG9yQ2FudmFzLAogICAgJ2VkaXRvci1zZXR0aW5ncyc6RWRpdG9yU2V0dGluZ3MsCiAgICAnZWRpdG9yLWhlbHAnOkVkaXRvckhlbHAsCiAgICAnZWRpdG9yLWhpc3RvcnknOkVkaXRvckhpc3RvcnkKICB9LAogIG1ldGhvZHM6IHsKICAgIGluaXREYXRhKCkgewogICAgICB0aGlzLmFjdGl2ZUhpc3RvcnlCb29sID0gZmFsc2U7CiAgICB9LAogICAgaW5pdEJpbmRpbmdFdmVudCgpIHsKICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIHRoaXMua2F5ZG93bkZ1biwgZmFsc2UpOwogICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCB0aGlzLm1vdXNlZG93bkZ1bik7CiAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdiZWZvcmV1bmxvYWQnLCB0aGlzLmxlYXZpbmcpOwogICAgfSwKICAgIGxlYXZpbmcoZXZlbnQpIHsKICAgICAgdGhpcy5zYXZlRGF0ZVRvU3RvcmFnZSgpOwogICAgICBjb25zb2xlLmxvZyhldmVudC5yZXR1cm5WYWx1ZSkKICAgICAgLy8gbGV0IG1lc3NhZ2UgPSAi5YaF5a655pu05pS577yM5rOo5oSP5oiq5Zu+57yT5a2YIjsgCiAgICAgIC8vIGV2ZW50LnJldHVyblZhbHVlID0gbWVzc2FnZTsKICAgICAgLy8gcmV0dXJuIG1lc3NhZ2U7CiAgICB9LAogICAgZG93bmxvYWQ6ZnVuY3Rpb24oKSB7CiAgICAgIC8vVE9ETzrpobXpnaLkuIvovb0KICAgIH0sCiAgICBzYXZlQXM6ZnVuY3Rpb24oaW1nKSB7CiAgICAgIGxldCBfZG9tID0gd2luZG93LmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTsKICAgICAgICBfZG9tLmhyZWYgPSBpbWcKICAgICAgICBfZG9tLmRhdGFzZXQuZG93bmxvYWR1cmwgPSBbJ2ltYWdlL3BuZycsICdJTUdfRE9XTkxPQURfTkFNRScsIF9kb20uaHJlZl0uam9pbignOicpOwogICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoX2RvbSk7CiAgICAgICAgX2RvbS5jbGljaygpOwogICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoX2RvbSk7CiAgICB9LAogICAgLy8g57uE5Lu26YCJ5oupCiAgICBzZWxlY3RDb21wKGV2ZW50LCBjb21wKSB7CiAgICAgIGxldCBpdGVtID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShjb21wKSk7CiAgICAgIGlmKCFpdGVtKSByZXR1cm47CiAgICAgIHRoaXMuaW5pdENvbXBTdGF0ZSgpOwogICAgICBpdGVtLmlzQWN0aXZlID0gdHJ1ZTsKICAgICAgaXRlbS5tdWx0aXBsZUFjdGl2ZUJvb2w9ZmFsc2U7CiAgICAgIGxldCByZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbnZhcycpLmdldENsaWVudFJlY3RzKClbMF07CiAgICAgIGxldCB7d2lkdGgsIGhlaWdodCwgYm9yZGVyUmFkaXVzLCByb3RhdGUsIGJvcmRlcldpZHRoLCBiYWNrZ3JvdW5kfSA9IGl0ZW0uZGVmU3R5bGU7CiAgICAgIGxldCB7Y2xpZW50WCAsIGNsaWVudFl9ID0gZXZlbnQ7CiAgICAgIGxldCBfc3R5bGUgPSB7CiAgICAgICAgICB3aWR0aDp3aWR0aCB8fCAxMDAsCiAgICAgICAgICBoZWlnaHQ6aGVpZ2h0IHx8IDEwMCwKICAgICAgICAgIHRvcDogY2xpZW50WSAgLSByZWN0LnRvcCArIDYwIHx8IDEwMCwKICAgICAgICAgIGxlZnQ6Y2xpZW50WCArIDIxMyAtIHJlY3QubGVmdCB8fCAxMDAsCiAgICAgICAgICByb3RhdGU6IHJvdGF0ZSB8fCAwLAogICAgICAgICAgZHJhZ19zdGFydF94OiAwLCAvL+aLluaLveebuOWvuQogICAgICAgICAgZHJhZ19zdGFydF95IDowLAogICAgICAgICAgYm9yZGVyV2lkdGg6Ym9yZGVyV2lkdGggfHwgMCwKICAgICAgICAgIGJhY2tncm91bmQ6YmFja2dyb3VuZCwKICAgICAgICAgIHBvc2l0aW9uOidhYnNvbHV0ZScsCiAgICAgICAgICBpc0FwcGx5U2hhZG93Oid0cnVlJywKICAgICAgICAgIGlzRml4ZWQ6ImZhbHNlIiwKICAgICAgICAgIGJvcmRlclJhZGl1czpib3JkZXJSYWRpdXMgfHwgMAogICAgICB9CiAgICAgIGl0ZW0uc3R5bGUgPSBfc3R5bGU7CiAgICAgIHRoaXMuZWRyYXdDb21wb25lbnRzLnB1c2goaXRlbSk7CiAgICAgIHRoaXMuZVN0YXRlcy5jdXJyZW50QWN0aXZlSW5kZXggPSB0aGlzLmVkcmF3Q29tcG9uZW50cy5sZW5ndGggLTE7CiAgICB9LAogICAgaW5pdENvbXBvbmVudFN0YXRlKGN1cnJlbnQsIGV2ZW50KSB7CiAgICAgIGlmKGN1cnJlbnQgPT09IHVuZGVmaW5lZCB8fCBjdXJyZW50ID09PSBudWxsIHx8IGN1cnJlbnQgPT09IC0xKSByZXR1cm47CiAgICAgIGlmKGV2ZW50ICYmIChldmVudC5jdHJsS2V5IHx8IGV2ZW50Lm1ldGFLZXkgJiYgdGhpcy5pc01hYygpKSAmJiBldmVudC5idXR0b24gPT09IDAgKSB7CiAgICAgICAgdGhpcy5lZHJhd0NvbXBvbmVudHNbY3VycmVudF0uaXNBY3RpdmUgPSBmYWxzZTsKICAgICAgICBpZih0aGlzLmVTdGF0ZXMuY3VycmVudEFjdGl2ZUluZGV4ID4gLTEpIHsKICAgICAgICAgIHRoaXMuZVN0YXRlcy5jdXJyZW50QWN0aXZlSW5kZXggPSAtMTsKICAgICAgICB9CgogICAgICAgIC8vIOWkmumAieaTjeS9nOe8k+WtmOaVsOe7hAogICAgICAgIGNvbnN0IF9tdWx0aXBBY3RpdmVJbmRleCA9IHRoaXMuZVN0YXRlcy5tdWx0aXBsZUFjdGl2ZUFyci5pbmRleE9mKHRoaXMuZWRyYXdDb21wb25lbnRzW2N1cnJlbnRdKTsKICAgICAgICBpZiggX211bHRpcEFjdGl2ZUluZGV4ID09PSAtMSkgewogICAgICAgICAgdGhpcy5lU3RhdGVzLm11bHRpcGxlQWN0aXZlQXJyLnB1c2godGhpcy5lZHJhd0NvbXBvbmVudHNbY3VycmVudF0pCiAgICAgICAgfQoKICAgICAgICBpZih0aGlzLmVkcmF3Q29tcG9uZW50c1tjdXJyZW50XS5tdWx0aXBsZUFjdGl2ZUJvb2wpIHsKICAgICAgICAgIHRoaXMuZWRyYXdDb21wb25lbnRzW2N1cnJlbnRdLm11bHRpcGxlQWN0aXZlQm9vbCA9IGZhbHNlOwogICAgICAgICAgdGhpcy5lU3RhdGVzLm11bHRpcGxlQWN0aXZlQXJyLnNwbGljZShfbXVsdGlwQWN0aXZlSW5kZXgsIDEpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLmVkcmF3Q29tcG9uZW50c1tjdXJyZW50XS5tdWx0aXBsZUFjdGl2ZUJvb2wgPSB0cnVlOwogICAgICAgIH0KICAgICAgfWVsc2UgewogICAgICAgIHRoaXMuaW5pdENvbXBTdGF0ZSgpOyAgICAgCiAgICAgICAgdGhpcy5lU3RhdGVzLmN1cnJlbnRBY3RpdmVJbmRleCA9IGN1cnJlbnQ7CiAgICAgICAgdGhpcy5lZHJhd0NvbXBvbmVudHNbY3VycmVudF0uaXNBY3RpdmUgPSB0cnVlOwogICAgICB9CgogICAgfSwKICAgIC8vIOWIneWni+WMlueUu+W4g+WGhee7hOS7tueKtuaAgQogICAgaW5pdENvbXBTdGF0ZSgpIHsKICAgICAgbGV0IGxlbiA9IHRoaXMuZWRyYXdDb21wb25lbnRzLmxlbmd0aDsKICAgICAgdGhpcy5lU3RhdGVzLm11bHRpcGxlQWN0aXZlQXJyID0gW107CiAgICAgIGZvcihsZXQgaT0wO2k8bGVuO2krKykgewogICAgICAgIHRoaXMuZWRyYXdDb21wb25lbnRzW2ldLmlzQWN0aXZlID0gZmFsc2U7CiAgICAgICAgdGhpcy5lZHJhd0NvbXBvbmVudHNbaV0ubXVsdGlwbGVBY3RpdmVCb29sID0gZmFsc2U7CiAgICAgIH0KICAgICAgdGhpcy5lU3RhdGVzLmNvcHlCeUtleUJvb2wgPSBmYWxzZTsKICAgIH0sCiAgICAvLyDnu4Tku7bmi5bmi73vvJpjdHJsa2V5ID09PSB0cnVlIOWkhOeQhuWkmumAiQogICAgZHJhZ0N1cnJlbnRDb21wKGV2ZW50LCBjb21wLCBzdGF0ZSwgY3VycmVudEluZGV4LCBjYW52ZXNSZWN0KSB7CiAgICAgIGlmKGV2ZW50ICYmIChldmVudC5jdHJsS2V5IHx8IGV2ZW50Lm1ldGFLZXkgJiYgdGhpcy5pc01hYygpKSAgKXsKICAgICAgICBjb25zb2xlLmxvZygn5aSa6YCJ5aSE55CGJykKICAgICAgfSBlbHNlIHsgCiAgICAgICAgdGhpcy5lU3RhdGVzLmNvcHlCeUtleUJvb2wgPSBmYWxzZTsKICAgICAgICBsZXQgX3JlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FudmFzJykuZ2V0Q2xpZW50UmVjdHMoKVswXQogICAgICAgIGxldCBfbCA9X3JlY3QubGVmdDsKICAgICAgICBsZXQgX3QgPV9yZWN0LmxlZnQ7CiAgICAgICAgaWYoc3RhdGUgPT09ICdzdGFydCcpIHsKICAgICAgICAgIHRoaXMuZVN0YXRlcy5jdXJyZW50QWN0aXZlSW5kZXggPSBjdXJyZW50SW5kZXg7CiAgICAgICAgICBjb21wLnN0eWxlLmRyYWdfc3RhcnRfeCA9IGV2ZW50LmNsaWVudFggLSBjb21wLnN0eWxlLmxlZnQgLSBfbCArIGNhbnZlc1JlY3QueDsKICAgICAgICAgIGNvbXAuc3R5bGUuZHJhZ19zdGFydF95ID0gZXZlbnQuY2xpZW50WSAtIGNvbXAuc3R5bGUudG9wIC0gX3QgKyBjYW52ZXNSZWN0Lnk7CiAgICAgICAgfWVsc2UgaWYoc3RhdGUgPT09ICdkcmFnJyl7CiAgICAgICAgICBsZXQgX2xlZnQgPSBldmVudC5jbGllbnRYIC0gY29tcC5zdHlsZS5kcmFnX3N0YXJ0X3ggIC0gX2wgKyBjYW52ZXNSZWN0Lng7IAogICAgICAgICAgbGV0IF90b3AgPSBldmVudC5jbGllbnRZIC0gY29tcC5zdHlsZS5kcmFnX3N0YXJ0X3kgLSBfdCArIGNhbnZlc1JlY3QueSA7CiAgICAgICAgICBpZihfbGVmdCA8MCB8fCBfdG9wIDwgMCkgcmV0dXJuOwogICAgICAgICAgY29tcC5zdHlsZS5sZWZ0ID0gX2xlZnQ7CiAgICAgICAgICBjb21wLnN0eWxlLnRvcCA9IF90b3AgOwogICAgICAgIH0KICAgICAgICB2YXIgZHJhZ0ljb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTsKICAgICAgICBkcmFnSWNvbi5zcmMgPSAnZGF0YTppbWFnZS9naWY7YmFzZTY0LFIwbEdPRGxoQVFBQkFJQUFBQUFBQVAvLy95SDVCQUVBQUFBQUxBQUFBQUFCQUFFQUFBSUJSQUE3JywKICAgICAgICBkcmFnSWNvbi53aWR0aCA9IDA7CiAgICAgICAgZHJhZ0ljb24uaGVpZ2h0ID0gMDsKICAgICAgICBkcmFnSWNvbi5vcGFjaXR5ID0gMDsKICAgICAgICBldmVudC5kYXRhVHJhbnNmZXIuc2V0RHJhZ0ltYWdlKGRyYWdJY29uLDAsIDApOwogICAgICB9CiAgICB9LAogICAgcmVzaXplQnlEcmFnQ29tcChldmVudCwgY29tcCwgc3RhdGUsIGFycm93LGN1cnJlbnRJbmRleCkgewogICAgICBpZihldmVudCAmJiAoZXZlbnQuY3RybEtleSB8fCBldmVudC5tZXRhS2V5ICYmIHRoaXMuaXNNYWMoKSkgICl7CiAgICAgICAgY29uc29sZS5sb2coJ+WkmumAieWkhOeQhicpCiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5lU3RhdGVzLmNvcHlCeUtleUJvb2wgPSBmYWxzZTsKICAgICAgICBsZXQgX2wgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FudmFzJykuZ2V0Q2xpZW50UmVjdHMoKVswXS5sZWZ0OwogICAgICAgIGxldCBfdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW52YXMnKS5nZXRDbGllbnRSZWN0cygpWzBdLnRvcDsKICAgICAgICBpZihzdGF0ZSA9PT0gJ3N0YXJ0JykgewogICAgICAgICAgdGhpcy5lU3RhdGVzLmN1cnJlbnRBY3RpdmVJbmRleCA9IGN1cnJlbnRJbmRleDsKICAgICAgICAgIGNvbXAuc3R5bGUuZHJhZ19zdGFydF94ID0gYXJyb3cgPT09ICdyJyA/IGNvbXAuc3R5bGUubGVmdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJyb3cgPT09ICdsJyA/Y29tcC5zdHlsZS5sZWZ0ICsgY29tcC5zdHlsZS53aWR0aCArIF9sIC0gMjEzIDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMTA7CiAgICAgICAgICBjb21wLnN0eWxlLmRyYWdfc3RhcnRfeSA9IGFycm93ID09PSAnYicgPyBjb21wLnN0eWxlLnRvcCAgOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcnJvdyA9PT0gJ3QnID9jb21wLnN0eWxlLnRvcCArIGNvbXAuc3R5bGUuaGVpZ2h0ICA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEwOwogICAgICAgIH1lbHNlIGlmKHN0YXRlID09PSAnZHJhZycpewogICAgICAgICAgbGV0IF93aWR0aCA9IDA7CiAgICAgICAgICBsZXQgX3RvcCA9IDA7CiAgICAgICAgICBsZXQgX2hlaWdodCA9IDA7CiAgICAgCiAgICAgICAgICBzd2l0Y2goYXJyb3cpIHsKICAgICAgICAgICAgY2FzZSAncic6CiAgICAgICAgICAgICAgX3dpZHRoID0gZXZlbnQuY2xpZW50WCAtIGNvbXAuc3R5bGUuZHJhZ19zdGFydF94ICsgMjEzIC0gX2wgOyAKICAgICAgICAgICAgICBjb21wLnN0eWxlLndpZHRoID0gX3dpZHRoID49IDEwID8gX3dpZHRoOiAxMDsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAnbCc6CiAgICAgICAgICAgICAgY29tcC5zdHlsZS5sZWZ0ID0gZXZlbnQuY2xpZW50WCAgKyAyMTMgLSBfbDsgCiAgICAgICAgICAgICAgX3dpZHRoID0gY29tcC5zdHlsZS5kcmFnX3N0YXJ0X3ggLSBldmVudC5jbGllbnRYOwogICAgICAgICAgICAgIGNvbXAuc3R5bGUud2lkdGggPSBfd2lkdGggPj0gMTAgPyBfd2lkdGg6IDEwOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICd0JzoKICAgICAgICAgICAgICBjb25zb2xlLmxvZyhfdCwgNjApCiAgICAgICAgICAgICAgY29tcC5zdHlsZS50b3AgPSBldmVudC5jbGllbnRZOwogICAgICAgICAgICAgIF9oZWlnaHQgPSBjb21wLnN0eWxlLmRyYWdfc3RhcnRfeSAtIGV2ZW50LmNsaWVudFkgCiAgICAgICAgICAgICAgY29tcC5zdHlsZS5oZWlnaHQgPSBfaGVpZ2h0ID49IDEwID8gX2hlaWdodCA6IDEwOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdiJzoKICAgICAgICAgICAgICBfdG9wID0gX3QgPj0wID8gKGV2ZW50LmNsaWVudFkgLSBjb21wLnN0eWxlLmRyYWdfc3RhcnRfeSkgOmV2ZW50LmNsaWVudFkgLSBjb21wLnN0eWxlLmRyYWdfc3RhcnRfeSAtIF90ICArIDYwOwogICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJ0ID09PiAiLF90LCBfdG9wLCBjb21wLnN0eWxlLmRyYWdfc3RhcnRfeSkKICAgICAgICAgICAgICBjb21wLnN0eWxlLmhlaWdodCA9IF90b3AgPj0gMTAgPyBfdG9wOiAxMDsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICBicmVhawogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIHRyYW5zQ29tcChldmVudCwgY29tcCl7CiAgICAgICAgbGV0IF94ID0gZXZlbnQuY2xpZW50WCAtIGNvbXAuc3R5bGUubGVmdCAtIGNvbXAuc3R5bGUud2lkdGggLyAyOwogICAgICAgIGxldCBfeSA9IGV2ZW50LmNsaWVudFkgLSBjb21wLnN0eWxlLnRvcCAtIGNvbXAuc3R5bGUuaGVpZ2h0IC8gMjsKICAgICAgICBjb21wLnN0eWxlLnJvdGF0ZSA9IHRoaXMuY2FsY0FuZ2xlRGVncmVlcyhfeCwgX3kpOwogICAgfSwKICAgIC8vIOe7hOS7tuWIoOmZpAogICAgZGVsQ29tcChpbmRleCwgc3RhdGUpIHsKICAgICAgaWYoc3RhdGUgPT09ICdtdWx0aXBsZURlbCcpIHsKICAgICAgICBsZXQgbGVuID0gdGhpcy5lZHJhd0NvbXBvbmVudHMubGVuZ3RoOwogICAgICAgIHRoaXMuZVN0YXRlcy5tdWx0aXBsZUFjdGl2ZUFyciA9IFtdOwogICAgICAgIGZvcihsZXQgaT1sZW47aS0tO2kgPjApIHsKICAgICAgICAgIGxldCBtdWx0aXBCb29sID0gdGhpcy5lZHJhd0NvbXBvbmVudHNbaV0ubXVsdGlwbGVBY3RpdmVCb29sOwogICAgICAgICAgaWYobXVsdGlwQm9vbCkgewogICAgICAgICAgICB0aGlzLmVkcmF3Q29tcG9uZW50cy5zcGxpY2UoaSwxKQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBpZih0aGlzLmVTdGF0ZXMuY3VycmVudEFjdGl2ZUluZGV4ID4gLTEgJiZ0aGlzLmVkcmF3Q29tcG9uZW50cy5sZW5ndGggPiAwKSB7CiAgICAgICAgICB0aGlzLmVkcmF3Q29tcG9uZW50cy5zcGxpY2UodGhpcy5lU3RhdGVzLmN1cnJlbnRBY3RpdmVJbmRleCwxKQogICAgICAgICAgdGhpcy5lU3RhdGVzLmN1cnJlbnRBY3RpdmVJbmRleCA9IC0xOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIC8vIOmUruebmOS6i+S7tgogICAga2F5ZG93bkZ1bihldmVudCkgewogICAgICBpZihldmVudC5rZXkgPT09ICdjJykgewogICAgICAgIHRoaXMuZVN0YXRlcy5jb3B5QnlLZXlCb29sID0gdHJ1ZTsKICAgICAgfWVsc2UgaWYodGhpcy5lU3RhdGVzLmNvcHlCeUtleUJvb2wgJiYgZXZlbnQua2V5ID09PSAndicpIHsKICAgICAgICB0aGlzLmNvcHlDdXJyZW50Q29tcCgpOwogICAgICB9ZWxzZSB7CiAgICAgICAgaWYoWydBcnJvd1VwJywnQXJyb3dEb3duJywnQXJyb3dMZWZ0JywiQXJyb3dSaWdodCJdLmluZGV4T2YoZXZlbnRbJ2NvZGUnXSk+IC0xKSB7CiAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgaWYodGhpcy5lU3RhdGVzLmN1cnJlbnRBY3RpdmVJbmRleCA+IC0xICYmIHRoaXMuZVN0YXRlcy5tdWx0aXBsZUFjdGl2ZUFyci5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgdGhpcy5hcnJvd0l0ZW0oZXZlbnRbJ2NvZGUnXSwgdGhpcy5lZHJhd0NvbXBvbmVudHNbdGhpcy5lU3RhdGVzLmN1cnJlbnRBY3RpdmVJbmRleF0pCiAgICAgICAgICB9ZWxzZSBpZih0aGlzLmVTdGF0ZXMubXVsdGlwbGVBY3RpdmVBcnIubGVuZ3RoID4gMCl7CiAgICAgICAgICAgIGxldCBsZW4gPSB0aGlzLmVTdGF0ZXMubXVsdGlwbGVBY3RpdmVBcnIubGVuZ3RoOwogICAgICAgICAgICBmb3IobGV0IGk9MDtpPGxlbjtpKyspewogICAgICAgICAgICAgICB0aGlzLmFycm93SXRlbShldmVudFsnY29kZSddLCB0aGlzLmVTdGF0ZXMubXVsdGlwbGVBY3RpdmVBcnJbaV0pCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgaWYoZXZlbnQua2V5ID09PSAnRGVsZXRlJyB8fCB0aGlzLmlzTWFjKCkgJiYgZXZlbnQua2V5ID09PSAnQmFja3NwYWNlJykgIHsKICAgICAgICB0aGlzLmRlbENvbXAoKTsKICAgICAgfQogICAgfSwKICAgIGFycm93SXRlbShhcnJvdywgb2JqKSB7CiAgICAgIGlmKGFycm93ICYmIG9iaikgewogICAgICAgIHN3aXRjaCAoYXJyb3cpIHsKICAgICAgICAgIGNhc2UgJ0Fycm93VXAnIDoKICAgICAgICAgICAgb2JqLnN0eWxlLnRvcCA9IChvYmouc3R5bGUudG9wIC0gMSkgPiAwID8gKCBvYmouc3R5bGUudG9wIC0gMSkgOiAwOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgJ0Fycm93RG93bicgOgogICAgICAgICAgICBvYmouc3R5bGUudG9wID0gb2JqLnN0eWxlLnRvcCArIDE7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAnQXJyb3dMZWZ0JyA6CiAgICAgICAgICAgIG9iai5zdHlsZS5sZWZ0ID0gKG9iai5zdHlsZS5sZWZ0IC0xICk+IDA/IChvYmouc3R5bGUubGVmdCAtMSkgOiAwOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgJ0Fycm93UmlnaHQnOgogICAgICAgICAgICBvYmouc3R5bGUubGVmdCA9ICBvYmouc3R5bGUubGVmdCArMTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICAvLyDlpJrpgInkuovku7YKICAgIG1vdXNlZG93bkZ1bihldmVudCkgewogICAgICBpZigoIWV2ZW50LmN0cmxLZXkgfHwgIWV2ZW50Lm1ldGFLZXkgJiYgdGhpcy5pc01hYygpKSAmJiBldmVudC5idXR0b24gPT09IDAgCiAgICAgICAgJiYgZXZlbnQudGFyZ2V0LmlkPT09J2NhbnZhcycgCiAgICAgICAgJiYgIWV2ZW50LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2NvbXAtZWxlbWVudCcpKSB7CiAgICAgICAgdGhpcy5lU3RhdGVzLmNvcHlCeUtleUJvb2wgPSBmYWxzZTsKICAgICAgICB0aGlzLmluaXRDb21wU3RhdGUoKTsKICAgICAgfSAKICAgIH0sCiAgICAvLyDliJvlu7rlvZPliY3nu4Tku7YKICAgIGNvcHlDdXJyZW50Q29tcDpmdW5jdGlvbigpIHsKICAgICAgbGV0IF9jdXJyQ29tcCA9IHRoaXMuZWRyYXdDb21wb25lbnRzW3RoaXMuZVN0YXRlcy5jdXJyZW50QWN0aXZlSW5kZXhdOwogICAgICBpZighX2N1cnJDb21wKSByZXR1cm47CiAgICAgIF9jdXJyQ29tcC5pc0FjdGl2ZSA9IGZhbHNlOwogICAgICBsZXQgX2NvcHkgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KF9jdXJyQ29tcCkpOwogICAgICBsZXQgX3N0eWxlID0gX2N1cnJDb21wLnN0eWxlOwogICAgICBsZXQgX2ggPSB0aGlzLmNvbmZpZ3MuSXNvbWV0cmljX2NvbHUgPiAxPyB0aGlzLmNvbmZpZ3MuSXNvbWV0cmljX2NvbHUgOiAxOwogICAgICBfY29weS5zdHlsZS50b3AgPSBfc3R5bGUuaGVpZ2h0ICsgX3N0eWxlLnRvcCArIF9oOwogICAgICBfY29weS5pc0FjdGl2ZSA9IHRydWU7CiAgICAgIHRoaXMuZWRyYXdDb21wb25lbnRzLnB1c2goX2NvcHkpOwogICAgICB0aGlzLmVTdGF0ZXMuY3VycmVudEFjdGl2ZUluZGV4ID0gdGhpcy5lZHJhd0NvbXBvbmVudHMubGVuZ3RoIC0gMTsgLy/mm7TmlrDmv4DmtLvnu4Tku7bnmoTkuIvmoIcKICAgIH0sCiAgICAvLyDlpJrpgInmk43kvZw65Y+N6YCJL+a4heepuuWkmumAiS/lsZ7mgKflupTnlKgKICAgIHNldE11bHRpcGxlU3RhdGU6ZnVuY3Rpb24oc3RhdGUsIHZhbHVlKSB7CiAgICAgIGlmKHN0YXRlID09PSAnSXNvbWV0cmljJykgewogICAgICAgIGZvcihsZXQgaSA9IHRoaXMuZVN0YXRlcy5tdWx0aXBsZUFjdGl2ZUFyci5sZW5ndGgtMTtpPj0wO2ktLSkgewogICAgICAgICAgbGV0IG9iaiA9IHRoaXMuZVN0YXRlcy5tdWx0aXBsZUFjdGl2ZUFycltpXTsKICAgICAgICAgIGxldCBib29sID0gb2JqWydtdWx0aXBsZUFjdGl2ZUJvb2wnXTsKICAgICAgICAgIGlmKCFib29sKSB7CiAgICAgICAgICAgIHRoaXMuZVN0YXRlcy5tdWx0aXBsZUFjdGl2ZUFyci5zcGxpY2UoaSwxKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgbGV0IGxlbiA9IHRoaXMuZVN0YXRlcy5tdWx0aXBsZUFjdGl2ZUFyci5sZW5ndGg7CiAgICAgICAgbGV0IHZhbCA9IDA7CiAgICAgICAgaWYodmFsdWUgPT09ICdyb3cnKSB7CiAgICAgICAgICB0aGlzLmVTdGF0ZXMubXVsdGlwbGVBY3RpdmVBcnIgPSAgdGhpcy5lU3RhdGVzLm11bHRpcGxlQWN0aXZlQXJyLnNvcnQoZnVuY3Rpb24oYSxiKXsKICAgICAgICAgICAgcmV0dXJuIGEuc3R5bGUubGVmdCAtIGIuc3R5bGUubGVmdDsKICAgICAgICAgIH0pCiAgICAgICAgICBmb3IobGV0IGk9MDtpPCBsZW47aSsrKSB7CiAgICAgICAgICAgIGxldCBpdGVtID0gdGhpcy5lU3RhdGVzLm11bHRpcGxlQWN0aXZlQXJyW2ldOwogICAgICAgICAgICBpZihpPjApIHsKICAgICAgICAgICAgICBpdGVtLnN0eWxlLmxlZnQgPSB2YWw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFsID0gaXRlbS5zdHlsZS5sZWZ0ICsgaXRlbS5zdHlsZS53aWR0aCArIHBhcnNlSW50KHRoaXMuY29uZmlncy5Jc29tZXRyaWNfcm93KTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5lU3RhdGVzLm11bHRpcGxlQWN0aXZlQXJyID0gIHRoaXMuZVN0YXRlcy5tdWx0aXBsZUFjdGl2ZUFyci5zb3J0KGZ1bmN0aW9uKGEsYil7CiAgICAgICAgICAgIHJldHVybiBhLnN0eWxlLnRvcCAtIGIuc3R5bGUudG9wIDsKICAgICAgICAgIH0pCiAgICAgICAgICBmb3IobGV0IGk9MDtpPCBsZW47aSsrKSB7CiAgICAgICAgICAgIGxldCBpdGVtID0gdGhpcy5lU3RhdGVzLm11bHRpcGxlQWN0aXZlQXJyW2ldOwogICAgICAgICAgICBpZihpPjApIHsKICAgICAgICAgICAgICBpdGVtLnN0eWxlLnRvcCA9IHZhbDsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YWwgPSBpdGVtLnN0eWxlLmhlaWdodCArIGl0ZW0uc3R5bGUudG9wICsgcGFyc2VJbnQodGhpcy5jb25maWdzLklzb21ldHJpY19jb2x1KTsKICAgICAgICAgIH0KICAgICAgICB9ICAgICAKICAgICAgfWVsc2UgaWYoc3RhdGUgPT09ICdyZVNlbCcpIHsKICAgICAgICBsZXQgbGVuID0gdGhpcy5lZHJhd0NvbXBvbmVudHMubGVuZ3RoOwogICAgICAgIHRoaXMuZVN0YXRlcy5tdWx0aXBsZUFjdGl2ZUFyciA9IFtdOwogICAgICAgIGZvcihsZXQgaT1sZW47aS0tO2kgPjApIHsKICAgICAgICAgIGxldCBpdGVtID0gdGhpcy5lZHJhd0NvbXBvbmVudHNbaV07CiAgICAgICAgICBpZighaXRlbS5tdWx0aXBsZUFjdGl2ZUJvb2wpIHsgIAogICAgICAgICAgICB0aGlzLmVTdGF0ZXMubXVsdGlwbGVBY3RpdmVBcnIucHVzaChpdGVtKTsKICAgICAgICAgIH0KICAgICAgICAgIGl0ZW0ubXVsdGlwbGVBY3RpdmVCb29sID0gIWl0ZW0ubXVsdGlwbGVBY3RpdmVCb29sOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmKHN0YXRlID09PSAnY2xlYXInKXsKICAgICAgICBsZXQgbGVuID0gdGhpcy5lZHJhd0NvbXBvbmVudHMubGVuZ3RoOwogICAgICAgIHRoaXMuZVN0YXRlcy5tdWx0aXBsZUFjdGl2ZUFyciA9IFtdOwogICAgICAgIGZvcihsZXQgaT1sZW47aS0tO2kgPjApIHsKICAgICAgICAgIHRoaXMuZWRyYXdDb21wb25lbnRzW2ldLm11bHRpcGxlQWN0aXZlQm9vbCA9IGZhbHNlOwogICAgICAgIH0KICAgICAgfWVsc2UgaWYoWydpc0FwcGx5U2hhZG93JywgJ2JvcmRlclJhZGl1cyddLmluZGV4T2Yoc3RhdGUpID4gLTEpIHsKICAgICAgICBsZXQgbGVuID0gdGhpcy5lU3RhdGVzLm11bHRpcGxlQWN0aXZlQXJyLmxlbmd0aDsKICAgICAgICBmb3IobGV0IGk9bGVuO2ktLTtpID4wKSB7CiAgICAgICAgICB0aGlzLmVTdGF0ZXMubXVsdGlwbGVBY3RpdmVBcnJbaV0uc3R5bGVbc3RhdGVdID0gdmFsdWU7CiAgICAgICAgfQogICAgICB9ZWxzZSBpZihzdGF0ZSA9PT0gJ2FsaWduJykgewogICAgICAgIHN3aXRjaCh2YWx1ZSkgewogICAgICAgICAgY2FzZSAndCcgOgogICAgICAgICAgICB0aGlzLm11bHRpcEFycmF5KCd0b3AnKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICdsJyA6CiAgICAgICAgICAgIHRoaXMubXVsdGlwQXJyYXkoJ2xlZnQnKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICdiJyA6CiAgICAgICAgICAgIHRoaXMubXVsdGlwQXJyYXkoJ2JvdHRvbScpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgJ3InIDoKICAgICAgICAgICAgdGhpcy5tdWx0aXBBcnJheSgncmlnaHQnKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICAvLyDliKDpmaTlpJrpgInlhYPntKAKICAgIGRlbE11bHRpcENvbXAoY29tcCwgaW5kZXgpIHsKICAgICAgdGhpcy5lU3RhdGVzLm11bHRpcGxlQWN0aXZlQXJyLnNwbGljZShpbmRleCwgMSk7CiAgICAgIGxldCBfaW5kZXggPSB0aGlzLmVkcmF3Q29tcG9uZW50cy5pbmRleE9mKGNvbXApOwogICAgICBpZihfaW5kZXggPiAtMSkgewogICAgICAgIHRoaXMuZWRyYXdDb21wb25lbnRzW19pbmRleF0ubXVsdGlwbGVBY3RpdmVCb29sID0gZmFsc2U7CiAgICAgIH0KICAgIH0sCiAgICBjaGFuZ2VDb25maWcoc3RhdGUsIHZhbHVlKXsKICAgICAgaWYoIXRoaXMuY29uZmlnc1tzdGF0ZV0pIHJldHVybjsKICAgICAgaWYoc3RhdGUgPT09ICdiZycpIHsKICAgICAgICB0aGlzLmNoYW5nZUJnSW1nKCkKICAgICAgfQogICAgICB0aGlzLmNvbmZpZ3Nbc3RhdGVdID0gdmFsdWU7CiAgICB9LAogICAgbXVsdGlwQXJyYXkocGFyYW0pIHsKICAgICAgbGV0IGxpc3QgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuZVN0YXRlcy5tdWx0aXBsZUFjdGl2ZUFycikpOwogICAgICBsaXN0LnNvcnQoZnVuY3Rpb24oYSwgYikgewogICAgICAgIHJldHVybiBbJ3RvcCcsICdsZWZ0J10uaW5kZXhPZihwYXJhbSkgPiAtMSA/IGEuc3R5bGVbcGFyYW1dIC0gYi5zdHlsZVtwYXJhbV06CiAgICAgICAgICBwYXJhbSA9PT0gJ2JvdHRvbScgPyAgYi5zdHlsZS50b3AgKyBiLnN0eWxlLmhlaWdodCAtIChhLnN0eWxlLnRvcCArIGEuc3R5bGUuaGVpZ2h0KSA6CiAgICAgICAgICBiLnN0eWxlLmxlZnQgKyBiLnN0eWxlLndpZHRoIC0gKGEuc3R5bGUubGVmdCArIGEuc3R5bGUud2lkdGgpIAogICAgICB9KTsKICAgICAgbGV0IGxlbiA9IHRoaXMuZVN0YXRlcy5tdWx0aXBsZUFjdGl2ZUFyci5sZW5ndGg7CiAgICAgIGxldCByZXNPYmogPSBsaXN0WzBdOwogICAgICBpZihbJ3RvcCcsICdsZWZ0J10uaW5kZXhPZihwYXJhbSkgPiAtMSkgewogICAgICAgIGZvcihsZXQgaT0wO2k8bGVuO2krKykgewogICAgICAgICAgdGhpcy5lU3RhdGVzLm11bHRpcGxlQWN0aXZlQXJyW2ldLnN0eWxlW3BhcmFtXSA9IHJlc09iai5zdHlsZVtwYXJhbV07CiAgICAgICAgfQogICAgICB9ZWxzZSBpZihwYXJhbSA9PT0gJ2JvdHRvbScpIHsKICAgICAgICBsZXQgX2JvdHRvbSA9IHJlc09iai5zdHlsZS50b3AgKyByZXNPYmouc3R5bGUuaGVpZ2h0OwogICAgICAgIGZvcihsZXQgaT0wO2k8bGVuO2krKykgewogICAgICAgICAgdGhpcy5lU3RhdGVzLm11bHRpcGxlQWN0aXZlQXJyW2ldLnN0eWxlLnRvcCA9IF9ib3R0b20gLSB0aGlzLmVTdGF0ZXMubXVsdGlwbGVBY3RpdmVBcnJbaV0uc3R5bGUuaGVpZ2h0OwogICAgICAgIH0KICAgICAgfWVsc2UgaWYocGFyYW0gPT09ICdyaWdodCcpIHsKICAgICAgICBsZXQgX3JpZ2h0ID0gcmVzT2JqLnN0eWxlLmxlZnQgKyByZXNPYmouc3R5bGUud2lkdGg7CiAgICAgICAgZm9yKGxldCBpPTA7aTxsZW47aSsrKSB7CiAgICAgICAgICB0aGlzLmVTdGF0ZXMubXVsdGlwbGVBY3RpdmVBcnJbaV0uc3R5bGUubGVmdCA9IF9yaWdodCAtIHRoaXMuZVN0YXRlcy5tdWx0aXBsZUFjdGl2ZUFycltpXS5zdHlsZS53aWR0aDsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBpc01hYzpmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIC9tYWNpbnRvc2h8bWFjIG9zIHgvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpCiAgICB9LAogICAgY2FsY0FuZ2xlRGVncmVlcyh4LCB5KSB7CiAgICAgIGxldCB2YWwgPSAgTWF0aC5hdGFuMih5LCB4KSAqIDE4MCAvIE1hdGguUEk7CiAgICAgIHJldHVybiBNYXRoLmNlaWwodmFsKTsKICAgIH0sCiAgICBzY3JlZW46ZnVuY3Rpb24oKSB7CiAgICAgIHRoaXMuY29uZmlncy5iZ0FsbEJvb2wgPSAhdGhpcy5jb25maWdzLmJnQWxsQm9vbDsKICAgICAgaWYodGhpcy5jb25maWdzLmJnQWxsQm9vbCkgewogICAgICAgIHRoaXMuY29uZmlncy53aW5kb3dfdyA9IHdpbmRvdy5zY3JlZW4ud2lkdGggPiAxNTAwID8gd2luZG93LnNjcmVlbi53aWR0aCA6IDE1MDA7CiAgICAgICAgdGhpcy5jb25maWdzLndpbmRvd19oID0gd2luZG93LnNjcmVlbi5oZWlnaHQgPiA4MDAgPyB3aW5kb3cuc2NyZWVuLmhlaWdodCA6IDgwMDsKICAgICAgICB0aGlzLmNvbmZpZ3Muc2NhbGUgPSAxOwogICAgICB9CiAgICB9LAogICAgaW5pdFN0b3JhZ2VEYXRhKGNsZWFyQm9vbCkgewogICAgICBpZighY2xlYXJCb29sICYmIHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnYm1fZGF0YXMnKSkgcmV0dXJuOwogICAgICBsZXQgcGFyYW1zID0gewogICAgICAgICAgc2F2ZV9kYXRhX2F1dG86W10sCiAgICAgICAgICBzYXZlX2RhdGFfY3VzdG9tOltdCiAgICAgIH0KICAgICAgd2luZG93LmxvY2FsU3RvcmFnZS5zZXRJdGVtKCdibV9kYXRhcycsIEpTT04uc3RyaW5naWZ5KHBhcmFtcykpCiAgICB9LAogICAgc2F2ZURhdGVUb1N0b3JhZ2UoZGF0YSwgc3RhdGUpIHsKICAgICAgbGV0IHNhdmVEYXRhID0gZGF0YSB8fCB0aGlzLmVkcmF3Q29tcG9uZW50czsKICAgICAgLy/lrZjlgqjkvJjljJbvvIzmsqHmnInlhoXlrrnnmoTpobXpnaLkuI3pnIDopoHlrZjlgqgKICAgICAgaWYoIXNhdmVEYXRhIHx8IEFycmF5LmlzQXJyYXkoc2F2ZURhdGEpICYmIHNhdmVEYXRhLmxlbmd0aCA9PT0gMCkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBsZXQgb2JqID0gewogICAgICAgIGRhdGE6IHNhdmVEYXRhLAogICAgICAgIHR5cGU6IHN0YXRlIHx8ICdhdXRvJywKICAgICAgICB1cGRhdGVUaW1lOm5ldyBEYXRlKCkKICAgICAgfTsKICAgICAgaWYoIXdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnYm1fZGF0YXMnKSkgewogICAgICAgIHRoaXMuaW5pdFN0b3JhZ2VEYXRhKCk7CiAgICAgIH0KICAgICAgbGV0IHBhcmFtcyA9IHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnYm1fZGF0YXMnKTsKICAgICAgaWYocGFyYW1zICYmIHR5cGVvZiBwYXJhbXMgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgcGFyYW1zID0gSlNPTi5wYXJzZShwYXJhbXMpCiAgICAgIH0KICAgICAgaWYoc3RhdGUgPT09ICdjdXN0b20nKSB7CiAgICAgICAgcGFyYW1zLnNhdmVfZGF0YV9jdXN0b20udW5zaGlmdChvYmopOwogICAgICAgIGlmKHBhcmFtcy5zYXZlX2RhdGFfY3VzdG9tLmxlbmd0aCA+IDUwKSB7CiAgICAgICAgICBwYXJhbXMuc2F2ZV9kYXRhX2N1c3RvbSA9IHBhcmFtcy5zYXZlX2RhdGFfY3VzdG9tLnNsaWNlKDAsIDUwKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcGFyYW1zLnNhdmVfZGF0YV9hdXRvLnVuc2hpZnQob2JqKTsKICAgICAgICBpZihwYXJhbXMuc2F2ZV9kYXRhX2F1dG8ubGVuZ3RoID4gNTApIHsKICAgICAgICAgIHBhcmFtcy5zYXZlX2RhdGFfYXV0byA9IHBhcmFtcy5zYXZlX2RhdGFfYXV0by5zbGljZSgwLCA1MCk7CiAgICAgICAgfQogICAgICB9CgogICAgICB3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2JtX2RhdGFzJywgSlNPTi5zdHJpbmdpZnkocGFyYW1zKSk7CiAgICB9LAogICAgZ2V0U3RvcmFnZURhdGEoKSB7CiAgICAgIHRoaXMuYWN0aXZlSGlzdG9yeUJvb2wgPSAhdGhpcy5hY3RpdmVIaXN0b3J5Qm9vbDsKICAgICAgdGhpcy5jdXJyZW50SGlzdG9yeUluZGV4ID0gLTE7CiAgICAgIGxldCBwYXJhbXMgPSB3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2JtX2RhdGFzJyk7CiAgICAgIGlmKHBhcmFtcyAmJiB0eXBlb2YgcGFyYW1zID09PSAnc3RyaW5nJykgewogICAgICAgIHBhcmFtcyA9IEpTT04ucGFyc2UocGFyYW1zKQogICAgICB9CiAgICAgIGxldCBsaXN0ID0gW10uY29uY2F0KHBhcmFtcy5zYXZlX2RhdGFfY3VzdG9tLCBwYXJhbXMuc2F2ZV9kYXRhX2F1dG8pCiAgICAgIHRoaXMuaGlzdG9yeUN1cnJuZXREYXRhID0gXy5vcmRlckJ5KGxpc3QsICd1cGRhdGVUaW1lJywgImRlc2MiKTsKICAgIH0sCiAgICBjaGFuZ2VCZ0ltZyh1cmwpIHsKICAgICAgdGhpcy5jb25maWdzLmJhY2tncm91bmRVcmwgPSB1cmw7CiAgICB9LAogICAgY2xlYXJTdG9yYWdlRGF0YSgpIHsKICAgICAgdGhpcy5pbml0U3RvcmFnZURhdGEodHJ1ZSk7CiAgICB9LAogICAgaW5pdEhpc3RvcnlMaXN0U3RhdGUoaW5kZXgpIHsKICAgICAgdGhpcy5jdXJyZW50SGlzdG9yeUluZGV4ID0gaW5kZXggPiAtMSA/IGluZGV4IDogLTE7CiAgICAgIGlmKEFycmF5LmlzQXJyYXkodGhpcy5oaXN0b3J5Q3Vycm5ldERhdGEpKSB7CiAgICAgICAgbGV0IGxlbiA9IHRoaXMuaGlzdG9yeUN1cnJuZXREYXRhLmxlbmd0aDsKICAgICAgICBmb3IobGV0IGk9MDtpPGxlbjtpKyspIHsKICAgICAgICAgIHRoaXMuaGlzdG9yeUN1cnJuZXREYXRhW2ldLmlzQWN0aXZlID0gZmFsc2U7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgYXBwbHlIaXN0b3J5KGxpc3QpIHsKICAgICAgdGhpcy5zYXZlRGF0ZVRvU3RvcmFnZSgpCiAgICAgIHRoaXMuZWRyYXdDb21wb25lbnRzID0gbGlzdDsKICAgICAgdGhpcy5pbml0Q29tcFN0YXRlKCk7CiAgICAgIHRoaXMuY2xvc2VIaXN0b3J5KCk7CiAgICB9LAogICAgY2xvc2VIaXN0b3J5KCkgewogICAgICB0aGlzLmFjdGl2ZUhpc3RvcnlCb29sID0gZmFsc2U7CiAgICB9CiAgfQp9Cg=="},{"version":3,"sources":["editor.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkDA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"editor.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div id=\"editor\">\n    <!-- 组件库 -->\n    <editor-comps \n      v-bind:elements=\"edrawComponents\"\n      v-on:initCompsState=\"initComponentState\" \n      v-on:selectComp=\"selectComp\"></editor-comps>\n    \n    <!-- 画布 -->\n    <editor-canvas \n\n      v-bind:configs=\"configs\"\n      v-bind:edrawComps=\"edrawComponents\"\n      v-bind:currentActiveIndex=\"eStates.currentActiveIndex\"\n      v-bind:multipleActiveBool=\"eStates.multipleActiveBool\"\n      v-on:initCompsState=\"initComponentState\" \n      v-on:dragComp=\"dragCurrentComp\"\n      v-on:resizeByDragComp=\"resizeByDragComp\"\n      v-on:trans=\"transComp\"\n      v-on:screen=\"screen\"></editor-canvas>\n\n    <!-- 组件设置 -->\n    <editor-settings\n      v-bind:currentActiveIndex=\"eStates.currentActiveIndex\"\n      v-bind:currentElement=\"edrawComponents[eStates.currentActiveIndex]\"\n      v-bind:multipleActiveArr=\"eStates.multipleActiveArr\"\n      v-bind:configs=\"configs\"\n      v-on:delComp=\"delComp\"\n      v-on:delMultipComp=\"delMultipComp\"\n      v-on:setMultipleState=\"setMultipleState\"\n      v-on:changeConfig=\"changeConfig\"\n      v-on:download=\"download\"\n      v-on:screen=\"screen\"\n      v-on:saveDateToStorage=\"saveDateToStorage\"\n      v-on:getHistory=\"getStorageData\"\n      v-on:changeBgImg=\"changeBgImg\"></editor-settings>\n    \n    <editor-history\n      v-if=\"activeHistoryBool\"\n      v-bind:list=\"historyCurrnetData\"\n      v-bind:currentIndex=\"currentHistoryIndex\"\n      v-on:initState=\"initHistoryListState\"\n      v-on:applyHistory=\"applyHistory\"\n      v-on:closeHistory=\"closeHistory\"></editor-history>\n    <!-- 帮助 -->\n    <editor-help/>\n  </div>\n</template>\n\n<script>\nimport EditorComps from './editor-comps';\nimport EditorCanvas from './editor-canvas';\nimport EditorSettings from './editor-settings';\nimport EditorHelp from './editor-help';\nimport EditorHistory from './editor-history';\nimport _ from 'lodash';  \n\nexport default {\n  name: 'Editor',\n  created:function() {\n    this.initStorageData();\n    this.initBindingEvent();\n  },\n  data(){\n     return {\n        eStates:{\n          currentActiveIndex:-1,\n          copyByKeyBool:false,\n          multipleActiveArr:[],\n        },\n        edrawComponents:[],\n        configs:{\n          bg:\"grid\",\n          pageName:'底图',\n          spacing:10,\n          scale:1,\n          Isometric_row:10,\n          Isometric_colu:10,\n          dowloadImgType:'png',\n          bgAllBool:false,\n          window_w:1920,\n          window_h:900,\n          backgroundUrl:\"\"\n        },\n        historyCurrnetData:[],\n        currentHistoryIndex:-1,\n        activeHistoryBool:false\n     }\n  },\n  components: {\n    'editor-comps':EditorComps,\n    'editor-canvas':EditorCanvas,\n    'editor-settings':EditorSettings,\n    'editor-help':EditorHelp,\n    'editor-history':EditorHistory\n  },\n  methods: {\n    initData() {\n      this.activeHistoryBool = false;\n    },\n    initBindingEvent() {\n      document.addEventListener('keydown', this.kaydownFun, false);\n      document.addEventListener('mousedown', this.mousedownFun);\n      window.addEventListener('beforeunload', this.leaving);\n    },\n    leaving(event) {\n      this.saveDateToStorage();\n      console.log(event.returnValue)\n      // let message = \"内容更改，注意截图缓存\"; \n      // event.returnValue = message;\n      // return message;\n    },\n    download:function() {\n      //TODO:页面下载\n    },\n    saveAs:function(img) {\n      let _dom = window.document.createElement('a');\n        _dom.href = img\n        _dom.dataset.downloadurl = ['image/png', 'IMG_DOWNLOAD_NAME', _dom.href].join(':');\n        document.body.appendChild(_dom);\n        _dom.click();\n        document.body.removeChild(_dom);\n    },\n    // 组件选择\n    selectComp(event, comp) {\n      let item = JSON.parse(JSON.stringify(comp));\n      if(!item) return;\n      this.initCompState();\n      item.isActive = true;\n      item.multipleActiveBool=false;\n      let rect = document.getElementById('canvas').getClientRects()[0];\n      let {width, height, borderRadius, rotate, borderWidth, background} = item.defStyle;\n      let {clientX , clientY} = event;\n      let _style = {\n          width:width || 100,\n          height:height || 100,\n          top: clientY  - rect.top + 60 || 100,\n          left:clientX + 213 - rect.left || 100,\n          rotate: rotate || 0,\n          drag_start_x: 0, //拖拽相对\n          drag_start_y :0,\n          borderWidth:borderWidth || 0,\n          background:background,\n          position:'absolute',\n          isApplyShadow:'true',\n          isFixed:\"false\",\n          borderRadius:borderRadius || 0\n      }\n      item.style = _style;\n      this.edrawComponents.push(item);\n      this.eStates.currentActiveIndex = this.edrawComponents.length -1;\n    },\n    initComponentState(current, event) {\n      if(current === undefined || current === null || current === -1) return;\n      if(event && (event.ctrlKey || event.metaKey && this.isMac()) && event.button === 0 ) {\n        this.edrawComponents[current].isActive = false;\n        if(this.eStates.currentActiveIndex > -1) {\n          this.eStates.currentActiveIndex = -1;\n        }\n\n        // 多选操作缓存数组\n        const _multipActiveIndex = this.eStates.multipleActiveArr.indexOf(this.edrawComponents[current]);\n        if( _multipActiveIndex === -1) {\n          this.eStates.multipleActiveArr.push(this.edrawComponents[current])\n        }\n\n        if(this.edrawComponents[current].multipleActiveBool) {\n          this.edrawComponents[current].multipleActiveBool = false;\n          this.eStates.multipleActiveArr.splice(_multipActiveIndex, 1);\n        } else {\n          this.edrawComponents[current].multipleActiveBool = true;\n        }\n      }else {\n        this.initCompState();     \n        this.eStates.currentActiveIndex = current;\n        this.edrawComponents[current].isActive = true;\n      }\n\n    },\n    // 初始化画布内组件状态\n    initCompState() {\n      let len = this.edrawComponents.length;\n      this.eStates.multipleActiveArr = [];\n      for(let i=0;i<len;i++) {\n        this.edrawComponents[i].isActive = false;\n        this.edrawComponents[i].multipleActiveBool = false;\n      }\n      this.eStates.copyByKeyBool = false;\n    },\n    // 组件拖拽：ctrlkey === true 处理多选\n    dragCurrentComp(event, comp, state, currentIndex, canvesRect) {\n      if(event && (event.ctrlKey || event.metaKey && this.isMac())  ){\n        console.log('多选处理')\n      } else { \n        this.eStates.copyByKeyBool = false;\n        let _rect = document.getElementById('canvas').getClientRects()[0]\n        let _l =_rect.left;\n        let _t =_rect.left;\n        if(state === 'start') {\n          this.eStates.currentActiveIndex = currentIndex;\n          comp.style.drag_start_x = event.clientX - comp.style.left - _l + canvesRect.x;\n          comp.style.drag_start_y = event.clientY - comp.style.top - _t + canvesRect.y;\n        }else if(state === 'drag'){\n          let _left = event.clientX - comp.style.drag_start_x  - _l + canvesRect.x; \n          let _top = event.clientY - comp.style.drag_start_y - _t + canvesRect.y ;\n          if(_left <0 || _top < 0) return;\n          comp.style.left = _left;\n          comp.style.top = _top ;\n        }\n        var dragIcon = document.createElement('img');\n        dragIcon.src = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7',\n        dragIcon.width = 0;\n        dragIcon.height = 0;\n        dragIcon.opacity = 0;\n        event.dataTransfer.setDragImage(dragIcon,0, 0);\n      }\n    },\n    resizeByDragComp(event, comp, state, arrow,currentIndex) {\n      if(event && (event.ctrlKey || event.metaKey && this.isMac())  ){\n        console.log('多选处理')\n      } else {\n        this.eStates.copyByKeyBool = false;\n        let _l = document.getElementById('canvas').getClientRects()[0].left;\n        let _t = document.getElementById('canvas').getClientRects()[0].top;\n        if(state === 'start') {\n          this.eStates.currentActiveIndex = currentIndex;\n          comp.style.drag_start_x = arrow === 'r' ? comp.style.left:\n                                    arrow === 'l' ?comp.style.left + comp.style.width + _l - 213 :\n                                    10;\n          comp.style.drag_start_y = arrow === 'b' ? comp.style.top  :\n                                    arrow === 't' ?comp.style.top + comp.style.height  :\n                                    10;\n        }else if(state === 'drag'){\n          let _width = 0;\n          let _top = 0;\n          let _height = 0;\n     \n          switch(arrow) {\n            case 'r':\n              _width = event.clientX - comp.style.drag_start_x + 213 - _l ; \n              comp.style.width = _width >= 10 ? _width: 10;\n              break;\n            case 'l':\n              comp.style.left = event.clientX  + 213 - _l; \n              _width = comp.style.drag_start_x - event.clientX;\n              comp.style.width = _width >= 10 ? _width: 10;\n              break;\n            case 't':\n              console.log(_t, 60)\n              comp.style.top = event.clientY;\n              _height = comp.style.drag_start_y - event.clientY \n              comp.style.height = _height >= 10 ? _height : 10;\n              break;\n            case 'b':\n              _top = _t >=0 ? (event.clientY - comp.style.drag_start_y) :event.clientY - comp.style.drag_start_y - _t  + 60;\n              console.log(\"t ==> \",_t, _top, comp.style.drag_start_y)\n              comp.style.height = _top >= 10 ? _top: 10;\n              break;\n            default:\n              break\n          }\n        }\n      }\n    },\n    transComp(event, comp){\n        let _x = event.clientX - comp.style.left - comp.style.width / 2;\n        let _y = event.clientY - comp.style.top - comp.style.height / 2;\n        comp.style.rotate = this.calcAngleDegrees(_x, _y);\n    },\n    // 组件删除\n    delComp(index, state) {\n      if(state === 'multipleDel') {\n        let len = this.edrawComponents.length;\n        this.eStates.multipleActiveArr = [];\n        for(let i=len;i--;i >0) {\n          let multipBool = this.edrawComponents[i].multipleActiveBool;\n          if(multipBool) {\n            this.edrawComponents.splice(i,1)\n          }\n        }\n      } else {\n        if(this.eStates.currentActiveIndex > -1 &&this.edrawComponents.length > 0) {\n          this.edrawComponents.splice(this.eStates.currentActiveIndex,1)\n          this.eStates.currentActiveIndex = -1;\n        }\n      }\n    },\n    // 键盘事件\n    kaydownFun(event) {\n      if(event.key === 'c') {\n        this.eStates.copyByKeyBool = true;\n      }else if(this.eStates.copyByKeyBool && event.key === 'v') {\n        this.copyCurrentComp();\n      }else {\n        if(['ArrowUp','ArrowDown','ArrowLeft',\"ArrowRight\"].indexOf(event['code'])> -1) {\n          event.preventDefault();\n          if(this.eStates.currentActiveIndex > -1 && this.eStates.multipleActiveArr.length === 0) {\n            this.arrowItem(event['code'], this.edrawComponents[this.eStates.currentActiveIndex])\n          }else if(this.eStates.multipleActiveArr.length > 0){\n            let len = this.eStates.multipleActiveArr.length;\n            for(let i=0;i<len;i++){\n               this.arrowItem(event['code'], this.eStates.multipleActiveArr[i])\n            }\n          }\n        }\n      }\n      if(event.key === 'Delete' || this.isMac() && event.key === 'Backspace')  {\n        this.delComp();\n      }\n    },\n    arrowItem(arrow, obj) {\n      if(arrow && obj) {\n        switch (arrow) {\n          case 'ArrowUp' :\n            obj.style.top = (obj.style.top - 1) > 0 ? ( obj.style.top - 1) : 0;\n            break;\n          case 'ArrowDown' :\n            obj.style.top = obj.style.top + 1;\n            break;\n          case 'ArrowLeft' :\n            obj.style.left = (obj.style.left -1 )> 0? (obj.style.left -1) : 0;\n            break;\n          case 'ArrowRight':\n            obj.style.left =  obj.style.left +1;\n            break;\n          default:\n            break;\n        }\n      }\n    },\n    // 多选事件\n    mousedownFun(event) {\n      if((!event.ctrlKey || !event.metaKey && this.isMac()) && event.button === 0 \n        && event.target.id==='canvas' \n        && !event.target.classList.contains('comp-element')) {\n        this.eStates.copyByKeyBool = false;\n        this.initCompState();\n      } \n    },\n    // 创建当前组件\n    copyCurrentComp:function() {\n      let _currComp = this.edrawComponents[this.eStates.currentActiveIndex];\n      if(!_currComp) return;\n      _currComp.isActive = false;\n      let _copy = JSON.parse(JSON.stringify(_currComp));\n      let _style = _currComp.style;\n      let _h = this.configs.Isometric_colu > 1? this.configs.Isometric_colu : 1;\n      _copy.style.top = _style.height + _style.top + _h;\n      _copy.isActive = true;\n      this.edrawComponents.push(_copy);\n      this.eStates.currentActiveIndex = this.edrawComponents.length - 1; //更新激活组件的下标\n    },\n    // 多选操作:反选/清空多选/属性应用\n    setMultipleState:function(state, value) {\n      if(state === 'Isometric') {\n        for(let i = this.eStates.multipleActiveArr.length-1;i>=0;i--) {\n          let obj = this.eStates.multipleActiveArr[i];\n          let bool = obj['multipleActiveBool'];\n          if(!bool) {\n            this.eStates.multipleActiveArr.splice(i,1);\n          }\n        }\n        let len = this.eStates.multipleActiveArr.length;\n        let val = 0;\n        if(value === 'row') {\n          this.eStates.multipleActiveArr =  this.eStates.multipleActiveArr.sort(function(a,b){\n            return a.style.left - b.style.left;\n          })\n          for(let i=0;i< len;i++) {\n            let item = this.eStates.multipleActiveArr[i];\n            if(i>0) {\n              item.style.left = val;\n            }\n            val = item.style.left + item.style.width + parseInt(this.configs.Isometric_row);\n          }\n        } else {\n          this.eStates.multipleActiveArr =  this.eStates.multipleActiveArr.sort(function(a,b){\n            return a.style.top - b.style.top ;\n          })\n          for(let i=0;i< len;i++) {\n            let item = this.eStates.multipleActiveArr[i];\n            if(i>0) {\n              item.style.top = val;\n            }\n            val = item.style.height + item.style.top + parseInt(this.configs.Isometric_colu);\n          }\n        }     \n      }else if(state === 'reSel') {\n        let len = this.edrawComponents.length;\n        this.eStates.multipleActiveArr = [];\n        for(let i=len;i--;i >0) {\n          let item = this.edrawComponents[i];\n          if(!item.multipleActiveBool) {  \n            this.eStates.multipleActiveArr.push(item);\n          }\n          item.multipleActiveBool = !item.multipleActiveBool;\n        }\n      } else if(state === 'clear'){\n        let len = this.edrawComponents.length;\n        this.eStates.multipleActiveArr = [];\n        for(let i=len;i--;i >0) {\n          this.edrawComponents[i].multipleActiveBool = false;\n        }\n      }else if(['isApplyShadow', 'borderRadius'].indexOf(state) > -1) {\n        let len = this.eStates.multipleActiveArr.length;\n        for(let i=len;i--;i >0) {\n          this.eStates.multipleActiveArr[i].style[state] = value;\n        }\n      }else if(state === 'align') {\n        switch(value) {\n          case 't' :\n            this.multipArray('top');\n            break;\n          case 'l' :\n            this.multipArray('left');\n            break;\n          case 'b' :\n            this.multipArray('bottom');\n            break;\n          case 'r' :\n            this.multipArray('right');\n            break;\n          default:\n            break;\n        }\n      }\n    },\n    // 删除多选元素\n    delMultipComp(comp, index) {\n      this.eStates.multipleActiveArr.splice(index, 1);\n      let _index = this.edrawComponents.indexOf(comp);\n      if(_index > -1) {\n        this.edrawComponents[_index].multipleActiveBool = false;\n      }\n    },\n    changeConfig(state, value){\n      if(!this.configs[state]) return;\n      if(state === 'bg') {\n        this.changeBgImg()\n      }\n      this.configs[state] = value;\n    },\n    multipArray(param) {\n      let list = JSON.parse(JSON.stringify(this.eStates.multipleActiveArr));\n      list.sort(function(a, b) {\n        return ['top', 'left'].indexOf(param) > -1 ? a.style[param] - b.style[param]:\n          param === 'bottom' ?  b.style.top + b.style.height - (a.style.top + a.style.height) :\n          b.style.left + b.style.width - (a.style.left + a.style.width) \n      });\n      let len = this.eStates.multipleActiveArr.length;\n      let resObj = list[0];\n      if(['top', 'left'].indexOf(param) > -1) {\n        for(let i=0;i<len;i++) {\n          this.eStates.multipleActiveArr[i].style[param] = resObj.style[param];\n        }\n      }else if(param === 'bottom') {\n        let _bottom = resObj.style.top + resObj.style.height;\n        for(let i=0;i<len;i++) {\n          this.eStates.multipleActiveArr[i].style.top = _bottom - this.eStates.multipleActiveArr[i].style.height;\n        }\n      }else if(param === 'right') {\n        let _right = resObj.style.left + resObj.style.width;\n        for(let i=0;i<len;i++) {\n          this.eStates.multipleActiveArr[i].style.left = _right - this.eStates.multipleActiveArr[i].style.width;\n        }\n      }\n    },\n    isMac:function() {\n      return /macintosh|mac os x/i.test(navigator.userAgent)\n    },\n    calcAngleDegrees(x, y) {\n      let val =  Math.atan2(y, x) * 180 / Math.PI;\n      return Math.ceil(val);\n    },\n    screen:function() {\n      this.configs.bgAllBool = !this.configs.bgAllBool;\n      if(this.configs.bgAllBool) {\n        this.configs.window_w = window.screen.width > 1500 ? window.screen.width : 1500;\n        this.configs.window_h = window.screen.height > 800 ? window.screen.height : 800;\n        this.configs.scale = 1;\n      }\n    },\n    initStorageData(clearBool) {\n      if(!clearBool && window.localStorage.getItem('bm_datas')) return;\n      let params = {\n          save_data_auto:[],\n          save_data_custom:[]\n      }\n      window.localStorage.setItem('bm_datas', JSON.stringify(params))\n    },\n    saveDateToStorage(data, state) {\n      let saveData = data || this.edrawComponents;\n      //存储优化，没有内容的页面不需要存储\n      if(!saveData || Array.isArray(saveData) && saveData.length === 0) {\n        return;\n      }\n      let obj = {\n        data: saveData,\n        type: state || 'auto',\n        updateTime:new Date()\n      };\n      if(!window.localStorage.getItem('bm_datas')) {\n        this.initStorageData();\n      }\n      let params = window.localStorage.getItem('bm_datas');\n      if(params && typeof params === 'string') {\n        params = JSON.parse(params)\n      }\n      if(state === 'custom') {\n        params.save_data_custom.unshift(obj);\n        if(params.save_data_custom.length > 50) {\n          params.save_data_custom = params.save_data_custom.slice(0, 50);\n        }\n      } else {\n        params.save_data_auto.unshift(obj);\n        if(params.save_data_auto.length > 50) {\n          params.save_data_auto = params.save_data_auto.slice(0, 50);\n        }\n      }\n\n      window.localStorage.setItem('bm_datas', JSON.stringify(params));\n    },\n    getStorageData() {\n      this.activeHistoryBool = !this.activeHistoryBool;\n      this.currentHistoryIndex = -1;\n      let params = window.localStorage.getItem('bm_datas');\n      if(params && typeof params === 'string') {\n        params = JSON.parse(params)\n      }\n      let list = [].concat(params.save_data_custom, params.save_data_auto)\n      this.historyCurrnetData = _.orderBy(list, 'updateTime', \"desc\");\n    },\n    changeBgImg(url) {\n      this.configs.backgroundUrl = url;\n    },\n    clearStorageData() {\n      this.initStorageData(true);\n    },\n    initHistoryListState(index) {\n      this.currentHistoryIndex = index > -1 ? index : -1;\n      if(Array.isArray(this.historyCurrnetData)) {\n        let len = this.historyCurrnetData.length;\n        for(let i=0;i<len;i++) {\n          this.historyCurrnetData[i].isActive = false;\n        }\n      }\n    },\n    applyHistory(list) {\n      this.saveDateToStorage()\n      this.edrawComponents = list;\n      this.initCompState();\n      this.closeHistory();\n    },\n    closeHistory() {\n      this.activeHistoryBool = false;\n    }\n  }\n}\n</script>\n\n<style>\n\n#editor {\n  margin-top: 60px;\n  padding: 0;\n  position: relative;\n  color: #2c3e50;\n  display: grid;\n  grid-template-columns: 205px auto 205px;\n}\n</style>\n"]}]}