{"remainingRequest":"/Users/liangma/Desktop/workspace/BaseMap/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/liangma/Desktop/workspace/BaseMap/src/components/editor.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/liangma/Desktop/workspace/BaseMap/src/components/editor.vue","mtime":1589601808079},{"path":"/Users/liangma/Desktop/workspace/BaseMap/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/liangma/Desktop/workspace/BaseMap/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/liangma/Desktop/workspace/BaseMap/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBFZGl0b3JDb21wcyBmcm9tICcuL2VkaXRvci1jb21wcyc7CmltcG9ydCBFZGl0b3JDYW52YXMgZnJvbSAnLi9lZGl0b3ItY2FudmFzJzsKaW1wb3J0IEVkaXRvclNldHRpbmdzIGZyb20gJy4vZWRpdG9yLXNldHRpbmdzJzsKaW1wb3J0IEVkaXRvckhlbHAgZnJvbSAnLi9lZGl0b3ItaGVscCc7CmltcG9ydCBFZGl0b3JIaXN0b3J5IGZyb20gJy4vZWRpdG9yLWhpc3RvcnknOwppbXBvcnQgXyBmcm9tICdsb2Rhc2gnOyAgCgpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogJ0VkaXRvcicsCiAgY3JlYXRlZDpmdW5jdGlvbigpIHsKICAgIHRoaXMuaW5pdFN0b3JhZ2VEYXRhKCk7CiAgICB0aGlzLmluaXRCaW5kaW5nRXZlbnQoKTsKICAgIHRoaXMuaW5pdERhdGEKICB9LAogIG1vdW50ZWQ6ZnVuY3Rpb24oKSB7CiAgICB0aGlzLmdldENvbmZpZygpOwogIH0sCiAgCiAgZGF0YSgpewogICAgIHJldHVybiB7CiAgICAgICAgZVN0YXRlczp7CiAgICAgICAgICBjdXJyZW50QWN0aXZlSW5kZXg6LTEsCiAgICAgICAgICBjb3B5QnlLZXlCb29sOmZhbHNlLAogICAgICAgICAgbXVsdGlwbGVBY3RpdmVBcnI6W10sCiAgICAgICAgfSwKICAgICAgICBlZHJhd0NvbXBvbmVudHM6W10sCiAgICAgICAgY29uZmlnczp7CiAgICAgICAgICBiZzoiZ3JpZCIsCiAgICAgICAgICBwYWdlTmFtZTon5bqV5Zu+JywKICAgICAgICAgIHNwYWNpbmc6MTAsCiAgICAgICAgICBzY2FsZToxLAogICAgICAgICAgZHJhZ0ljb25TaXplOjIsCiAgICAgICAgICBJc29tZXRyaWNfcm93OjEwLAogICAgICAgICAgSXNvbWV0cmljX2NvbHU6MTAsCiAgICAgICAgICBkb3dsb2FkSW1nVHlwZToncG5nJywKICAgICAgICAgIGJnQWxsQm9vbDpmYWxzZSwKICAgICAgICAgIHdpbmRvd193OjE5MjAsCiAgICAgICAgICB3aW5kb3dfaDo5MDAsCiAgICAgICAgICBiYWNrZ3JvdW5kVXJsOiIiLAogICAgICAgIH0sCiAgICAgICAgd2ViQ29uZmlnOiB7CiAgICAgICAgICBjdXN0b206IDMwLAogICAgICAgICAgYXV0bzozMCwKICAgICAgICB9LAogICAgICAgIGhpc3RvcnlDdXJybmV0RGF0YTpbXSwKICAgICAgICBjdXJyZW50SGlzdG9yeUluZGV4Oi0xLAogICAgICAgIGFjdGl2ZUhpc3RvcnlCb29sOmZhbHNlCiAgICAgfQogIH0sCiAgY29tcG9uZW50czogewogICAgJ2VkaXRvci1jb21wcyc6RWRpdG9yQ29tcHMsCiAgICAnZWRpdG9yLWNhbnZhcyc6RWRpdG9yQ2FudmFzLAogICAgJ2VkaXRvci1zZXR0aW5ncyc6RWRpdG9yU2V0dGluZ3MsCiAgICAnZWRpdG9yLWhlbHAnOkVkaXRvckhlbHAsCiAgICAnZWRpdG9yLWhpc3RvcnknOkVkaXRvckhpc3RvcnkKICB9LAogIG1ldGhvZHM6IHsKICAgIGluaXREYXRhKCkgewogICAgICB0aGlzLmFjdGl2ZUhpc3RvcnlCb29sID0gZmFsc2U7CiAgICAgIHRoaXMuZ2V0Q29uZmlnKCk7CiAgICB9LAogICAgaW5pdEJpbmRpbmdFdmVudCgpIHsKICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIHRoaXMua2F5ZG93bkZ1biwgZmFsc2UpOwogICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCB0aGlzLm1vdXNlZG93bkZ1bik7CiAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdiZWZvcmV1bmxvYWQnLCB0aGlzLmxlYXZpbmcpOwogICAgfSwKICAgIGxlYXZpbmcoZXZlbnQpIHsKICAgICAgdGhpcy5zYXZlQ29uZmlncygpOwogICAgICB0aGlzLnNhdmVEYXRlVG9TdG9yYWdlKCk7CiAgICAgIGNvbnNvbGUubG9nKGV2ZW50LnJldHVyblZhbHVlKQogICAgICAvLyBsZXQgbWVzc2FnZSA9ICLlhoXlrrnmm7TmlLnvvIzms6jmhI/miKrlm77nvJPlrZgiOyAKICAgICAgLy8gZXZlbnQucmV0dXJuVmFsdWUgPSBtZXNzYWdlOwogICAgICAvLyByZXR1cm4gbWVzc2FnZTsKICAgIH0sCiAgICBkb3dubG9hZDpmdW5jdGlvbigpIHsKICAgICAgLy9UT0RPOumhtemdouS4i+i9vQogICAgfSwKICAgIHNhdmVBczpmdW5jdGlvbihpbWcpIHsKICAgICAgbGV0IF9kb20gPSB3aW5kb3cuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOwogICAgICAgIF9kb20uaHJlZiA9IGltZwogICAgICAgIF9kb20uZGF0YXNldC5kb3dubG9hZHVybCA9IFsnaW1hZ2UvcG5nJywgJ0lNR19ET1dOTE9BRF9OQU1FJywgX2RvbS5ocmVmXS5qb2luKCc6Jyk7CiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChfZG9tKTsKICAgICAgICBfZG9tLmNsaWNrKCk7CiAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChfZG9tKTsKICAgIH0sCiAgICAvLyDnu4Tku7bpgInmi6kKICAgIHNlbGVjdENvbXAoZXZlbnQsIGNvbXApIHsKICAgICAgbGV0IGl0ZW0gPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGNvbXApKTsKICAgICAgaWYoIWl0ZW0pIHJldHVybjsKICAgICAgdGhpcy5pbml0Q29tcFN0YXRlKCk7CiAgICAgIGl0ZW0uaXNBY3RpdmUgPSB0cnVlOwogICAgICBpdGVtLm11bHRpcGxlQWN0aXZlQm9vbD1mYWxzZTsKICAgICAgbGV0IHJlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FudmFzJykuZ2V0Q2xpZW50UmVjdHMoKVswXTsKICAgICAgbGV0IHt3aWR0aCwgaGVpZ2h0LCBib3JkZXJSYWRpdXMsIHJvdGF0ZSwgYm9yZGVyV2lkdGgsIGJhY2tncm91bmQsIGlzQXBwbHlTaGFkb3csIGJnaUJvb2x9ID0gaXRlbS5kZWZTdHlsZTsKICAgICAgbGV0IHtjbGllbnRYICwgY2xpZW50WX0gPSBldmVudDsKICAgICAgbGV0IF9zdHlsZSA9IHsKICAgICAgICAgIHdpZHRoOndpZHRoIHx8IDEwMCwKICAgICAgICAgIGhlaWdodDpoZWlnaHQgfHwgMTAwLAogICAgICAgICAgdG9wOiBjbGllbnRZICAtIHJlY3QudG9wICsgNjAgfHwgMTAwLAogICAgICAgICAgbGVmdDpjbGllbnRYICsgMjEzIC0gcmVjdC5sZWZ0IHx8IDEwMCwKICAgICAgICAgIHJvdGF0ZTogcm90YXRlIHx8IDAsCiAgICAgICAgICBkcmFnX3N0YXJ0X3g6IDAsIC8v5ouW5ou955u45a+5CiAgICAgICAgICBkcmFnX3N0YXJ0X3kgOjAsCiAgICAgICAgICBib3JkZXJXaWR0aDpib3JkZXJXaWR0aCB8fCAwLAogICAgICAgICAgYmFja2dyb3VuZDpiYWNrZ3JvdW5kLAogICAgICAgICAgaXNBcHBseVNoYWRvdzppc0FwcGx5U2hhZG93ICA9PT0gdW5kZWZpbmVkIHx8IGlzQXBwbHlTaGFkb3cgPT09IG51bGwgPyAndHJ1ZScgOiAnZmFsc2UnLAogICAgICAgICAgcG9zaXRpb246J2Fic29sdXRlJywKICAgICAgICAgIGlzRml4ZWQ6ImZhbHNlIiwKICAgICAgICAgIGJnaUJvb2w6YmdpQm9vbCB8fCBmYWxzZSwgLy/mnZDotKgKICAgICAgICAgIGJvcmRlclJhZGl1czpib3JkZXJSYWRpdXMgfHwgMCwKICAgICAgICAgIGZvbnRTaXplOiAxNCwKICAgICAgfQogICAgICBfc3R5bGUubGVmdCA9TWF0aC5tYXgoMCwgIE1hdGgubWluKF9zdHlsZS5sZWZ0LCAyMTMwKSk7CiAgICAgIF9zdHlsZS50b3AgPU1hdGgubWF4KDAsICBNYXRoLm1pbihfc3R5bGUudG9wLCAxMTQwKSk7CiAgICAgIGl0ZW0uc3R5bGUgPSBfc3R5bGU7CiAgICAgIHRoaXMuZWRyYXdDb21wb25lbnRzLnB1c2goaXRlbSk7CiAgICAgIHRoaXMuZVN0YXRlcy5jdXJyZW50QWN0aXZlSW5kZXggPSB0aGlzLmVkcmF3Q29tcG9uZW50cy5sZW5ndGggLTE7CiAgICB9LAogICAgaW5pdENvbXBvbmVudFN0YXRlKGN1cnJlbnQsIGV2ZW50KSB7CiAgICAgIGlmKGN1cnJlbnQgPT09IHVuZGVmaW5lZCB8fCBjdXJyZW50ID09PSBudWxsIHx8IGN1cnJlbnQgPT09IC0xKSByZXR1cm47CiAgICAgIGlmKGV2ZW50ICYmIChldmVudC5zaGlmdEtleSB8fCBldmVudC5tZXRhS2V5ICYmIHRoaXMuaXNNYWMoKSkgJiYgZXZlbnQuYnV0dG9uID09PSAwICkgewogICAgICAgIHRoaXMuZWRyYXdDb21wb25lbnRzW2N1cnJlbnRdLmlzQWN0aXZlID0gZmFsc2U7CiAgICAgICAgaWYodGhpcy5lU3RhdGVzLmN1cnJlbnRBY3RpdmVJbmRleCA+IC0xKSB7CiAgICAgICAgICB0aGlzLmVTdGF0ZXMuY3VycmVudEFjdGl2ZUluZGV4ID0gLTE7CiAgICAgICAgfQoKICAgICAgICAvLyDlpJrpgInmk43kvZznvJPlrZjmlbDnu4QKICAgICAgICBjb25zdCBfbXVsdGlwQWN0aXZlSW5kZXggPSB0aGlzLmVTdGF0ZXMubXVsdGlwbGVBY3RpdmVBcnIuaW5kZXhPZih0aGlzLmVkcmF3Q29tcG9uZW50c1tjdXJyZW50XSk7CiAgICAgICAgaWYoIF9tdWx0aXBBY3RpdmVJbmRleCA9PT0gLTEpIHsKICAgICAgICAgIHRoaXMuZVN0YXRlcy5tdWx0aXBsZUFjdGl2ZUFyci5wdXNoKHRoaXMuZWRyYXdDb21wb25lbnRzW2N1cnJlbnRdKQogICAgICAgIH0KCiAgICAgICAgaWYodGhpcy5lZHJhd0NvbXBvbmVudHNbY3VycmVudF0ubXVsdGlwbGVBY3RpdmVCb29sKSB7CiAgICAgICAgICB0aGlzLmVkcmF3Q29tcG9uZW50c1tjdXJyZW50XS5tdWx0aXBsZUFjdGl2ZUJvb2wgPSBmYWxzZTsKICAgICAgICAgIHRoaXMuZVN0YXRlcy5tdWx0aXBsZUFjdGl2ZUFyci5zcGxpY2UoX211bHRpcEFjdGl2ZUluZGV4LCAxKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5lZHJhd0NvbXBvbmVudHNbY3VycmVudF0ubXVsdGlwbGVBY3RpdmVCb29sID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH1lbHNlIHsKICAgICAgICB0aGlzLmluaXRDb21wU3RhdGUoKTsgICAgIAogICAgICAgIHRoaXMuZVN0YXRlcy5jdXJyZW50QWN0aXZlSW5kZXggPSBjdXJyZW50OwogICAgICAgIHRoaXMuZWRyYXdDb21wb25lbnRzW2N1cnJlbnRdLmlzQWN0aXZlID0gdHJ1ZTsKICAgICAgfQoKICAgIH0sCiAgICAvLyDliJ3lp4vljJbnlLvluIPlhoXnu4Tku7bnirbmgIEKICAgIGluaXRDb21wU3RhdGUoKSB7CiAgICAgIGxldCBsZW4gPSB0aGlzLmVkcmF3Q29tcG9uZW50cy5sZW5ndGg7CiAgICAgIHRoaXMuZVN0YXRlcy5tdWx0aXBsZUFjdGl2ZUFyciA9IFtdOwogICAgICBmb3IobGV0IGk9MDtpPGxlbjtpKyspIHsKICAgICAgICB0aGlzLmVkcmF3Q29tcG9uZW50c1tpXS5pc0FjdGl2ZSA9IGZhbHNlOwogICAgICAgIHRoaXMuZWRyYXdDb21wb25lbnRzW2ldLm11bHRpcGxlQWN0aXZlQm9vbCA9IGZhbHNlOwogICAgICB9CiAgICAgIHRoaXMuZVN0YXRlcy5jb3B5QnlLZXlCb29sID0gZmFsc2U7CiAgICB9LAogICAgLy8g57uE5Lu25ouW5ou977yac2hpZnRLZXkgPT09IHRydWUg5aSE55CG5aSa6YCJCiAgICBkcmFnQ3VycmVudENvbXAoZXZlbnQsIGNvbXAsIHN0YXRlLCBjdXJyZW50SW5kZXgsIGNhbnZlc1JlY3QpIHsKICAgICAgaWYoZXZlbnQgJiYgKGV2ZW50LnNoaWZ0S2V5IHx8IGV2ZW50Lm1ldGFLZXkgJiYgdGhpcy5pc01hYygpKSAgKXsKICAgICAgICBjb25zb2xlLmxvZygn5aSa6YCJ5aSE55CGJykKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmVTdGF0ZXMuY29weUJ5S2V5Qm9vbCA9IGZhbHNlOwogICAgICAgIGxldCBfcmVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW52YXMnKS5nZXRDbGllbnRSZWN0cygpWzBdCiAgICAgICAgbGV0IF9sID1fcmVjdC5sZWZ0OwogICAgICAgIGxldCBfdCA9X3JlY3QubGVmdDsKICAgICAgICBpZihzdGF0ZSA9PT0gJ3N0YXJ0JykgewogICAgICAgICAgdGhpcy5lU3RhdGVzLmN1cnJlbnRBY3RpdmVJbmRleCA9IGN1cnJlbnRJbmRleDsKICAgICAgICAgIGNvbXAuc3R5bGUuZHJhZ19zdGFydF94ID0gZXZlbnQuY2xpZW50WCAtIGNvbXAuc3R5bGUubGVmdCAtIF9sICsgY2FudmVzUmVjdC54OwogICAgICAgICAgY29tcC5zdHlsZS5kcmFnX3N0YXJ0X3kgPSBldmVudC5jbGllbnRZIC0gY29tcC5zdHlsZS50b3AgLSBfdCArIGNhbnZlc1JlY3QueTsKICAgICAgICB9ZWxzZSBpZihzdGF0ZSA9PT0gJ2RyYWcnKXsKICAgICAgICAgIGxldCBfbGVmdCA9IGV2ZW50LmNsaWVudFggLSBjb21wLnN0eWxlLmRyYWdfc3RhcnRfeCAgLSBfbCArIGNhbnZlc1JlY3QueDsgCiAgICAgICAgICBsZXQgX3RvcCA9IGV2ZW50LmNsaWVudFkgLSBjb21wLnN0eWxlLmRyYWdfc3RhcnRfeSAtIF90ICsgY2FudmVzUmVjdC55IDsKICAgICAgICAgIGlmKF9sZWZ0IDwwIHx8IF90b3AgPCAwKSByZXR1cm47CiAgICAgICAgICBfbGVmdCA9TWF0aC5tYXgoMCwgIE1hdGgubWluKF9sZWZ0LCAyMTMwKSk7CiAgICAgICAgICBfdG9wID0gTWF0aC5tYXgoMCwgTWF0aC5taW4oX3RvcCwgMTE0MCkpOwogICAgICAgICAgY29tcC5zdHlsZS5sZWZ0ID0gX2xlZnQ7CiAgICAgICAgICBjb21wLnN0eWxlLnRvcCA9IF90b3AgOwogICAgICAgIH0KICAgICAgICBpZihbJ3N0YXJ0JywgJ2RyYWcnXS5pbmRleE9mKHN0YXRlKSA+IC0xKSB7CiAgICAgICAgICB0aGlzLmVsaW1pbmF0ZUdob3N0aW5nKGV2ZW50KTsgLy8g5raI6Zmk5ouW5ou96ay85b2xCiAgICAgICAgfSAKICAgICAgICAKICAgICAgfQogICAgfSwKICAgIHJlc2l6ZUJ5RHJhZ0NvbXAoZXZlbnQsIGNvbXAsIHN0YXRlLCBhcnJvdyxjdXJyZW50SW5kZXgpIHsKICAgICAgaWYoZXZlbnQgJiYgKGV2ZW50LnNoaWZ0S2V5IHx8IGV2ZW50Lm1ldGFLZXkgJiYgdGhpcy5pc01hYygpKSAgKXsKICAgICAgICBjb25zb2xlLmxvZygn5aSa6YCJ5aSE55CGJykKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmVTdGF0ZXMuY29weUJ5S2V5Qm9vbCA9IGZhbHNlOwogICAgICAgIGxldCBfbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW52YXMnKS5nZXRDbGllbnRSZWN0cygpWzBdLmxlZnQ7CiAgICAgICAgbGV0IF90ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbnZhcycpLmdldENsaWVudFJlY3RzKClbMF0udG9wOwogICAgICAgIGlmKHN0YXRlID09PSAnc3RhcnQnKSB7CiAgICAgICAgICB0aGlzLmVTdGF0ZXMuY3VycmVudEFjdGl2ZUluZGV4ID0gY3VycmVudEluZGV4OwogICAgICAgICAgY29tcC5zdHlsZS5kcmFnX3N0YXJ0X3ggPSBhcnJvdyA9PT0gJ3InID8gY29tcC5zdHlsZS5sZWZ0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcnJvdyA9PT0gJ2wnID9jb21wLnN0eWxlLmxlZnQgKyBjb21wLnN0eWxlLndpZHRoICsgX2wgLSAyMTMgOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAxMDsKICAgICAgICAgIGNvbXAuc3R5bGUuZHJhZ19zdGFydF95ID0gYXJyb3cgPT09ICdiJyA/IGNvbXAuc3R5bGUudG9wICA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFycm93ID09PSAndCcgP2NvbXAuc3R5bGUudG9wICsgY29tcC5zdHlsZS5oZWlnaHQgIDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMTA7CiAgICAgICAgfWVsc2UgaWYoc3RhdGUgPT09ICdkcmFnJyl7CiAgICAgICAgICBsZXQgX3dpZHRoID0gMDsKICAgICAgICAgIGxldCBfdG9wID0gMDsKICAgICAgICAgIGxldCBfaGVpZ2h0ID0gMDsKICAgICAKICAgICAgICAgIHN3aXRjaChhcnJvdykgewogICAgICAgICAgICBjYXNlICdyJzoKICAgICAgICAgICAgICBfd2lkdGggPSBldmVudC5jbGllbnRYIC0gY29tcC5zdHlsZS5kcmFnX3N0YXJ0X3ggKyAyMTMgLSBfbCA7IAogICAgICAgICAgICAgIF93aWR0aCA9IE1hdGgubWluKF93aWR0aCwgMjEzMCk7CiAgICAgICAgICAgICAgY29tcC5zdHlsZS53aWR0aCA9IF93aWR0aCA+PSAxMCA/IF93aWR0aDogMTA7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ2wnOgogICAgICAgICAgICAgIGNvbXAuc3R5bGUubGVmdCA9IGV2ZW50LmNsaWVudFggICsgMjEzIC0gX2w7IAogICAgICAgICAgICAgIF93aWR0aCA9IGNvbXAuc3R5bGUuZHJhZ19zdGFydF94IC0gZXZlbnQuY2xpZW50WDsKICAgICAgICAgICAgICBfd2lkdGggPU1hdGgubWF4KDAsICBNYXRoLm1pbihfd2lkdGgsIDIxMzApKTsKICAgICAgICAgICAgICBjb21wLnN0eWxlLndpZHRoID0gX3dpZHRoID49IDEwID8gX3dpZHRoOiAxMDsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAndCc6CiAgICAgICAgICAgICAgY29tcC5zdHlsZS50b3AgPSBldmVudC5jbGllbnRZOwogICAgICAgICAgICAgIF9oZWlnaHQgPSBjb21wLnN0eWxlLmRyYWdfc3RhcnRfeSAtIGV2ZW50LmNsaWVudFk7CiAgICAgICAgICAgICAgX2hlaWdodCA9TWF0aC5tYXgoMTAsICBNYXRoLm1pbihfaGVpZ2h0LCAyMTMwKSk7CiAgICAgICAgICAgICAgY29tcC5zdHlsZS5oZWlnaHQgPSBfaGVpZ2h0ID49IDEwID8gX2hlaWdodCA6IDEwOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdiJzoKICAgICAgICAgICAgICBfdG9wID0gX3QgPj0wID8gKGV2ZW50LmNsaWVudFkgLSBjb21wLnN0eWxlLmRyYWdfc3RhcnRfeSkgOmV2ZW50LmNsaWVudFkgLSBjb21wLnN0eWxlLmRyYWdfc3RhcnRfeSAtIF90ICArIDYwOwogICAgICAgICAgICAgIF90b3AgPSBNYXRoLm1heCgxMCwgTWF0aC5taW4oX3RvcCwgMjEzMCkpOwogICAgICAgICAgICAgIGNvbXAuc3R5bGUuaGVpZ2h0ID0gX3RvcCA+PSAxMCA/IF90b3A6IDEwOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgdHJhbnNDb21wKGV2ZW50LCBjb21wKXsKICAgICAgICBsZXQgX3ggPSBldmVudC5jbGllbnRYIC0gY29tcC5zdHlsZS5sZWZ0IC0gY29tcC5zdHlsZS53aWR0aCAvIDI7CiAgICAgICAgbGV0IF95ID0gZXZlbnQuY2xpZW50WSAtIGNvbXAuc3R5bGUudG9wIC0gY29tcC5zdHlsZS5oZWlnaHQgLyAyOwogICAgICAgIGNvbXAuc3R5bGUucm90YXRlID0gdGhpcy5jYWxjQW5nbGVEZWdyZWVzKF94LCBfeSk7CiAgICB9LAogICAgY2hhbmdlVGV4dFZhbChldmVudCwgaXRlbSkgewogICAgICBpZihldmVudCAmJiBpdGVtKSB7CiAgICAgICAgIGl0ZW0udmFsdWUgPSBldmVudC50YXJnZXQuaW5uZXJUZXh0OwogICAgICB9CiAgICB9LAogICAgLy8g57uE5Lu25Yig6ZmkCiAgICBkZWxDb21wKGluZGV4LCBzdGF0ZSkgewogICAgICBpZihzdGF0ZSA9PT0gJ211bHRpcGxlRGVsJykgewogICAgICAgIGxldCBsZW4gPSB0aGlzLmVkcmF3Q29tcG9uZW50cy5sZW5ndGg7CiAgICAgICAgdGhpcy5lU3RhdGVzLm11bHRpcGxlQWN0aXZlQXJyID0gW107CiAgICAgICAgZm9yKGxldCBpPWxlbjtpLS07aSA+MCkgewogICAgICAgICAgbGV0IG11bHRpcEJvb2wgPSB0aGlzLmVkcmF3Q29tcG9uZW50c1tpXS5tdWx0aXBsZUFjdGl2ZUJvb2w7CiAgICAgICAgICBpZihtdWx0aXBCb29sKSB7CiAgICAgICAgICAgIHRoaXMuZWRyYXdDb21wb25lbnRzLnNwbGljZShpLDEpCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGlmKHRoaXMuZVN0YXRlcy5jdXJyZW50QWN0aXZlSW5kZXggPiAtMSAmJnRoaXMuZWRyYXdDb21wb25lbnRzLmxlbmd0aCA+IDApIHsKICAgICAgICAgIHRoaXMuZWRyYXdDb21wb25lbnRzLnNwbGljZSh0aGlzLmVTdGF0ZXMuY3VycmVudEFjdGl2ZUluZGV4LDEpCiAgICAgICAgICB0aGlzLmVTdGF0ZXMuY3VycmVudEFjdGl2ZUluZGV4ID0gLTE7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgLy8g6ZSu55uY5LqL5Lu2CiAgICBrYXlkb3duRnVuKGV2ZW50KSB7CiAgICAgIGlmKGV2ZW50LmtleSA9PT0gJ3YnICYmIGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQubm9kZU5hbWUgPT09ICdJTlBVVCcpIHsKICAgICAgICByZXR1cm47CiAgICAgIH1lbHNlIGlmKGV2ZW50LmtleSA9PT0gJ2MnICYmICBkb2N1bWVudC5hY3RpdmVFbGVtZW50Lm5vZGVOYW1lID09PSAnSU5QVVQnKSB7CiAgICAgICAgZG9jdW1lbnQuYWN0aXZlRWxlbWVudC5ibHVyKCk7CiAgICAgIH0KICAgICAgaWYoZXZlbnQudGFyZ2V0Lm5vZGVOYW1lID09PSAnSU5QVVQnICYmIHRoaXMuZVN0YXRlcy5jb3B5QnlLZXlCb29sKSB7CiAgICAgICAgIHRoaXMuZVN0YXRlcy5jb3B5QnlLZXlCb29sID0gZmFsc2U7CiAgICAgIH0KICAgICAgaWYoZXZlbnQua2V5ID09PSAnYycpIHsKICAgICAgICB0aGlzLmVTdGF0ZXMuY29weUJ5S2V5Qm9vbCA9IHRydWU7CiAgICAgIH1lbHNlIGlmKHRoaXMuZVN0YXRlcy5jb3B5QnlLZXlCb29sICYmIGV2ZW50LmtleSA9PT0gJ3YnKSB7CiAgICAgICAgdGhpcy5jb3B5Q3VycmVudENvbXAoKTsKICAgICAgfWVsc2UgaWYoZXZlbnQudGFyZ2V0Lm5vZGVOYW1lICE9PSAnSU5QVVQnKXsKICAgICAgICBpZihbJ0Fycm93VXAnLCdBcnJvd0Rvd24nLCdBcnJvd0xlZnQnLCJBcnJvd1JpZ2h0Il0uaW5kZXhPZihldmVudFsnY29kZSddKT4gLTEpIHsKICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICBpZih0aGlzLmVTdGF0ZXMuY3VycmVudEFjdGl2ZUluZGV4ID4gLTEgJiYgdGhpcy5lU3RhdGVzLm11bHRpcGxlQWN0aXZlQXJyLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICB0aGlzLmFycm93SXRlbShldmVudFsnY29kZSddLCB0aGlzLmVkcmF3Q29tcG9uZW50c1t0aGlzLmVTdGF0ZXMuY3VycmVudEFjdGl2ZUluZGV4XSkKICAgICAgICAgIH1lbHNlIGlmKHRoaXMuZVN0YXRlcy5tdWx0aXBsZUFjdGl2ZUFyci5sZW5ndGggPiAwKXsKICAgICAgICAgICAgbGV0IGxlbiA9IHRoaXMuZVN0YXRlcy5tdWx0aXBsZUFjdGl2ZUFyci5sZW5ndGg7CiAgICAgICAgICAgIGZvcihsZXQgaT0wO2k8bGVuO2krKyl7CiAgICAgICAgICAgICAgIHRoaXMuYXJyb3dJdGVtKGV2ZW50Wydjb2RlJ10sIHRoaXMuZVN0YXRlcy5tdWx0aXBsZUFjdGl2ZUFycltpXSkKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBpZihldmVudC5rZXkgPT09ICdEZWxldGUnIHx8IHRoaXMuaXNNYWMoKSAmJiBldmVudC5rZXkgPT09ICdCYWNrc3BhY2UnKSAgewogICAgICAgIGNvbnNvbGUubG9nKGV2ZW50LnRhcmdldCkKICAgICAgICBpZighKGV2ZW50LnRhcmdldC5pbm5lckhUTUwgJiYgZXZlbnQudGFyZ2V0LmNvbnRlbnRFZGl0YWJsZSkpIHsKICAgICAgICAgIHRoaXMuZGVsQ29tcCgpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGFycm93SXRlbShhcnJvdywgb2JqKSB7CiAgICAgIGlmKGFycm93ICYmIG9iaikgewogICAgICAgIHN3aXRjaCAoYXJyb3cpIHsKICAgICAgICAgIGNhc2UgJ0Fycm93VXAnIDoKICAgICAgICAgICAgb2JqLnN0eWxlLnRvcCA9IChvYmouc3R5bGUudG9wIC0gMSkgPiAwID8gKCBvYmouc3R5bGUudG9wIC0gMSkgOiAwOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgJ0Fycm93RG93bicgOgogICAgICAgICAgICBvYmouc3R5bGUudG9wID0gb2JqLnN0eWxlLnRvcCArIDE7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAnQXJyb3dMZWZ0JyA6CiAgICAgICAgICAgIG9iai5zdHlsZS5sZWZ0ID0gKG9iai5zdHlsZS5sZWZ0IC0xICk+IDA/IChvYmouc3R5bGUubGVmdCAtMSkgOiAwOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgJ0Fycm93UmlnaHQnOgogICAgICAgICAgICBvYmouc3R5bGUubGVmdCA9ICBvYmouc3R5bGUubGVmdCArMTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICAvLyDlpJrpgInkuovku7YKICAgIG1vdXNlZG93bkZ1bihldmVudCkgewogICAgICB0aGlzLmVsaW1pbmF0ZUdob3N0aW5nKGV2ZW50KTsgLy8g5raI6Zmk5ouW5ou96ay85b2xCiAgICAgIGlmKGV2ZW50ICYmIGV2ZW50LnNoaWZ0S2V5ICYmIHRoaXMuZVN0YXRlcy5jdXJyZW50QWN0aXZlSW5kZXggPiAtMSkgewogICAgICAgIHRoaXMuZWRyYXdDb21wb25lbnRzW3RoaXMuZVN0YXRlcy5jdXJyZW50QWN0aXZlSW5kZXhdLmlzQWN0aXZlID0gZmFsc2U7CiAgICAgICAgdGhpcy5lU3RhdGVzLmN1cnJlbnRBY3RpdmVJbmRleCA9IC0xOwogICAgICB9CiAgICAgIGlmKCghZXZlbnQuc2hpZnRLZXkgfHwgIWV2ZW50Lm1ldGFLZXkgJiYgdGhpcy5pc01hYygpKSAmJiBldmVudC5idXR0b24gPT09IDAgCiAgICAgICAgJiYgZXZlbnQudGFyZ2V0LmlkPT09J2NhbnZhcycgCiAgICAgICAgJiYgIWV2ZW50LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2NvbXAtZWxlbWVudCcpKSB7CiAgICAgICAgdGhpcy5lU3RhdGVzLmNvcHlCeUtleUJvb2wgPSBmYWxzZTsKICAgICAgICB0aGlzLmluaXRDb21wU3RhdGUoKTsKICAgICAgfSAKICAgIH0sCiAgICAvLyDliJvlu7rlvZPliY3nu4Tku7YKICAgIGNvcHlDdXJyZW50Q29tcDpmdW5jdGlvbigpIHsKICAgICAgbGV0IF9jdXJyQ29tcCA9IHRoaXMuZWRyYXdDb21wb25lbnRzW3RoaXMuZVN0YXRlcy5jdXJyZW50QWN0aXZlSW5kZXhdOwogICAgICBpZighX2N1cnJDb21wKSByZXR1cm47CiAgICAgIF9jdXJyQ29tcC5pc0FjdGl2ZSA9IGZhbHNlOwogICAgICBsZXQgX2NvcHkgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KF9jdXJyQ29tcCkpOwogICAgICBsZXQgX3N0eWxlID0gX2N1cnJDb21wLnN0eWxlOwogICAgICBsZXQgX3ZhbCA9IDEwOwogICAgICBsZXQgX2ggPSBfdmFsOwogICAgICBfY29weS5zdHlsZS50b3AgPSBwYXJzZUludChfc3R5bGUuaGVpZ2h0KSArIHBhcnNlSW50KF9zdHlsZS50b3ApICsgcGFyc2VJbnQoX2gpOwogICAgICBfY29weS5zdHlsZS50b3AgPSBNYXRoLm1heCgwLCBNYXRoLm1pbihfY29weS5zdHlsZS50b3AsIDEwODApKTsKICAgICAgX2NvcHkuaXNBY3RpdmUgPSB0cnVlOwogICAgICB0aGlzLmVkcmF3Q29tcG9uZW50cy5wdXNoKF9jb3B5KTsKICAgICAgdGhpcy5lU3RhdGVzLmN1cnJlbnRBY3RpdmVJbmRleCA9IHRoaXMuZWRyYXdDb21wb25lbnRzLmxlbmd0aCAtIDE7IC8v5pu05paw5r+A5rS757uE5Lu255qE5LiL5qCHCiAgICB9LAogICAgLy8g5aSa6YCJ5pON5L2cOuWPjemAiS/muIXnqbrlpJrpgIkv5bGe5oCn5bqU55SoCiAgICBzZXRNdWx0aXBsZVN0YXRlOmZ1bmN0aW9uKHN0YXRlLCB2YWx1ZSkgewogICAgICBpZihzdGF0ZSA9PT0gJ0lzb21ldHJpYycpIHsKICAgICAgICBmb3IobGV0IGkgPSB0aGlzLmVTdGF0ZXMubXVsdGlwbGVBY3RpdmVBcnIubGVuZ3RoLTE7aT49MDtpLS0pIHsKICAgICAgICAgIGxldCBvYmogPSB0aGlzLmVTdGF0ZXMubXVsdGlwbGVBY3RpdmVBcnJbaV07CiAgICAgICAgICBsZXQgYm9vbCA9IG9ialsnbXVsdGlwbGVBY3RpdmVCb29sJ107CiAgICAgICAgICBpZighYm9vbCkgewogICAgICAgICAgICB0aGlzLmVTdGF0ZXMubXVsdGlwbGVBY3RpdmVBcnIuc3BsaWNlKGksMSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGxldCBsZW4gPSB0aGlzLmVTdGF0ZXMubXVsdGlwbGVBY3RpdmVBcnIubGVuZ3RoOwogICAgICAgIGxldCB2YWwgPSAwOwogICAgICAgIGlmKHZhbHVlID09PSAncm93JykgewogICAgICAgICAgdGhpcy5lU3RhdGVzLm11bHRpcGxlQWN0aXZlQXJyID0gIHRoaXMuZVN0YXRlcy5tdWx0aXBsZUFjdGl2ZUFyci5zb3J0KGZ1bmN0aW9uKGEsYil7CiAgICAgICAgICAgIHJldHVybiBhLnN0eWxlLmxlZnQgLSBiLnN0eWxlLmxlZnQ7CiAgICAgICAgICB9KQogICAgICAgICAgZm9yKGxldCBpPTA7aTwgbGVuO2krKykgewogICAgICAgICAgICBsZXQgaXRlbSA9IHRoaXMuZVN0YXRlcy5tdWx0aXBsZUFjdGl2ZUFycltpXTsKICAgICAgICAgICAgaWYoaT4wKSB7CiAgICAgICAgICAgICAgaXRlbS5zdHlsZS5sZWZ0ID0gdmFsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhbCA9IGl0ZW0uc3R5bGUubGVmdCArIGl0ZW0uc3R5bGUud2lkdGggKyBwYXJzZUludCh0aGlzLmNvbmZpZ3MuSXNvbWV0cmljX3Jvdyk7CiAgICAgICAgICAgIHZhbCA9IE1hdGgubWF4KDAsIE1hdGgubWluKHZhbCwgMjEzMCkpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLmVTdGF0ZXMubXVsdGlwbGVBY3RpdmVBcnIgPSAgdGhpcy5lU3RhdGVzLm11bHRpcGxlQWN0aXZlQXJyLnNvcnQoZnVuY3Rpb24oYSxiKXsKICAgICAgICAgICAgcmV0dXJuIGEuc3R5bGUudG9wIC0gYi5zdHlsZS50b3AgOwogICAgICAgICAgfSkKICAgICAgICAgIGZvcihsZXQgaT0wO2k8IGxlbjtpKyspIHsKICAgICAgICAgICAgbGV0IGl0ZW0gPSB0aGlzLmVTdGF0ZXMubXVsdGlwbGVBY3RpdmVBcnJbaV07CiAgICAgICAgICAgIGlmKGk+MCkgewogICAgICAgICAgICAgIGl0ZW0uc3R5bGUudG9wID0gdmFsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhbCA9IGl0ZW0uc3R5bGUuaGVpZ2h0ICsgaXRlbS5zdHlsZS50b3AgKyBwYXJzZUludCh0aGlzLmNvbmZpZ3MuSXNvbWV0cmljX2NvbHUpOwogICAgICAgICAgICB2YWwgPSBNYXRoLm1heCgwLCAgTWF0aC5taW4odmFsLCAxMTQwKSk7CiAgICAgICAgICB9CiAgICAgICAgfSAgICAgCiAgICAgIH1lbHNlIGlmKHN0YXRlID09PSAncmVTZWwnKSB7CiAgICAgICAgbGV0IGxlbiA9IHRoaXMuZWRyYXdDb21wb25lbnRzLmxlbmd0aDsKICAgICAgICB0aGlzLmVTdGF0ZXMubXVsdGlwbGVBY3RpdmVBcnIgPSBbXTsKICAgICAgICBmb3IobGV0IGk9bGVuO2ktLTtpID4wKSB7CiAgICAgICAgICBsZXQgaXRlbSA9IHRoaXMuZWRyYXdDb21wb25lbnRzW2ldOwogICAgICAgICAgaWYoIWl0ZW0ubXVsdGlwbGVBY3RpdmVCb29sKSB7ICAKICAgICAgICAgICAgdGhpcy5lU3RhdGVzLm11bHRpcGxlQWN0aXZlQXJyLnB1c2goaXRlbSk7CiAgICAgICAgICB9CiAgICAgICAgICBpdGVtLm11bHRpcGxlQWN0aXZlQm9vbCA9ICFpdGVtLm11bHRpcGxlQWN0aXZlQm9vbDsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZihzdGF0ZSA9PT0gJ2NsZWFyJyl7CiAgICAgICAgbGV0IGxlbiA9IHRoaXMuZWRyYXdDb21wb25lbnRzLmxlbmd0aDsKICAgICAgICB0aGlzLmVTdGF0ZXMubXVsdGlwbGVBY3RpdmVBcnIgPSBbXTsKICAgICAgICBmb3IobGV0IGk9bGVuO2ktLTtpID4wKSB7CiAgICAgICAgICB0aGlzLmVkcmF3Q29tcG9uZW50c1tpXS5tdWx0aXBsZUFjdGl2ZUJvb2wgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH1lbHNlIGlmKFsnaXNBcHBseVNoYWRvdycsICdib3JkZXJSYWRpdXMnXS5pbmRleE9mKHN0YXRlKSA+IC0xKSB7CiAgICAgICAgbGV0IGxlbiA9IHRoaXMuZVN0YXRlcy5tdWx0aXBsZUFjdGl2ZUFyci5sZW5ndGg7CiAgICAgICAgZm9yKGxldCBpPWxlbjtpLS07aSA+MCkgewogICAgICAgICAgdGhpcy5lU3RhdGVzLm11bHRpcGxlQWN0aXZlQXJyW2ldLnN0eWxlW3N0YXRlXSA9IHZhbHVlOwogICAgICAgIH0KICAgICAgfWVsc2UgaWYoc3RhdGUgPT09ICdhbGlnbicpIHsKICAgICAgICBzd2l0Y2godmFsdWUpIHsKICAgICAgICAgIGNhc2UgJ3QnIDoKICAgICAgICAgICAgdGhpcy5tdWx0aXBBcnJheSgndG9wJyk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAnbCcgOgogICAgICAgICAgICB0aGlzLm11bHRpcEFycmF5KCdsZWZ0Jyk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAnYicgOgogICAgICAgICAgICB0aGlzLm11bHRpcEFycmF5KCdib3R0b20nKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICdyJyA6CiAgICAgICAgICAgIHRoaXMubXVsdGlwQXJyYXkoJ3JpZ2h0Jyk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgLy8g5Yig6Zmk5aSa6YCJ5YWD57SgCiAgICBkZWxNdWx0aXBDb21wKGNvbXAsIGluZGV4KSB7CiAgICAgIHRoaXMuZVN0YXRlcy5tdWx0aXBsZUFjdGl2ZUFyci5zcGxpY2UoaW5kZXgsIDEpOwogICAgICBsZXQgX2luZGV4ID0gdGhpcy5lZHJhd0NvbXBvbmVudHMuaW5kZXhPZihjb21wKTsKICAgICAgaWYoX2luZGV4ID4gLTEpIHsKICAgICAgICB0aGlzLmVkcmF3Q29tcG9uZW50c1tfaW5kZXhdLm11bHRpcGxlQWN0aXZlQm9vbCA9IGZhbHNlOwogICAgICB9CiAgICB9LAogICAgY2hhbmdlQ29uZmlnKHN0YXRlLCB2YWx1ZSl7CiAgICAgIGlmKCF0aGlzLmNvbmZpZ3Nbc3RhdGVdKSByZXR1cm47CiAgICAgIGlmKHN0YXRlID09PSAnYmcnKSB7CiAgICAgICAgdGhpcy5jaGFuZ2VCZ0ltZygpCiAgICAgIH0KICAgICAgdGhpcy5jb25maWdzW3N0YXRlXSA9IHZhbHVlOwogICAgfSwKICAgIG11bHRpcEFycmF5KHBhcmFtKSB7CiAgICAgIGxldCBsaXN0ID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLmVTdGF0ZXMubXVsdGlwbGVBY3RpdmVBcnIpKTsKICAgICAgbGlzdC5zb3J0KGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICByZXR1cm4gWyd0b3AnLCAnbGVmdCddLmluZGV4T2YocGFyYW0pID4gLTEgPyBhLnN0eWxlW3BhcmFtXSAtIGIuc3R5bGVbcGFyYW1dOgogICAgICAgICAgcGFyYW0gPT09ICdib3R0b20nID8gIGIuc3R5bGUudG9wICsgYi5zdHlsZS5oZWlnaHQgLSAoYS5zdHlsZS50b3AgKyBhLnN0eWxlLmhlaWdodCkgOgogICAgICAgICAgYi5zdHlsZS5sZWZ0ICsgYi5zdHlsZS53aWR0aCAtIChhLnN0eWxlLmxlZnQgKyBhLnN0eWxlLndpZHRoKSAKICAgICAgfSk7CiAgICAgIGxldCBsZW4gPSB0aGlzLmVTdGF0ZXMubXVsdGlwbGVBY3RpdmVBcnIubGVuZ3RoOwogICAgICBsZXQgcmVzT2JqID0gbGlzdFswXTsKICAgICAgaWYoWyd0b3AnLCAnbGVmdCddLmluZGV4T2YocGFyYW0pID4gLTEpIHsKICAgICAgICBmb3IobGV0IGk9MDtpPGxlbjtpKyspIHsKICAgICAgICAgIHRoaXMuZVN0YXRlcy5tdWx0aXBsZUFjdGl2ZUFycltpXS5zdHlsZVtwYXJhbV0gPSByZXNPYmouc3R5bGVbcGFyYW1dOwogICAgICAgIH0KICAgICAgfWVsc2UgaWYocGFyYW0gPT09ICdib3R0b20nKSB7CiAgICAgICAgbGV0IF9ib3R0b20gPSByZXNPYmouc3R5bGUudG9wICsgcmVzT2JqLnN0eWxlLmhlaWdodDsKICAgICAgICBmb3IobGV0IGk9MDtpPGxlbjtpKyspIHsKICAgICAgICAgIHRoaXMuZVN0YXRlcy5tdWx0aXBsZUFjdGl2ZUFycltpXS5zdHlsZS50b3AgPSBfYm90dG9tIC0gdGhpcy5lU3RhdGVzLm11bHRpcGxlQWN0aXZlQXJyW2ldLnN0eWxlLmhlaWdodDsKICAgICAgICB9CiAgICAgIH1lbHNlIGlmKHBhcmFtID09PSAncmlnaHQnKSB7CiAgICAgICAgbGV0IF9yaWdodCA9IHJlc09iai5zdHlsZS5sZWZ0ICsgcmVzT2JqLnN0eWxlLndpZHRoOwogICAgICAgIGZvcihsZXQgaT0wO2k8bGVuO2krKykgewogICAgICAgICAgdGhpcy5lU3RhdGVzLm11bHRpcGxlQWN0aXZlQXJyW2ldLnN0eWxlLmxlZnQgPSBfcmlnaHQgLSB0aGlzLmVTdGF0ZXMubXVsdGlwbGVBY3RpdmVBcnJbaV0uc3R5bGUud2lkdGg7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgaXNNYWM6ZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiAvbWFjaW50b3NofG1hYyBvcyB4L2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KQogICAgfSwKICAgIGNhbGNBbmdsZURlZ3JlZXMoeCwgeSkgewogICAgICBsZXQgdmFsID0gIE1hdGguYXRhbjIoeSwgeCkgKiAxODAgLyBNYXRoLlBJOwogICAgICByZXR1cm4gTWF0aC5jZWlsKHZhbCk7CiAgICB9LAogICAgc2NyZWVuOmZ1bmN0aW9uKCkgewogICAgICB0aGlzLmNvbmZpZ3MuYmdBbGxCb29sID0gIXRoaXMuY29uZmlncy5iZ0FsbEJvb2w7CiAgICAgIGlmKHRoaXMuY29uZmlncy5iZ0FsbEJvb2wpIHsKICAgICAgICB0aGlzLmNvbmZpZ3Mud2luZG93X3cgPSB3aW5kb3cuc2NyZWVuLndpZHRoID4gMTUwMCA/IHdpbmRvdy5zY3JlZW4ud2lkdGggOiAxNTAwOwogICAgICAgIHRoaXMuY29uZmlncy53aW5kb3dfaCA9IHdpbmRvdy5zY3JlZW4uaGVpZ2h0ID4gODAwID8gd2luZG93LnNjcmVlbi5oZWlnaHQgOiA4MDA7CiAgICAgICAgdGhpcy5jb25maWdzLnNjYWxlID0gMTsKICAgICAgfQogICAgfSwKICAgIGluaXRTdG9yYWdlRGF0YShjbGVhckJvb2wpIHsKICAgICAgaWYoIWNsZWFyQm9vbCAmJiB3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2JtX2RhdGFzJykpIHJldHVybjsKICAgICAgbGV0IHBhcmFtcyA9IHsKICAgICAgICAgIHNhdmVfZGF0YV9hdXRvOltdLAogICAgICAgICAgc2F2ZV9kYXRhX2N1c3RvbTpbXQogICAgICB9CiAgICAgIHdpbmRvdy5sb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnYm1fZGF0YXMnLCBKU09OLnN0cmluZ2lmeShwYXJhbXMpKTsKICAgIH0sCiAgICBzYXZlRGF0ZVRvU3RvcmFnZShkYXRhLCBzdGF0ZSkgewogICAgICBsZXQgc2F2ZURhdGEgPSBkYXRhIHx8IHRoaXMuZWRyYXdDb21wb25lbnRzOwogICAgICAvL+WtmOWCqOS8mOWMlu+8jOayoeacieWGheWuueeahOmhtemdouS4jemcgOimgeWtmOWCqAogICAgICBpZighc2F2ZURhdGEgfHwgQXJyYXkuaXNBcnJheShzYXZlRGF0YSkgJiYgc2F2ZURhdGEubGVuZ3RoID09PSAwKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGxldCBvYmogPSB7CiAgICAgICAgZGF0YTogc2F2ZURhdGEsCiAgICAgICAgdHlwZTogc3RhdGUgfHwgJ2F1dG8nLAogICAgICAgIHVwZGF0ZVRpbWU6bmV3IERhdGUoKQogICAgICB9OwogICAgICBpZighd2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtKCdibV9kYXRhcycpKSB7CiAgICAgICAgdGhpcy5pbml0U3RvcmFnZURhdGEoKTsKICAgICAgfQogICAgICAvLyB0aGlzLmdldENvbmZpZygpOwogICAgICBsZXQgcGFyYW1zID0gd2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtKCdibV9kYXRhcycpOwogICAgICBpZihwYXJhbXMgJiYgdHlwZW9mIHBhcmFtcyA9PT0gJ3N0cmluZycpIHsKICAgICAgICBwYXJhbXMgPSBKU09OLnBhcnNlKHBhcmFtcykKICAgICAgfQogICAgICBpZighdGhpcy53ZWJDb25maWcpIHsKICAgICAgICB0aGlzLmluaXRDb25maWcoKTsKICAgICAgICB0aGlzLmdldENvbmZpZygpOwogICAgICB9CiAgICAgIGlmKHN0YXRlID09PSAnY3VzdG9tJykgewogICAgICAgIHBhcmFtcy5zYXZlX2RhdGFfY3VzdG9tLnVuc2hpZnQob2JqKTsKICAgICAgICB0aGlzLndlYkNvbmZpZy5jdXN0b20gPSBwYXJzZUludCh0aGlzLndlYkNvbmZpZy5jdXN0b20pID4gMTAwID8gcGFyc2VJbnQodGhpcy53ZWJDb25maWcuY3VzdG9tKSA6IDEwMDsKICAgICAgICBpZihwYXJhbXMuc2F2ZV9kYXRhX2N1c3RvbS5sZW5ndGggPiAgdGhpcy53ZWJDb25maWcuY3VzdG9tKSB7CiAgICAgICAgICBwYXJhbXMuc2F2ZV9kYXRhX2N1c3RvbSA9IHBhcmFtcy5zYXZlX2RhdGFfY3VzdG9tLnNsaWNlKDAsIHRoaXMud2ViQ29uZmlnLmN1c3RvbSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHBhcmFtcy5zYXZlX2RhdGFfYXV0by51bnNoaWZ0KG9iaik7CiAgICAgICAgdGhpcy53ZWJDb25maWcuYXV0byA9IHBhcnNlSW50KHRoaXMud2ViQ29uZmlnLmF1dG8pID4gMTAwID8gcGFyc2VJbnQodGhpcy53ZWJDb25maWcuYXV0bykgOiAxMDA7CiAgICAgICAgaWYocGFyYW1zLnNhdmVfZGF0YV9hdXRvLmxlbmd0aCA+ICB0aGlzLndlYkNvbmZpZy5hdXRvKSB7CiAgICAgICAgICBwYXJhbXMuc2F2ZV9kYXRhX2F1dG8gPSBwYXJhbXMuc2F2ZV9kYXRhX2F1dG8uc2xpY2UoMCwgIHRoaXMud2ViQ29uZmlnLmF1dG8pOwogICAgICAgIH0KICAgICAgfQogICAgICB3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2JtX2RhdGFzJywgSlNPTi5zdHJpbmdpZnkocGFyYW1zKSk7CiAgICAgIGlmKHRoaXMuYWN0aXZlSGlzdG9yeUJvb2wpIHsKICAgICAgICB0aGlzLmdldFN0b3JhZ2VEYXRhKHRydWUpOwogICAgICB9CiAgICB9LAogICAgZ2V0U3RvcmFnZURhdGEocmVsb2FkQm9vbCkgewogICAgICBpZighcmVsb2FkQm9vbCkgewogICAgICAgIHRoaXMuYWN0aXZlSGlzdG9yeUJvb2wgPSAhdGhpcy5hY3RpdmVIaXN0b3J5Qm9vbDsKICAgICAgfQogICAgICB0aGlzLmN1cnJlbnRIaXN0b3J5SW5kZXggPSAtMTsKICAgICAgbGV0IHBhcmFtcyA9IHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnYm1fZGF0YXMnKTsKICAgICAgaWYocGFyYW1zICYmIHR5cGVvZiBwYXJhbXMgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgcGFyYW1zID0gSlNPTi5wYXJzZShwYXJhbXMpCiAgICAgIH0KICAgICAgbGV0IGxpc3QgPSBbXS5jb25jYXQocGFyYW1zLnNhdmVfZGF0YV9jdXN0b20sIHBhcmFtcy5zYXZlX2RhdGFfYXV0byk7CiAgICAgIHRoaXMuaGlzdG9yeUN1cnJuZXREYXRhID0gXy5vcmRlckJ5KGxpc3QsICd1cGRhdGVUaW1lJywgImRlc2MiKTsKICAgIH0sCiAgICBpbml0Q29uZmlnKCkgewogICAgICBpZih3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2JtX2RhdGFzJykpIHJldHVybjsKICAgICAgbGV0IHBhcmFtcyA9IHsKICAgICAgICBjdXN0b206NTAsCiAgICAgICAgYXV0bzo1MCwKICAgICAgfQogICAgICB3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2NvbmZpZ3MnLCBKU09OLnN0cmluZ2lmeShwYXJhbXMpKTsKICAgIH0sCiAgICBjbGVhclN0b3JhZ2VEYXRhKCkgewogICAgICB0aGlzLmluaXRTdG9yYWdlRGF0YSh0cnVlKTsKICAgICAgdGhpcy5nZXRTdG9yYWdlRGF0YSh0cnVlKTsKICAgIH0sCiAgICBzYXZlQ29uZmlncygpIHsKICAgICAgd2luZG93LmxvY2FsU3RvcmFnZS5zZXRJdGVtKCdjb25maWdzJywgSlNPTi5zdHJpbmdpZnkodGhpcy53ZWJDb25maWcpKTsKICAgIH0sCiAgICBnZXRDb25maWcoKSB7CiAgICAgIGxldCBwYXJhbXMgPSB3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2NvbmZpZ3MnKTsKICAgICAgaWYoIXBhcmFtcykgewogICAgICAgIHRoaXMuaW5pdENvbmZpZygpOwogICAgICB9CiAgICAgIGlmKHBhcmFtcyAmJiB0eXBlb2YgcGFyYW1zID09PSAnc3RyaW5nJykgewogICAgICAgIHBhcmFtcyA9IEpTT04ucGFyc2UocGFyYW1zKTsKICAgICAgfQogICAgICB0aGlzLndlYkNvbmZpZy5jdXN0b20gPSBwYXJhbXMuY3VzdG9tIHx8IDEwMDsKICAgICAgdGhpcy53ZWJDb25maWcuYXV0byA9IHBhcmFtcy5hdXRvIHx8IDEwMDsKICAgIH0sCiAgICBjaGFuZ2VCZ0ltZyh1cmwpIHsKICAgICAgdGhpcy5jb25maWdzLmJhY2tncm91bmRVcmwgPSB1cmw7CiAgICB9LAogICAgaW5pdEhpc3RvcnlMaXN0U3RhdGUoaW5kZXgpIHsKICAgICAgdGhpcy5jdXJyZW50SGlzdG9yeUluZGV4ID0gaW5kZXggPiAtMSA/IGluZGV4IDogLTE7CiAgICAgIGlmKEFycmF5LmlzQXJyYXkodGhpcy5oaXN0b3J5Q3Vycm5ldERhdGEpKSB7CiAgICAgICAgbGV0IGxlbiA9IHRoaXMuaGlzdG9yeUN1cnJuZXREYXRhLmxlbmd0aDsKICAgICAgICBmb3IobGV0IGk9MDtpPGxlbjtpKyspIHsKICAgICAgICAgICAgaWYodGhpcy5oaXN0b3J5Q3Vycm5ldERhdGEgJiYgdGhpcy5oaXN0b3J5Q3Vycm5ldERhdGFbaV0pIHsKICAgICAgICAgICAgIHRoaXMuaGlzdG9yeUN1cnJuZXREYXRhW2ldLmlzQWN0aXZlID0gZmFsc2U7CiAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGFwcGx5SGlzdG9yeShsaXN0KSB7CiAgICAgIHRoaXMuZWRyYXdDb21wb25lbnRzID0gbGlzdDsKICAgICAgdGhpcy5pbml0Q29tcFN0YXRlKCk7CiAgICAgIHRoaXMuY2xvc2VIaXN0b3J5KCk7CiAgICB9LAogICAgY2xvc2VIaXN0b3J5KCkgewogICAgICB0aGlzLmFjdGl2ZUhpc3RvcnlCb29sID0gZmFsc2U7CiAgICB9LAogICAgY2xlcmFySGlzdG9yeURhdGEoKXsKICAgICAgdGhpcy5pbml0U3RvcmFnZURhdGEodHJ1ZSk7CiAgICB9LAogICAgZWxpbWluYXRlR2hvc3RpbmcoZXZlbnQpIHsKICAgICAgbGV0IGRyYWdJY29uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJyk7CiAgICAgIGRyYWdJY29uLnNyYyA9ICdkYXRhOmltYWdlL2dpZjtiYXNlNjQsUjBsR09EbGhBUUFCQUlBQUFBQUFBUC8vL3lINUJBRUFBQUFBTEFBQUFBQUJBQUVBQUFJQlJBQTcnLAogICAgICBkcmFnSWNvbi53aWR0aCA9IDA7CiAgICAgIGRyYWdJY29uLmhlaWdodCA9IDA7CiAgICAgIGRyYWdJY29uLm9wYWNpdHkgPSAwOwogICAgICBpZihldmVudCAmJiBldmVudC5kYXRhVHJhbnNmZXIpIHsKICAgICAgICBldmVudC5kYXRhVHJhbnNmZXIuc2V0RHJhZ0ltYWdlKGRyYWdJY29uLDAsIDApOwogICAgICB9CgogICAgfQogIH0KfQo="},{"version":3,"sources":["editor.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqDA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA","file":"editor.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div id=\"editor\">\n    <!-- 组件库 -->\n    <editor-comps \n      v-bind:elements=\"edrawComponents\"\n      v-bind:webConfig=\"webConfig\"\n      v-on:initCompsState=\"initComponentState\" \n      v-on:selectComp=\"selectComp\"></editor-comps>\n    \n    <!-- 画布 -->\n    <editor-canvas \n      v-bind:configs=\"configs\"\n      v-bind:edrawComps=\"edrawComponents\"\n      v-bind:currentActiveIndex=\"eStates.currentActiveIndex\"\n      v-bind:multipleActiveBool=\"eStates.multipleActiveBool\"\n      v-on:initCompsState=\"initComponentState\" \n      v-on:dragComp=\"dragCurrentComp\"\n      v-on:resizeByDragComp=\"resizeByDragComp\"\n      v-on:trans=\"transComp\"\n      v-on:changeTextVal=\"changeTextVal\"\n      v-on:screen=\"screen\"></editor-canvas>\n\n    <!-- 组件设置 -->\n    <editor-settings\n      v-bind:currentActiveIndex=\"eStates.currentActiveIndex\"\n      v-bind:currentElement=\"edrawComponents[eStates.currentActiveIndex]\"\n      v-bind:multipleActiveArr=\"eStates.multipleActiveArr\"\n      v-bind:configs=\"configs\"\n      v-on:delComp=\"delComp\"\n      v-on:delMultipComp=\"delMultipComp\"\n      v-on:setMultipleState=\"setMultipleState\"\n      v-on:changeConfig=\"changeConfig\"\n      v-on:download=\"download\"\n      v-on:screen=\"screen\"\n      v-on:saveDateToStorage=\"saveDateToStorage\"\n      v-on:getHistory=\"getStorageData\"\n      v-on:changeBgImg=\"changeBgImg\"></editor-settings>\n    \n    <editor-history \n      v-if=\"activeHistoryBool\"\n      v-bind:list=\"historyCurrnetData\"\n      v-bind:currentIndex=\"currentHistoryIndex\"\n      v-on:initState=\"initHistoryListState\"\n      v-on:applyHistory=\"applyHistory\"\n      v-on:closeHistory=\"closeHistory\"\n      v-on:clerarHistoryData=\"clearStorageData\"\n      ></editor-history>\n    <!-- 帮助 -->\n    <editor-help/>\n  </div>\n</template>\n\n<script>\nimport EditorComps from './editor-comps';\nimport EditorCanvas from './editor-canvas';\nimport EditorSettings from './editor-settings';\nimport EditorHelp from './editor-help';\nimport EditorHistory from './editor-history';\nimport _ from 'lodash';  \n\nexport default {\n  name: 'Editor',\n  created:function() {\n    this.initStorageData();\n    this.initBindingEvent();\n    this.initData\n  },\n  mounted:function() {\n    this.getConfig();\n  },\n  \n  data(){\n     return {\n        eStates:{\n          currentActiveIndex:-1,\n          copyByKeyBool:false,\n          multipleActiveArr:[],\n        },\n        edrawComponents:[],\n        configs:{\n          bg:\"grid\",\n          pageName:'底图',\n          spacing:10,\n          scale:1,\n          dragIconSize:2,\n          Isometric_row:10,\n          Isometric_colu:10,\n          dowloadImgType:'png',\n          bgAllBool:false,\n          window_w:1920,\n          window_h:900,\n          backgroundUrl:\"\",\n        },\n        webConfig: {\n          custom: 30,\n          auto:30,\n        },\n        historyCurrnetData:[],\n        currentHistoryIndex:-1,\n        activeHistoryBool:false\n     }\n  },\n  components: {\n    'editor-comps':EditorComps,\n    'editor-canvas':EditorCanvas,\n    'editor-settings':EditorSettings,\n    'editor-help':EditorHelp,\n    'editor-history':EditorHistory\n  },\n  methods: {\n    initData() {\n      this.activeHistoryBool = false;\n      this.getConfig();\n    },\n    initBindingEvent() {\n      document.addEventListener('keydown', this.kaydownFun, false);\n      document.addEventListener('mousedown', this.mousedownFun);\n      window.addEventListener('beforeunload', this.leaving);\n    },\n    leaving(event) {\n      this.saveConfigs();\n      this.saveDateToStorage();\n      console.log(event.returnValue)\n      // let message = \"内容更改，注意截图缓存\"; \n      // event.returnValue = message;\n      // return message;\n    },\n    download:function() {\n      //TODO:页面下载\n    },\n    saveAs:function(img) {\n      let _dom = window.document.createElement('a');\n        _dom.href = img\n        _dom.dataset.downloadurl = ['image/png', 'IMG_DOWNLOAD_NAME', _dom.href].join(':');\n        document.body.appendChild(_dom);\n        _dom.click();\n        document.body.removeChild(_dom);\n    },\n    // 组件选择\n    selectComp(event, comp) {\n      let item = JSON.parse(JSON.stringify(comp));\n      if(!item) return;\n      this.initCompState();\n      item.isActive = true;\n      item.multipleActiveBool=false;\n      let rect = document.getElementById('canvas').getClientRects()[0];\n      let {width, height, borderRadius, rotate, borderWidth, background, isApplyShadow, bgiBool} = item.defStyle;\n      let {clientX , clientY} = event;\n      let _style = {\n          width:width || 100,\n          height:height || 100,\n          top: clientY  - rect.top + 60 || 100,\n          left:clientX + 213 - rect.left || 100,\n          rotate: rotate || 0,\n          drag_start_x: 0, //拖拽相对\n          drag_start_y :0,\n          borderWidth:borderWidth || 0,\n          background:background,\n          isApplyShadow:isApplyShadow  === undefined || isApplyShadow === null ? 'true' : 'false',\n          position:'absolute',\n          isFixed:\"false\",\n          bgiBool:bgiBool || false, //材质\n          borderRadius:borderRadius || 0,\n          fontSize: 14,\n      }\n      _style.left =Math.max(0,  Math.min(_style.left, 2130));\n      _style.top =Math.max(0,  Math.min(_style.top, 1140));\n      item.style = _style;\n      this.edrawComponents.push(item);\n      this.eStates.currentActiveIndex = this.edrawComponents.length -1;\n    },\n    initComponentState(current, event) {\n      if(current === undefined || current === null || current === -1) return;\n      if(event && (event.shiftKey || event.metaKey && this.isMac()) && event.button === 0 ) {\n        this.edrawComponents[current].isActive = false;\n        if(this.eStates.currentActiveIndex > -1) {\n          this.eStates.currentActiveIndex = -1;\n        }\n\n        // 多选操作缓存数组\n        const _multipActiveIndex = this.eStates.multipleActiveArr.indexOf(this.edrawComponents[current]);\n        if( _multipActiveIndex === -1) {\n          this.eStates.multipleActiveArr.push(this.edrawComponents[current])\n        }\n\n        if(this.edrawComponents[current].multipleActiveBool) {\n          this.edrawComponents[current].multipleActiveBool = false;\n          this.eStates.multipleActiveArr.splice(_multipActiveIndex, 1);\n        } else {\n          this.edrawComponents[current].multipleActiveBool = true;\n        }\n      }else {\n        this.initCompState();     \n        this.eStates.currentActiveIndex = current;\n        this.edrawComponents[current].isActive = true;\n      }\n\n    },\n    // 初始化画布内组件状态\n    initCompState() {\n      let len = this.edrawComponents.length;\n      this.eStates.multipleActiveArr = [];\n      for(let i=0;i<len;i++) {\n        this.edrawComponents[i].isActive = false;\n        this.edrawComponents[i].multipleActiveBool = false;\n      }\n      this.eStates.copyByKeyBool = false;\n    },\n    // 组件拖拽：shiftKey === true 处理多选\n    dragCurrentComp(event, comp, state, currentIndex, canvesRect) {\n      if(event && (event.shiftKey || event.metaKey && this.isMac())  ){\n        console.log('多选处理')\n      } else {\n        this.eStates.copyByKeyBool = false;\n        let _rect = document.getElementById('canvas').getClientRects()[0]\n        let _l =_rect.left;\n        let _t =_rect.left;\n        if(state === 'start') {\n          this.eStates.currentActiveIndex = currentIndex;\n          comp.style.drag_start_x = event.clientX - comp.style.left - _l + canvesRect.x;\n          comp.style.drag_start_y = event.clientY - comp.style.top - _t + canvesRect.y;\n        }else if(state === 'drag'){\n          let _left = event.clientX - comp.style.drag_start_x  - _l + canvesRect.x; \n          let _top = event.clientY - comp.style.drag_start_y - _t + canvesRect.y ;\n          if(_left <0 || _top < 0) return;\n          _left =Math.max(0,  Math.min(_left, 2130));\n          _top = Math.max(0, Math.min(_top, 1140));\n          comp.style.left = _left;\n          comp.style.top = _top ;\n        }\n        if(['start', 'drag'].indexOf(state) > -1) {\n          this.eliminateGhosting(event); // 消除拖拽鬼影\n        } \n        \n      }\n    },\n    resizeByDragComp(event, comp, state, arrow,currentIndex) {\n      if(event && (event.shiftKey || event.metaKey && this.isMac())  ){\n        console.log('多选处理')\n      } else {\n        this.eStates.copyByKeyBool = false;\n        let _l = document.getElementById('canvas').getClientRects()[0].left;\n        let _t = document.getElementById('canvas').getClientRects()[0].top;\n        if(state === 'start') {\n          this.eStates.currentActiveIndex = currentIndex;\n          comp.style.drag_start_x = arrow === 'r' ? comp.style.left:\n                                    arrow === 'l' ?comp.style.left + comp.style.width + _l - 213 :\n                                    10;\n          comp.style.drag_start_y = arrow === 'b' ? comp.style.top  :\n                                    arrow === 't' ?comp.style.top + comp.style.height  :\n                                    10;\n        }else if(state === 'drag'){\n          let _width = 0;\n          let _top = 0;\n          let _height = 0;\n     \n          switch(arrow) {\n            case 'r':\n              _width = event.clientX - comp.style.drag_start_x + 213 - _l ; \n              _width = Math.min(_width, 2130);\n              comp.style.width = _width >= 10 ? _width: 10;\n              break;\n            case 'l':\n              comp.style.left = event.clientX  + 213 - _l; \n              _width = comp.style.drag_start_x - event.clientX;\n              _width =Math.max(0,  Math.min(_width, 2130));\n              comp.style.width = _width >= 10 ? _width: 10;\n              break;\n            case 't':\n              comp.style.top = event.clientY;\n              _height = comp.style.drag_start_y - event.clientY;\n              _height =Math.max(10,  Math.min(_height, 2130));\n              comp.style.height = _height >= 10 ? _height : 10;\n              break;\n            case 'b':\n              _top = _t >=0 ? (event.clientY - comp.style.drag_start_y) :event.clientY - comp.style.drag_start_y - _t  + 60;\n              _top = Math.max(10, Math.min(_top, 2130));\n              comp.style.height = _top >= 10 ? _top: 10;\n              break;\n            default:\n              break\n          }\n        }\n      }\n    },\n    transComp(event, comp){\n        let _x = event.clientX - comp.style.left - comp.style.width / 2;\n        let _y = event.clientY - comp.style.top - comp.style.height / 2;\n        comp.style.rotate = this.calcAngleDegrees(_x, _y);\n    },\n    changeTextVal(event, item) {\n      if(event && item) {\n         item.value = event.target.innerText;\n      }\n    },\n    // 组件删除\n    delComp(index, state) {\n      if(state === 'multipleDel') {\n        let len = this.edrawComponents.length;\n        this.eStates.multipleActiveArr = [];\n        for(let i=len;i--;i >0) {\n          let multipBool = this.edrawComponents[i].multipleActiveBool;\n          if(multipBool) {\n            this.edrawComponents.splice(i,1)\n          }\n        }\n      } else {\n        if(this.eStates.currentActiveIndex > -1 &&this.edrawComponents.length > 0) {\n          this.edrawComponents.splice(this.eStates.currentActiveIndex,1)\n          this.eStates.currentActiveIndex = -1;\n        }\n      }\n    },\n    // 键盘事件\n    kaydownFun(event) {\n      if(event.key === 'v' && document.activeElement.nodeName === 'INPUT') {\n        return;\n      }else if(event.key === 'c' &&  document.activeElement.nodeName === 'INPUT') {\n        document.activeElement.blur();\n      }\n      if(event.target.nodeName === 'INPUT' && this.eStates.copyByKeyBool) {\n         this.eStates.copyByKeyBool = false;\n      }\n      if(event.key === 'c') {\n        this.eStates.copyByKeyBool = true;\n      }else if(this.eStates.copyByKeyBool && event.key === 'v') {\n        this.copyCurrentComp();\n      }else if(event.target.nodeName !== 'INPUT'){\n        if(['ArrowUp','ArrowDown','ArrowLeft',\"ArrowRight\"].indexOf(event['code'])> -1) {\n          event.preventDefault();\n          if(this.eStates.currentActiveIndex > -1 && this.eStates.multipleActiveArr.length === 0) {\n            this.arrowItem(event['code'], this.edrawComponents[this.eStates.currentActiveIndex])\n          }else if(this.eStates.multipleActiveArr.length > 0){\n            let len = this.eStates.multipleActiveArr.length;\n            for(let i=0;i<len;i++){\n               this.arrowItem(event['code'], this.eStates.multipleActiveArr[i])\n            }\n          }\n        }\n      }\n      if(event.key === 'Delete' || this.isMac() && event.key === 'Backspace')  {\n        console.log(event.target)\n        if(!(event.target.innerHTML && event.target.contentEditable)) {\n          this.delComp();\n        }\n      }\n    },\n    arrowItem(arrow, obj) {\n      if(arrow && obj) {\n        switch (arrow) {\n          case 'ArrowUp' :\n            obj.style.top = (obj.style.top - 1) > 0 ? ( obj.style.top - 1) : 0;\n            break;\n          case 'ArrowDown' :\n            obj.style.top = obj.style.top + 1;\n            break;\n          case 'ArrowLeft' :\n            obj.style.left = (obj.style.left -1 )> 0? (obj.style.left -1) : 0;\n            break;\n          case 'ArrowRight':\n            obj.style.left =  obj.style.left +1;\n            break;\n          default:\n            break;\n        }\n      }\n    },\n    // 多选事件\n    mousedownFun(event) {\n      this.eliminateGhosting(event); // 消除拖拽鬼影\n      if(event && event.shiftKey && this.eStates.currentActiveIndex > -1) {\n        this.edrawComponents[this.eStates.currentActiveIndex].isActive = false;\n        this.eStates.currentActiveIndex = -1;\n      }\n      if((!event.shiftKey || !event.metaKey && this.isMac()) && event.button === 0 \n        && event.target.id==='canvas' \n        && !event.target.classList.contains('comp-element')) {\n        this.eStates.copyByKeyBool = false;\n        this.initCompState();\n      } \n    },\n    // 创建当前组件\n    copyCurrentComp:function() {\n      let _currComp = this.edrawComponents[this.eStates.currentActiveIndex];\n      if(!_currComp) return;\n      _currComp.isActive = false;\n      let _copy = JSON.parse(JSON.stringify(_currComp));\n      let _style = _currComp.style;\n      let _val = 10;\n      let _h = _val;\n      _copy.style.top = parseInt(_style.height) + parseInt(_style.top) + parseInt(_h);\n      _copy.style.top = Math.max(0, Math.min(_copy.style.top, 1080));\n      _copy.isActive = true;\n      this.edrawComponents.push(_copy);\n      this.eStates.currentActiveIndex = this.edrawComponents.length - 1; //更新激活组件的下标\n    },\n    // 多选操作:反选/清空多选/属性应用\n    setMultipleState:function(state, value) {\n      if(state === 'Isometric') {\n        for(let i = this.eStates.multipleActiveArr.length-1;i>=0;i--) {\n          let obj = this.eStates.multipleActiveArr[i];\n          let bool = obj['multipleActiveBool'];\n          if(!bool) {\n            this.eStates.multipleActiveArr.splice(i,1);\n          }\n        }\n        let len = this.eStates.multipleActiveArr.length;\n        let val = 0;\n        if(value === 'row') {\n          this.eStates.multipleActiveArr =  this.eStates.multipleActiveArr.sort(function(a,b){\n            return a.style.left - b.style.left;\n          })\n          for(let i=0;i< len;i++) {\n            let item = this.eStates.multipleActiveArr[i];\n            if(i>0) {\n              item.style.left = val;\n            }\n            val = item.style.left + item.style.width + parseInt(this.configs.Isometric_row);\n            val = Math.max(0, Math.min(val, 2130));\n          }\n        } else {\n          this.eStates.multipleActiveArr =  this.eStates.multipleActiveArr.sort(function(a,b){\n            return a.style.top - b.style.top ;\n          })\n          for(let i=0;i< len;i++) {\n            let item = this.eStates.multipleActiveArr[i];\n            if(i>0) {\n              item.style.top = val;\n            }\n            val = item.style.height + item.style.top + parseInt(this.configs.Isometric_colu);\n            val = Math.max(0,  Math.min(val, 1140));\n          }\n        }     \n      }else if(state === 'reSel') {\n        let len = this.edrawComponents.length;\n        this.eStates.multipleActiveArr = [];\n        for(let i=len;i--;i >0) {\n          let item = this.edrawComponents[i];\n          if(!item.multipleActiveBool) {  \n            this.eStates.multipleActiveArr.push(item);\n          }\n          item.multipleActiveBool = !item.multipleActiveBool;\n        }\n      } else if(state === 'clear'){\n        let len = this.edrawComponents.length;\n        this.eStates.multipleActiveArr = [];\n        for(let i=len;i--;i >0) {\n          this.edrawComponents[i].multipleActiveBool = false;\n        }\n      }else if(['isApplyShadow', 'borderRadius'].indexOf(state) > -1) {\n        let len = this.eStates.multipleActiveArr.length;\n        for(let i=len;i--;i >0) {\n          this.eStates.multipleActiveArr[i].style[state] = value;\n        }\n      }else if(state === 'align') {\n        switch(value) {\n          case 't' :\n            this.multipArray('top');\n            break;\n          case 'l' :\n            this.multipArray('left');\n            break;\n          case 'b' :\n            this.multipArray('bottom');\n            break;\n          case 'r' :\n            this.multipArray('right');\n            break;\n          default:\n            break;\n        }\n      }\n    },\n    // 删除多选元素\n    delMultipComp(comp, index) {\n      this.eStates.multipleActiveArr.splice(index, 1);\n      let _index = this.edrawComponents.indexOf(comp);\n      if(_index > -1) {\n        this.edrawComponents[_index].multipleActiveBool = false;\n      }\n    },\n    changeConfig(state, value){\n      if(!this.configs[state]) return;\n      if(state === 'bg') {\n        this.changeBgImg()\n      }\n      this.configs[state] = value;\n    },\n    multipArray(param) {\n      let list = JSON.parse(JSON.stringify(this.eStates.multipleActiveArr));\n      list.sort(function(a, b) {\n        return ['top', 'left'].indexOf(param) > -1 ? a.style[param] - b.style[param]:\n          param === 'bottom' ?  b.style.top + b.style.height - (a.style.top + a.style.height) :\n          b.style.left + b.style.width - (a.style.left + a.style.width) \n      });\n      let len = this.eStates.multipleActiveArr.length;\n      let resObj = list[0];\n      if(['top', 'left'].indexOf(param) > -1) {\n        for(let i=0;i<len;i++) {\n          this.eStates.multipleActiveArr[i].style[param] = resObj.style[param];\n        }\n      }else if(param === 'bottom') {\n        let _bottom = resObj.style.top + resObj.style.height;\n        for(let i=0;i<len;i++) {\n          this.eStates.multipleActiveArr[i].style.top = _bottom - this.eStates.multipleActiveArr[i].style.height;\n        }\n      }else if(param === 'right') {\n        let _right = resObj.style.left + resObj.style.width;\n        for(let i=0;i<len;i++) {\n          this.eStates.multipleActiveArr[i].style.left = _right - this.eStates.multipleActiveArr[i].style.width;\n        }\n      }\n    },\n    isMac:function() {\n      return /macintosh|mac os x/i.test(navigator.userAgent)\n    },\n    calcAngleDegrees(x, y) {\n      let val =  Math.atan2(y, x) * 180 / Math.PI;\n      return Math.ceil(val);\n    },\n    screen:function() {\n      this.configs.bgAllBool = !this.configs.bgAllBool;\n      if(this.configs.bgAllBool) {\n        this.configs.window_w = window.screen.width > 1500 ? window.screen.width : 1500;\n        this.configs.window_h = window.screen.height > 800 ? window.screen.height : 800;\n        this.configs.scale = 1;\n      }\n    },\n    initStorageData(clearBool) {\n      if(!clearBool && window.localStorage.getItem('bm_datas')) return;\n      let params = {\n          save_data_auto:[],\n          save_data_custom:[]\n      }\n      window.localStorage.setItem('bm_datas', JSON.stringify(params));\n    },\n    saveDateToStorage(data, state) {\n      let saveData = data || this.edrawComponents;\n      //存储优化，没有内容的页面不需要存储\n      if(!saveData || Array.isArray(saveData) && saveData.length === 0) {\n        return;\n      }\n      let obj = {\n        data: saveData,\n        type: state || 'auto',\n        updateTime:new Date()\n      };\n      if(!window.localStorage.getItem('bm_datas')) {\n        this.initStorageData();\n      }\n      // this.getConfig();\n      let params = window.localStorage.getItem('bm_datas');\n      if(params && typeof params === 'string') {\n        params = JSON.parse(params)\n      }\n      if(!this.webConfig) {\n        this.initConfig();\n        this.getConfig();\n      }\n      if(state === 'custom') {\n        params.save_data_custom.unshift(obj);\n        this.webConfig.custom = parseInt(this.webConfig.custom) > 100 ? parseInt(this.webConfig.custom) : 100;\n        if(params.save_data_custom.length >  this.webConfig.custom) {\n          params.save_data_custom = params.save_data_custom.slice(0, this.webConfig.custom);\n        }\n      } else {\n        params.save_data_auto.unshift(obj);\n        this.webConfig.auto = parseInt(this.webConfig.auto) > 100 ? parseInt(this.webConfig.auto) : 100;\n        if(params.save_data_auto.length >  this.webConfig.auto) {\n          params.save_data_auto = params.save_data_auto.slice(0,  this.webConfig.auto);\n        }\n      }\n      window.localStorage.setItem('bm_datas', JSON.stringify(params));\n      if(this.activeHistoryBool) {\n        this.getStorageData(true);\n      }\n    },\n    getStorageData(reloadBool) {\n      if(!reloadBool) {\n        this.activeHistoryBool = !this.activeHistoryBool;\n      }\n      this.currentHistoryIndex = -1;\n      let params = window.localStorage.getItem('bm_datas');\n      if(params && typeof params === 'string') {\n        params = JSON.parse(params)\n      }\n      let list = [].concat(params.save_data_custom, params.save_data_auto);\n      this.historyCurrnetData = _.orderBy(list, 'updateTime', \"desc\");\n    },\n    initConfig() {\n      if(window.localStorage.getItem('bm_datas')) return;\n      let params = {\n        custom:50,\n        auto:50,\n      }\n      window.localStorage.setItem('configs', JSON.stringify(params));\n    },\n    clearStorageData() {\n      this.initStorageData(true);\n      this.getStorageData(true);\n    },\n    saveConfigs() {\n      window.localStorage.setItem('configs', JSON.stringify(this.webConfig));\n    },\n    getConfig() {\n      let params = window.localStorage.getItem('configs');\n      if(!params) {\n        this.initConfig();\n      }\n      if(params && typeof params === 'string') {\n        params = JSON.parse(params);\n      }\n      this.webConfig.custom = params.custom || 100;\n      this.webConfig.auto = params.auto || 100;\n    },\n    changeBgImg(url) {\n      this.configs.backgroundUrl = url;\n    },\n    initHistoryListState(index) {\n      this.currentHistoryIndex = index > -1 ? index : -1;\n      if(Array.isArray(this.historyCurrnetData)) {\n        let len = this.historyCurrnetData.length;\n        for(let i=0;i<len;i++) {\n            if(this.historyCurrnetData && this.historyCurrnetData[i]) {\n             this.historyCurrnetData[i].isActive = false;\n           }\n        }\n      }\n    },\n    applyHistory(list) {\n      this.edrawComponents = list;\n      this.initCompState();\n      this.closeHistory();\n    },\n    closeHistory() {\n      this.activeHistoryBool = false;\n    },\n    clerarHistoryData(){\n      this.initStorageData(true);\n    },\n    eliminateGhosting(event) {\n      let dragIcon = document.createElement('img');\n      dragIcon.src = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7',\n      dragIcon.width = 0;\n      dragIcon.height = 0;\n      dragIcon.opacity = 0;\n      if(event && event.dataTransfer) {\n        event.dataTransfer.setDragImage(dragIcon,0, 0);\n      }\n\n    }\n  }\n}\n</script>\n\n<style>\n\n#editor {\n  margin-top: 60px;\n  padding: 0;\n  position: relative;\n  color: #2c3e50;\n  display: grid;\n  grid-template-columns: 205px auto 205px;\n}\n</style>\n"]}]}