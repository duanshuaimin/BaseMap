{"remainingRequest":"/Users/liangma/Desktop/workspace/BaseMap/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/liangma/Desktop/workspace/BaseMap/src/components/editor.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/liangma/Desktop/workspace/BaseMap/src/components/editor.vue","mtime":1591367189478},{"path":"/Users/liangma/Desktop/workspace/BaseMap/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/liangma/Desktop/workspace/BaseMap/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/liangma/Desktop/workspace/BaseMap/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/liangma/Desktop/workspace/BaseMap/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBWdWUgZnJvbSAndnVlJzsKaW1wb3J0IEVkaXRvckNvbXBzIGZyb20gJy4vZWRpdG9yLWNvbXBzJzsKaW1wb3J0IEVkaXRvckNhbnZhcyBmcm9tICcuL2VkaXRvci1jYW52YXMnOwppbXBvcnQgRWRpdG9yU2V0dGluZ3MgZnJvbSAnLi9lZGl0b3Itc2V0dGluZ3MnOwppbXBvcnQgRWRpdG9ySGVscCBmcm9tICcuL2VkaXRvci1oZWxwJzsKaW1wb3J0IEVkaXRvckhpc3RvcnkgZnJvbSAnLi9lZGl0b3ItaGlzdG9yeSc7CmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7ICAKCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnRWRpdG9yJywKICBjcmVhdGVkOmZ1bmN0aW9uKCkgewogICAgdGhpcy5pbml0U3RvcmFnZURhdGEoKTsKICAgIHRoaXMuaW5pdEJpbmRpbmdFdmVudCgpOwogICAgdGhpcy5pbml0RGF0YQogIH0sCiAgbW91bnRlZDpmdW5jdGlvbigpIHsKCiAgfSwKICAKICBkYXRhKCl7CiAgICAgcmV0dXJuIHsKICAgICAgICBlU3RhdGVzOnsKICAgICAgICAgIGN1cnJlbnRBY3RpdmVJbmRleDotMSwKICAgICAgICAgIGNvcHlCeUtleUJvb2w6ZmFsc2UsCiAgICAgICAgICBtdWx0aXBsZUFjdGl2ZUFycjpbXSwKICAgICAgICB9LAogICAgICAgIGVkcmF3Q29tcG9uZW50czpbXSwKICAgICAgICBjb25maWdzOnsKICAgICAgICAgIGJnOiJncmlkIiwKICAgICAgICAgIHBhZ2VOYW1lOiflupXlm74nLAogICAgICAgICAgc3BhY2luZzoxMCwKICAgICAgICAgIHNjYWxlOjEsCiAgICAgICAgICBkcmFnSWNvblNpemU6MiwKICAgICAgICAgIElzb21ldHJpY19yb3c6MTAsCiAgICAgICAgICBJc29tZXRyaWNfY29sdToxMCwKICAgICAgICAgIGRvd2xvYWRJbWdUeXBlOidwbmcnLAogICAgICAgICAgYmdBbGxCb29sOmZhbHNlLAogICAgICAgICAgd2lkdGg6IDI5NDUsCiAgICAgICAgICBoZWlnaHQ6IDE0NDUsCiAgICAgICAgICBtYXhXaWR0aDozNDQ1LAogICAgICAgICAgbWF4SGllZ2h0OjE1MDUsCiAgICAgICAgICBiYWNrZ3JvdW5kVXJsOiIiLAogICAgICAgIH0sCiAgICAgICAgd2ViQ29uZmlnOiB7CiAgICAgICAgICBjdXN0b206IDI1LAogICAgICAgICAgYXV0bzo1LAogICAgICAgIH0sCiAgICAgICAgaGlzdG9yeUN1cnJuZXREYXRhOltdLAogICAgICAgIGN1cnJlbnRIaXN0b3J5SW5kZXg6LTEsCiAgICAgICAgYWN0aXZlSGlzdG9yeUJvb2w6ZmFsc2UKICAgICB9CiAgfSwKICBjb21wb25lbnRzOiB7CiAgICAnZWRpdG9yLWNvbXBzJzpFZGl0b3JDb21wcywKICAgICdlZGl0b3ItY2FudmFzJzpFZGl0b3JDYW52YXMsCiAgICAnZWRpdG9yLXNldHRpbmdzJzpFZGl0b3JTZXR0aW5ncywKICAgICdlZGl0b3ItaGVscCc6RWRpdG9ySGVscCwKICAgICdlZGl0b3ItaGlzdG9yeSc6RWRpdG9ySGlzdG9yeQogIH0sCiAgbWV0aG9kczogewogICAgaW5pdERhdGEoKSB7CiAgICAgIHRoaXMuYWN0aXZlSGlzdG9yeUJvb2wgPSBmYWxzZTsKICAgIH0sCiAgICBpbml0QmluZGluZ0V2ZW50KCkgewogICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgdGhpcy5rYXlkb3duRnVuLCBmYWxzZSk7CiAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIHRoaXMubW91c2Vkb3duRnVuKTsKICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2JlZm9yZXVubG9hZCcsIHRoaXMubGVhdmluZyk7CiAgICB9LAogICAgbGVhdmluZyhldmVudCkgewogICAgICAvLyB0aGlzLnNhdmVEYXRlVG9TdG9yYWdlKCk7CiAgICAgIC8vIGNvbnNvbGUubG9nKGV2ZW50LnJldHVyblZhbHVlKQogICAgICBsZXQgbWVzc2FnZSA9ICLlhoXlrrnmm7TmlLnvvIzms6jmhI/miKrlm77nvJPlrZgiOyAKICAgICAgZXZlbnQucmV0dXJuVmFsdWUgPSBtZXNzYWdlOwogICAgICByZXR1cm4gbWVzc2FnZTsKICAgIH0sCiAgICBkb3dubG9hZDpmdW5jdGlvbigpIHsKICAgICAgLy9UT0RPOumhtemdouS4i+i9vQogICAgfSwKICAgIHNhdmVBczpmdW5jdGlvbihpbWcpIHsKICAgICAgbGV0IF9kb20gPSB3aW5kb3cuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOwogICAgICAgIF9kb20uaHJlZiA9IGltZwogICAgICAgIF9kb20uZGF0YXNldC5kb3dubG9hZHVybCA9IFsnaW1hZ2UvcG5nJywgJ0lNR19ET1dOTE9BRF9OQU1FJywgX2RvbS5ocmVmXS5qb2luKCc6Jyk7CiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChfZG9tKTsKICAgICAgICBfZG9tLmNsaWNrKCk7CiAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChfZG9tKTsKICAgIH0sCiAgICAvLyDnu4Tku7bpgInmi6kKICAgIHNlbGVjdENvbXAoZXZlbnQsIGNvbXApIHsKICAgICAgbGV0IGl0ZW0gPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGNvbXApKTsKICAgICAgaWYoIWl0ZW0pIHJldHVybjsKICAgICAgdGhpcy5pbml0Q29tcFN0YXRlKCk7CiAgICAgIGl0ZW0uaXNBY3RpdmUgPSB0cnVlOwogICAgICBpdGVtLm11bHRpcGxlQWN0aXZlQm9vbD1mYWxzZTsKICAgICAgbGV0IHJlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FudmFzJykuZ2V0Q2xpZW50UmVjdHMoKVswXTsKICAgICAgbGV0IHsKICAgICAgICB3aWR0aCwgCiAgICAgICAgaGVpZ2h0LCAKICAgICAgICBib3JkZXJSYWRpdXMsIAogICAgICAgIHJvdGF0ZSwgCiAgICAgICAgYm9yZGVyV2lkdGgsIAogICAgICAgIGJhY2tncm91bmQsIAogICAgICAgIGlzQXBwbHlTaGFkb3csIAogICAgICAgIGJnaUJvb2wsIAogICAgICAgIGNvbG9yLAogICAgICAgIGJvcmRlciwKICAgICAgICBvcGFjaXR5IH0gPSBpdGVtLmRlZlN0eWxlOwogICAgICBsZXQge2NsaWVudFggLCBjbGllbnRZfSA9IGV2ZW50OwogICAgICBsZXQgX3N0eWxlID0gewogICAgICAgICAgd2lkdGg6d2lkdGggfHwgMTAwLAogICAgICAgICAgaGVpZ2h0OmhlaWdodCB8fCAxMDAsCiAgICAgICAgICB0b3A6IGNsaWVudFkgIC0gcmVjdC50b3AgKyA2MCB8fCAxMDAsCiAgICAgICAgICBsZWZ0OmNsaWVudFggKyAyMTMgLSByZWN0LmxlZnQgfHwgMTAwLAogICAgICAgICAgcm90YXRlOiByb3RhdGUgfHwgMCwKICAgICAgICAgIGRyYWdfc3RhcnRfeDogMCwgLy/mi5bmi73nm7jlr7kKICAgICAgICAgIGRyYWdfc3RhcnRfeSA6MCwKICAgICAgICAgIGJvcmRlcldpZHRoOmJvcmRlcldpZHRoIHx8IDAsCiAgICAgICAgICBiYWNrZ3JvdW5kOmJhY2tncm91bmQsCiAgICAgICAgICBpc0FwcGx5U2hhZG93OmlzQXBwbHlTaGFkb3cgID09PSB1bmRlZmluZWQgfHwgaXNBcHBseVNoYWRvdyA9PT0gbnVsbCA/ICd0cnVlJyA6ICdmYWxzZScsCiAgICAgICAgICBwb3NpdGlvbjonYWJzb2x1dGUnLAogICAgICAgICAgaXNGaXhlZDoiZmFsc2UiLAogICAgICAgICAgYmdpQm9vbDpiZ2lCb29sIHx8IGZhbHNlLCAvL+adkOi0qAogICAgICAgICAgYm9yZGVyUmFkaXVzOmJvcmRlclJhZGl1cyB8fCAwLAogICAgICAgICAgYm9yZGVyOmJvcmRlciAsCiAgICAgICAgICBmb250U2l6ZTogMTQsCiAgICAgICAgICBvcGFjaXR5Om9wYWNpdHksCiAgICAgICAgICBjb2xvcjogY29sb3IKICAgICAgfQogICAgICBfc3R5bGUubGVmdCA9TWF0aC5tYXgoMCwgIE1hdGgubWluKF9zdHlsZS5sZWZ0LCB0aGlzLmNvbmZpZ3MubWF4V2lkdGgpKTsKICAgICAgX3N0eWxlLnRvcCA9TWF0aC5tYXgoMCwgIE1hdGgubWluKF9zdHlsZS50b3AsIHRoaXMuY29uZmlncy5tYXhIaWVnaHQpKTsKICAgICAgaXRlbS5zdHlsZSA9IF9zdHlsZTsKICAgICAgdGhpcy5lZHJhd0NvbXBvbmVudHMucHVzaChpdGVtKTsKICAgICAgdGhpcy5lU3RhdGVzLmN1cnJlbnRBY3RpdmVJbmRleCA9IHRoaXMuZWRyYXdDb21wb25lbnRzLmxlbmd0aCAtMTsKICAgIH0sCiAgICBpbml0Q29tcG9uZW50U3RhdGUoY3VycmVudCwgZXZlbnQpIHsKICAgICAgaWYoY3VycmVudCA9PT0gdW5kZWZpbmVkIHx8IGN1cnJlbnQgPT09IG51bGwgfHwgY3VycmVudCA9PT0gLTEpIHJldHVybjsKICAgICAgaWYoZXZlbnQgJiYgKGV2ZW50LnNoaWZ0S2V5IHx8IGV2ZW50Lm1ldGFLZXkgJiYgdGhpcy5pc01hYygpKSAmJiBldmVudC5idXR0b24gPT09IDAgKSB7CiAgICAgICAgdGhpcy5lZHJhd0NvbXBvbmVudHNbY3VycmVudF0uaXNBY3RpdmUgPSBmYWxzZTsKICAgICAgICBpZih0aGlzLmVTdGF0ZXMuY3VycmVudEFjdGl2ZUluZGV4ID4gLTEpIHsKICAgICAgICAgIHRoaXMuZVN0YXRlcy5jdXJyZW50QWN0aXZlSW5kZXggPSAtMTsKICAgICAgICB9CgogICAgICAgIC8vIOWkmumAieaTjeS9nOe8k+WtmOaVsOe7hAogICAgICAgIGNvbnN0IF9tdWx0aXBBY3RpdmVJbmRleCA9IHRoaXMuZVN0YXRlcy5tdWx0aXBsZUFjdGl2ZUFyci5pbmRleE9mKHRoaXMuZWRyYXdDb21wb25lbnRzW2N1cnJlbnRdKTsKICAgICAgICBpZiggX211bHRpcEFjdGl2ZUluZGV4ID09PSAtMSkgewogICAgICAgICAgdGhpcy5lU3RhdGVzLm11bHRpcGxlQWN0aXZlQXJyLnB1c2godGhpcy5lZHJhd0NvbXBvbmVudHNbY3VycmVudF0pCiAgICAgICAgfQoKICAgICAgICBpZih0aGlzLmVkcmF3Q29tcG9uZW50c1tjdXJyZW50XS5tdWx0aXBsZUFjdGl2ZUJvb2wpIHsKICAgICAgICAgIHRoaXMuZWRyYXdDb21wb25lbnRzW2N1cnJlbnRdLm11bHRpcGxlQWN0aXZlQm9vbCA9IGZhbHNlOwogICAgICAgICAgdGhpcy5lU3RhdGVzLm11bHRpcGxlQWN0aXZlQXJyLnNwbGljZShfbXVsdGlwQWN0aXZlSW5kZXgsIDEpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLmVkcmF3Q29tcG9uZW50c1tjdXJyZW50XS5tdWx0aXBsZUFjdGl2ZUJvb2wgPSB0cnVlOwogICAgICAgIH0KICAgICAgfWVsc2UgewogICAgICAgIHRoaXMuaW5pdENvbXBTdGF0ZSgpOyAgICAgCiAgICAgICAgdGhpcy5lU3RhdGVzLmN1cnJlbnRBY3RpdmVJbmRleCA9IGN1cnJlbnQ7CiAgICAgICAgdGhpcy5lZHJhd0NvbXBvbmVudHNbY3VycmVudF0uaXNBY3RpdmUgPSB0cnVlOwogICAgICB9CiAgICB9LAogICAgLy8g5Yid5aeL5YyW55S75biD5YaF57uE5Lu254q25oCBCiAgICBpbml0Q29tcFN0YXRlKCkgewogICAgICBsZXQgbGVuID0gdGhpcy5lZHJhd0NvbXBvbmVudHMubGVuZ3RoOwogICAgICB0aGlzLmVTdGF0ZXMubXVsdGlwbGVBY3RpdmVBcnIgPSBbXTsKICAgICAgZm9yKGxldCBpPTA7aTxsZW47aSsrKSB7CiAgICAgICAgdGhpcy5lZHJhd0NvbXBvbmVudHNbaV0uaXNBY3RpdmUgPSBmYWxzZTsKICAgICAgICB0aGlzLmVkcmF3Q29tcG9uZW50c1tpXS5tdWx0aXBsZUFjdGl2ZUJvb2wgPSBmYWxzZTsKICAgICAgfQogICAgICB0aGlzLmVTdGF0ZXMuY29weUJ5S2V5Qm9vbCA9IGZhbHNlOwogICAgfSwKICAgIC8vIOe7hOS7tuaLluaLve+8mnNoaWZ0S2V5ID09PSB0cnVlIOWkhOeQhuWkmumAiQogICAgZHJhZ0N1cnJlbnRDb21wKGV2ZW50LCBjb21wLCBzdGF0ZSwgY3VycmVudEluZGV4LCBjYW52ZXNSZWN0KSB7CiAgICAgIGlmKGV2ZW50ICYmIChldmVudC5zaGlmdEtleSB8fCBldmVudC5tZXRhS2V5ICYmIHRoaXMuaXNNYWMoKSkgICl7CiAgICAgICAgY29uc29sZS5sb2coJ+WkmumAieWkhOeQhicpCiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5lU3RhdGVzLmNvcHlCeUtleUJvb2wgPSBmYWxzZTsKICAgICAgICBsZXQgX3JlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FudmFzJykuZ2V0Q2xpZW50UmVjdHMoKVswXQogICAgICAgIGxldCBfbCA9X3JlY3QubGVmdDsKICAgICAgICBsZXQgX3QgPV9yZWN0LmxlZnQ7CiAgICAgICAgaWYoc3RhdGUgPT09ICdzdGFydCcpIHsKICAgICAgICAgIHRoaXMuZVN0YXRlcy5jdXJyZW50QWN0aXZlSW5kZXggPSBjdXJyZW50SW5kZXg7CiAgICAgICAgICBjb25zb2xlLmxvZyggZXZlbnQuY2xpZW50WCAsIGNvbXAuc3R5bGUubGVmdCAsIF9sICwgY2FudmVzUmVjdC54LCB0aGlzLmNvbmZpZ3Muc2NhbGUpCiAgICAgICAgICBjb21wLnN0eWxlLmRyYWdfc3RhcnRfeCA9IGV2ZW50LmNsaWVudFggLSBjb21wLnN0eWxlLmxlZnQgLSBfbCArIGNhbnZlc1JlY3QueDsKICAgICAgICAgIGNvbXAuc3R5bGUuZHJhZ19zdGFydF95ID0gZXZlbnQuY2xpZW50WSAtIGNvbXAuc3R5bGUudG9wIC0gX3QgKyBjYW52ZXNSZWN0Lnk7CiAgICAgICAgfWVsc2UgaWYoc3RhdGUgPT09ICdkcmFnJyl7CiAgICAgICAgICBsZXQgX2xlZnQgPSBldmVudC5jbGllbnRYICAtIGNvbXAuc3R5bGUuZHJhZ19zdGFydF94ICAtIF9sICsgY2FudmVzUmVjdC54OyAKICAgICAgICAgIGxldCBfdG9wID0gZXZlbnQuY2xpZW50WSAtIGNvbXAuc3R5bGUuZHJhZ19zdGFydF95IC0gX3QgKyBjYW52ZXNSZWN0LnkgOwogICAgICAgICAgaWYoX2xlZnQgPDAgfHwgX3RvcCA8IDApIHJldHVybjsKICAgICAgICAgIF9sZWZ0ID1NYXRoLm1heCgwLCAgTWF0aC5taW4oX2xlZnQsIHRoaXMuY29uZmlncy5tYXhXaWR0aCkpOwogICAgICAgICAgX3RvcCA9IE1hdGgubWF4KDAsIE1hdGgubWluKF90b3AsIHRoaXMuY29uZmlncy5tYXhIaWVnaHQpKTsKICAgICAgICAgIGNvbXAuc3R5bGUubGVmdCA9IF9sZWZ0OwogICAgICAgICAgY29tcC5zdHlsZS50b3AgPSBfdG9wIDsKICAgICAgICB9CiAgICAgICAgaWYoWydzdGFydCcsICdkcmFnJ10uaW5kZXhPZihzdGF0ZSkgPiAtMSkgewogICAgICAgICAgdGhpcy5lbGltaW5hdGVHaG9zdGluZyhldmVudCk7IC8vIOa2iOmZpOaLluaLvemsvOW9sQogICAgICAgIH0gCiAgICAgICAgCiAgICAgIH0KICAgIH0sCiAgICByZXNpemVCeURyYWdDb21wKGV2ZW50LCBjb21wLCBzdGF0ZSwgYXJyb3csY3VycmVudEluZGV4KSB7CiAgICAgIGlmKGV2ZW50ICYmIChldmVudC5zaGlmdEtleSB8fCBldmVudC5tZXRhS2V5ICYmIHRoaXMuaXNNYWMoKSkgICl7CiAgICAgICAgY29uc29sZS5sb2coJ+WkmumAieWkhOeQhicpCiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5lU3RhdGVzLmNvcHlCeUtleUJvb2wgPSBmYWxzZTsKICAgICAgICBsZXQgX2wgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FudmFzJykuZ2V0Q2xpZW50UmVjdHMoKVswXS5sZWZ0OwogICAgICAgIGxldCBfdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW52YXMnKS5nZXRDbGllbnRSZWN0cygpWzBdLnRvcDsKICAgICAgICBpZihzdGF0ZSA9PT0gJ3N0YXJ0JykgewogICAgICAgICAgdGhpcy5lU3RhdGVzLmN1cnJlbnRBY3RpdmVJbmRleCA9IGN1cnJlbnRJbmRleDsKICAgICAgICAgIGNvbXAuc3R5bGUuZHJhZ19zdGFydF94ID0gYXJyb3cgPT09ICdyJyA/IGNvbXAuc3R5bGUubGVmdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJyb3cgPT09ICdsJyA/Y29tcC5zdHlsZS5sZWZ0ICsgY29tcC5zdHlsZS53aWR0aCArIF9sIC0gMjEzIDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMTA7CiAgICAgICAgICBjb21wLnN0eWxlLmRyYWdfc3RhcnRfeSA9IGFycm93ID09PSAnYicgPyBjb21wLnN0eWxlLnRvcCAgOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcnJvdyA9PT0gJ3QnID9jb21wLnN0eWxlLnRvcCArIGNvbXAuc3R5bGUuaGVpZ2h0ICA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEwOwogICAgICAgIH1lbHNlIGlmKHN0YXRlID09PSAnZHJhZycpewogICAgICAgICAgbGV0IF93aWR0aCA9IDA7CiAgICAgICAgICBsZXQgX3RvcCA9IDA7CiAgICAgICAgICBsZXQgX2hlaWdodCA9IDA7CiAgICAgCiAgICAgICAgICBzd2l0Y2goYXJyb3cpIHsKICAgICAgICAgICAgY2FzZSAncic6CiAgICAgICAgICAgICAgX3dpZHRoID0gcGFyc2VJbnQoKGV2ZW50LmNsaWVudFgtIF9sKSAvdGhpcy5jb25maWdzLnNjYWxlKSAtIGNvbXAuc3R5bGUuZHJhZ19zdGFydF94ICArIDIxMzsgCiAgICAgICAgICAgICAgX3dpZHRoID0gTWF0aC5taW4oX3dpZHRoLCB0aGlzLmNvbmZpZ3Mud2lkdGgpIDsKICAgICAgICAgICAgICBjb21wLnN0eWxlLndpZHRoID0gX3dpZHRoID49IDEwID8gX3dpZHRoOiAxMDsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAnbCc6CiAgICAgICAgICAgICAgY29tcC5zdHlsZS5sZWZ0ID0gKGV2ZW50LmNsaWVudFggLSBfbCkvdGhpcy5jb25maWdzLnNjYWxlICsgMjEzIDsgCiAgICAgICAgICAgICAgX3dpZHRoID0gY29tcC5zdHlsZS5kcmFnX3N0YXJ0X3ggLSBldmVudC5jbGllbnRYIC90aGlzLmNvbmZpZ3Muc2NhbGUgOwogICAgICAgICAgICAgIF93aWR0aCA9TWF0aC5tYXgoMCwgIE1hdGgubWluKF93aWR0aCwgdGhpcy5jb25maWdzLm1heFdpZHRoKSk7CiAgICAgICAgICAgICAgY29tcC5zdHlsZS53aWR0aCA9IF93aWR0aCA+PSAxMCA/IF93aWR0aDogMTA7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ3QnOgogICAgICAgICAgICAgIGNvbXAuc3R5bGUudG9wID0gKGV2ZW50LmNsaWVudFkgLV90ICkvIHRoaXMuY29uZmlncy5zY2FsZSArIDYwOwogICAgICAgICAgICAgIF9oZWlnaHQgPSBjb21wLnN0eWxlLmRyYWdfc3RhcnRfeSAtIGV2ZW50LmNsaWVudFkgL3RoaXMuY29uZmlncy5zY2FsZTsKICAgICAgICAgICAgICBfaGVpZ2h0ID1NYXRoLm1heCgxMCwgIE1hdGgubWluKF9oZWlnaHQsIHRoaXMuY29uZmlncy5tYXhXaWR0aCkpOwogICAgICAgICAgICAgIGNvbXAuc3R5bGUuaGVpZ2h0ID0gX2hlaWdodCA+PSAxMCA/IF9oZWlnaHQgOiAxMDsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAnYic6CiAgICAgICAgICAgICAgX3RvcCA9IF90ID49MCA/ICgoZXZlbnQuY2xpZW50WSAtIF90KSAvIHRoaXMuY29uZmlncy5zY2FsZS0gY29tcC5zdHlsZS5kcmFnX3N0YXJ0X3kgKyA2MCkgOmV2ZW50LmNsaWVudFkgLSBjb21wLnN0eWxlLmRyYWdfc3RhcnRfeSAtIF90ICArIDYwOwogICAgICAgICAgICAgIF90b3AgPSBNYXRoLm1heCgxMCwgTWF0aC5taW4oX3RvcCwgdGhpcy5jb25maWdzLm1heFdpZHRoKSk7CiAgICAgICAgICAgICAgY29tcC5zdHlsZS5oZWlnaHQgPSBfdG9wID49IDEwID8gX3RvcDogMTA7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICB0cmFuc0NvbXAoZXZlbnQsIGNvbXApewogICAgICAgIGxldCBfeCA9IGV2ZW50LmNsaWVudFggLSBjb21wLnN0eWxlLmxlZnQgLSBjb21wLnN0eWxlLndpZHRoIC8gMjsKICAgICAgICBsZXQgX3kgPSBldmVudC5jbGllbnRZIC0gY29tcC5zdHlsZS50b3AgLSBjb21wLnN0eWxlLmhlaWdodCAvIDI7CiAgICAgICAgY29tcC5zdHlsZS5yb3RhdGUgPSB0aGlzLmNhbGNBbmdsZURlZ3JlZXMoX3gsIF95KTsKICAgIH0sCiAgICBjaGFuZ2VUZXh0VmFsKGV2ZW50LCBpdGVtKSB7CiAgICAgIGxldCB2YWwgPSBldmVudC50YXJnZXQuaW5uZXJUZXh0OwogICAgICBpZihldmVudCAmJiBpdGVtKSB7CiAgICAgICAgaXRlbS52YWx1ZSA9IHZhbDsKICAgICAgICBldmVudC50YXJnZXQuaW5uZXJUZXh0ID0gaXRlbS52YWx1ZTsKICAgICAgfQogICAgfSwKICAgIC8vIOe7hOS7tuWIoOmZpAogICAgZGVsQ29tcChpbmRleCwgc3RhdGUpIHsKICAgICAgaWYoc3RhdGUgPT09ICdtdWx0aXBsZURlbCcpIHsKICAgICAgICBsZXQgbGVuID0gdGhpcy5lZHJhd0NvbXBvbmVudHMubGVuZ3RoOwogICAgICAgIHRoaXMuZVN0YXRlcy5tdWx0aXBsZUFjdGl2ZUFyciA9IFtdOwogICAgICAgIGZvcihsZXQgaT1sZW47aS0tO2kgPjApIHsKICAgICAgICAgIGxldCBtdWx0aXBCb29sID0gdGhpcy5lZHJhd0NvbXBvbmVudHNbaV0ubXVsdGlwbGVBY3RpdmVCb29sOwogICAgICAgICAgaWYobXVsdGlwQm9vbCkgewogICAgICAgICAgICB0aGlzLmVkcmF3Q29tcG9uZW50cy5zcGxpY2UoaSwxKQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBpZih0aGlzLmVTdGF0ZXMuY3VycmVudEFjdGl2ZUluZGV4ID4gLTEgJiZ0aGlzLmVkcmF3Q29tcG9uZW50cy5sZW5ndGggPiAwKSB7CiAgICAgICAgICB0aGlzLmVkcmF3Q29tcG9uZW50cy5zcGxpY2UodGhpcy5lU3RhdGVzLmN1cnJlbnRBY3RpdmVJbmRleCwxKQogICAgICAgICAgdGhpcy5lU3RhdGVzLmN1cnJlbnRBY3RpdmVJbmRleCA9IC0xOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIC8vIOmUruebmOS6i+S7tgogICAga2F5ZG93bkZ1bihldmVudCkgewogICAgICBpZihldmVudC5rZXkgPT09ICd2JyAmJiBkb2N1bWVudC5hY3RpdmVFbGVtZW50Lm5vZGVOYW1lID09PSAnSU5QVVQnKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9ZWxzZSBpZihldmVudC5rZXkgPT09ICdjJyAmJiAgZG9jdW1lbnQuYWN0aXZlRWxlbWVudC5ub2RlTmFtZSA9PT0gJ0lOUFVUJykgewogICAgICAgIGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQuYmx1cigpOwogICAgICB9CiAgICAgIGlmKGV2ZW50LnRhcmdldC5ub2RlTmFtZSA9PT0gJ0lOUFVUJyAmJiB0aGlzLmVTdGF0ZXMuY29weUJ5S2V5Qm9vbCkgewogICAgICAgICB0aGlzLmVTdGF0ZXMuY29weUJ5S2V5Qm9vbCA9IGZhbHNlOwogICAgICB9CiAgICAgIGlmKGV2ZW50LmtleSA9PT0gJ2MnKSB7CiAgICAgICAgdGhpcy5lU3RhdGVzLmNvcHlCeUtleUJvb2wgPSB0cnVlOwogICAgICB9ZWxzZSBpZih0aGlzLmVTdGF0ZXMuY29weUJ5S2V5Qm9vbCAmJiBldmVudC5rZXkgPT09ICd2JykgewogICAgICAgIHRoaXMuY29weUN1cnJlbnRDb21wKCk7CiAgICAgIH1lbHNlIGlmKGV2ZW50LnRhcmdldC5ub2RlTmFtZSAhPT0gJ0lOUFVUJyl7CiAgICAgICAgaWYoWydBcnJvd1VwJywnQXJyb3dEb3duJywnQXJyb3dMZWZ0JywiQXJyb3dSaWdodCJdLmluZGV4T2YoZXZlbnRbJ2NvZGUnXSk+IC0xKSB7CiAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgaWYodGhpcy5lU3RhdGVzLmN1cnJlbnRBY3RpdmVJbmRleCA+IC0xICYmIHRoaXMuZVN0YXRlcy5tdWx0aXBsZUFjdGl2ZUFyci5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgdGhpcy5hcnJvd0l0ZW0oZXZlbnRbJ2NvZGUnXSwgdGhpcy5lZHJhd0NvbXBvbmVudHNbdGhpcy5lU3RhdGVzLmN1cnJlbnRBY3RpdmVJbmRleF0pCiAgICAgICAgICB9ZWxzZSBpZih0aGlzLmVTdGF0ZXMubXVsdGlwbGVBY3RpdmVBcnIubGVuZ3RoID4gMCl7CiAgICAgICAgICAgIGxldCBsZW4gPSB0aGlzLmVTdGF0ZXMubXVsdGlwbGVBY3RpdmVBcnIubGVuZ3RoOwogICAgICAgICAgICBmb3IobGV0IGk9MDtpPGxlbjtpKyspewogICAgICAgICAgICAgICB0aGlzLmFycm93SXRlbShldmVudFsnY29kZSddLCB0aGlzLmVTdGF0ZXMubXVsdGlwbGVBY3RpdmVBcnJbaV0pCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgaWYoZXZlbnQua2V5ID09PSAnRGVsZXRlJyB8fCB0aGlzLmlzTWFjKCkgJiYgZXZlbnQua2V5ID09PSAnQmFja3NwYWNlJykgIHsKICAgICAgICBpZighKGV2ZW50LnRhcmdldC5pbm5lckhUTUwgJiYgZXZlbnQudGFyZ2V0LmNvbnRlbnRFZGl0YWJsZSkgfHwgZXZlbnQudGFyZ2V0LmNvbnRlbnRFZGl0YWJsZSA9PT0gJ2luaGVyaXQnKSB7CiAgICAgICAgICB0aGlzLmRlbENvbXAoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBhcnJvd0l0ZW0oYXJyb3csIG9iaikgewogICAgICBpZihhcnJvdyAmJiBvYmopIHsKICAgICAgICBzd2l0Y2ggKGFycm93KSB7CiAgICAgICAgICBjYXNlICdBcnJvd1VwJyA6CiAgICAgICAgICAgIG9iai5zdHlsZS50b3AgPSAob2JqLnN0eWxlLnRvcCAtIDEpID4gMCA/ICggb2JqLnN0eWxlLnRvcCAtIDEpIDogMDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICdBcnJvd0Rvd24nIDoKICAgICAgICAgICAgb2JqLnN0eWxlLnRvcCA9IG9iai5zdHlsZS50b3AgKyAxOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgJ0Fycm93TGVmdCcgOgogICAgICAgICAgICBvYmouc3R5bGUubGVmdCA9IChvYmouc3R5bGUubGVmdCAtMSApPiAwPyAob2JqLnN0eWxlLmxlZnQgLTEpIDogMDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICdBcnJvd1JpZ2h0JzoKICAgICAgICAgICAgb2JqLnN0eWxlLmxlZnQgPSAgb2JqLnN0eWxlLmxlZnQgKzE7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgLy8g5aSa6YCJ5LqL5Lu2CiAgICBtb3VzZWRvd25GdW4oZXZlbnQpIHsKICAgICAgdGhpcy5lbGltaW5hdGVHaG9zdGluZyhldmVudCk7IC8vIOa2iOmZpOaLluaLvemsvOW9sQogICAgICBpZihldmVudCAmJiBldmVudC5zaGlmdEtleSAmJiB0aGlzLmVTdGF0ZXMuY3VycmVudEFjdGl2ZUluZGV4ID4gLTEpIHsKICAgICAgICB0aGlzLmVkcmF3Q29tcG9uZW50c1t0aGlzLmVTdGF0ZXMuY3VycmVudEFjdGl2ZUluZGV4XS5pc0FjdGl2ZSA9IGZhbHNlOwogICAgICAgIHRoaXMuZVN0YXRlcy5jdXJyZW50QWN0aXZlSW5kZXggPSAtMTsKICAgICAgfQogICAgICBpZigoIWV2ZW50LnNoaWZ0S2V5IHx8ICFldmVudC5tZXRhS2V5ICYmIHRoaXMuaXNNYWMoKSkgJiYgZXZlbnQuYnV0dG9uID09PSAwIAogICAgICAgICYmIGV2ZW50LnRhcmdldC5pZD09PSdjYW52YXMnIAogICAgICAgICYmICFldmVudC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdjb21wLWVsZW1lbnQnKSkgewogICAgICAgIHRoaXMuZVN0YXRlcy5jb3B5QnlLZXlCb29sID0gZmFsc2U7CiAgICAgICAgdGhpcy5pbml0Q29tcFN0YXRlKCk7CiAgICAgIH0gCiAgICB9LAogICAgLy8g5Yib5bu65b2T5YmN57uE5Lu2CiAgICBjb3B5Q3VycmVudENvbXA6ZnVuY3Rpb24oKSB7CiAgICAgIGxldCBfY3VyckNvbXAgPSB0aGlzLmVkcmF3Q29tcG9uZW50c1t0aGlzLmVTdGF0ZXMuY3VycmVudEFjdGl2ZUluZGV4XTsKICAgICAgaWYoIV9jdXJyQ29tcCkgcmV0dXJuOwogICAgICBfY3VyckNvbXAuaXNBY3RpdmUgPSBmYWxzZTsKICAgICAgbGV0IF9jb3B5ID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShfY3VyckNvbXApKTsKICAgICAgbGV0IF9zdHlsZSA9IF9jdXJyQ29tcC5zdHlsZTsKICAgICAgbGV0IF92YWwgPSAxMDsKICAgICAgbGV0IF9oID0gX3ZhbDsKICAgICAgX2NvcHkuc3R5bGUudG9wID0gcGFyc2VJbnQoX3N0eWxlLmhlaWdodCkgKyBwYXJzZUludChfc3R5bGUudG9wKSArIHBhcnNlSW50KF9oKTsKICAgICAgX2NvcHkuc3R5bGUudG9wID0gTWF0aC5tYXgoMCwgTWF0aC5taW4oX2NvcHkuc3R5bGUudG9wLCB0aGlzLmNvbmZpZ3MubWF4SGllZ2h0KSk7CiAgICAgIF9jb3B5LmlzQWN0aXZlID0gdHJ1ZTsKICAgICAgdGhpcy5lZHJhd0NvbXBvbmVudHMucHVzaChfY29weSk7CiAgICAgIHRoaXMuZVN0YXRlcy5jdXJyZW50QWN0aXZlSW5kZXggPSB0aGlzLmVkcmF3Q29tcG9uZW50cy5sZW5ndGggLSAxOyAvL+abtOaWsOa/gOa0u+e7hOS7tueahOS4i+aghwogICAgfSwKICAgIC8vIOWkmumAieaTjeS9nDrlj43pgIkv5riF56m65aSa6YCJL+WxnuaAp+W6lOeUqAogICAgc2V0TXVsdGlwbGVTdGF0ZTpmdW5jdGlvbihzdGF0ZSwgdmFsdWUpIHsKICAgICAgaWYoc3RhdGUgPT09ICdJc29tZXRyaWMnKSB7CiAgICAgICAgZm9yKGxldCBpID0gdGhpcy5lU3RhdGVzLm11bHRpcGxlQWN0aXZlQXJyLmxlbmd0aC0xO2k+PTA7aS0tKSB7CiAgICAgICAgICBsZXQgb2JqID0gdGhpcy5lU3RhdGVzLm11bHRpcGxlQWN0aXZlQXJyW2ldOwogICAgICAgICAgbGV0IGJvb2wgPSBvYmpbJ211bHRpcGxlQWN0aXZlQm9vbCddOwogICAgICAgICAgaWYoIWJvb2wpIHsKICAgICAgICAgICAgdGhpcy5lU3RhdGVzLm11bHRpcGxlQWN0aXZlQXJyLnNwbGljZShpLDEpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBsZXQgbGVuID0gdGhpcy5lU3RhdGVzLm11bHRpcGxlQWN0aXZlQXJyLmxlbmd0aDsKICAgICAgICBsZXQgdmFsID0gMDsKICAgICAgICBpZih2YWx1ZSA9PT0gJ3JvdycpIHsKICAgICAgICAgIHRoaXMuZVN0YXRlcy5tdWx0aXBsZUFjdGl2ZUFyciA9ICB0aGlzLmVTdGF0ZXMubXVsdGlwbGVBY3RpdmVBcnIuc29ydChmdW5jdGlvbihhLGIpewogICAgICAgICAgICByZXR1cm4gcGFyc2VJbnQoYS5zdHlsZS5sZWZ0KSAtIHBhcnNlSW50KGIuc3R5bGUubGVmdCk7CiAgICAgICAgICB9KQogICAgICAgICAgZm9yKGxldCBpPTA7aTwgbGVuO2krKykgewogICAgICAgICAgICBsZXQgaXRlbSA9IHRoaXMuZVN0YXRlcy5tdWx0aXBsZUFjdGl2ZUFycltpXTsKICAgICAgICAgICAgaWYoaT4wKSB7CiAgICAgICAgICAgICAgaXRlbS5zdHlsZS5sZWZ0ID0gdmFsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhbCA9IHBhcnNlSW50KGl0ZW0uc3R5bGUubGVmdCkgKyBwYXJzZUludChpdGVtLnN0eWxlLndpZHRoKSArIHBhcnNlSW50KHRoaXMuY29uZmlncy5Jc29tZXRyaWNfcm93KTsKICAgICAgICAgICAgdmFsID0gTWF0aC5tYXgoMCwgTWF0aC5taW4odmFsLCB0aGlzLmNvbmZpZ3MubWF4V2lkdGgpKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5lU3RhdGVzLm11bHRpcGxlQWN0aXZlQXJyID0gIHRoaXMuZVN0YXRlcy5tdWx0aXBsZUFjdGl2ZUFyci5zb3J0KGZ1bmN0aW9uKGEsYil7CiAgICAgICAgICAgIHJldHVybiBwYXJzZUludChhLnN0eWxlLnRvcCkgLSBwYXJzZUludChiLnN0eWxlLnRvcCkgOwogICAgICAgICAgfSkKICAgICAgICAgIGZvcihsZXQgaT0wO2k8IGxlbjtpKyspIHsKICAgICAgICAgICAgbGV0IGl0ZW0gPSB0aGlzLmVTdGF0ZXMubXVsdGlwbGVBY3RpdmVBcnJbaV07CiAgICAgICAgICAgIGlmKGk+MCkgewogICAgICAgICAgICAgIGl0ZW0uc3R5bGUudG9wID0gdmFsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhbCA9IHBhcnNlSW50KGl0ZW0uc3R5bGUuaGVpZ2h0KSArIHBhcnNlSW50KGl0ZW0uc3R5bGUudG9wKSArIHBhcnNlSW50KHRoaXMuY29uZmlncy5Jc29tZXRyaWNfY29sdSk7CiAgICAgICAgICAgIHZhbCA9IE1hdGgubWF4KDAsICBNYXRoLm1pbih2YWwsIHRoaXMuY29uZmlncy5tYXhIaWVnaHQpKTsKICAgICAgICAgIH0KICAgICAgICB9ICAgICAKICAgICAgfWVsc2UgaWYoc3RhdGUgPT09ICdyZVNlbCcpIHsKICAgICAgICBsZXQgbGVuID0gdGhpcy5lZHJhd0NvbXBvbmVudHMubGVuZ3RoOwogICAgICAgIHRoaXMuZVN0YXRlcy5tdWx0aXBsZUFjdGl2ZUFyciA9IFtdOwogICAgICAgIGZvcihsZXQgaT1sZW47aS0tO2kgPjApIHsKICAgICAgICAgIGxldCBpdGVtID0gdGhpcy5lZHJhd0NvbXBvbmVudHNbaV07CiAgICAgICAgICBpZighaXRlbS5tdWx0aXBsZUFjdGl2ZUJvb2wpIHsgIAogICAgICAgICAgICB0aGlzLmVTdGF0ZXMubXVsdGlwbGVBY3RpdmVBcnIucHVzaChpdGVtKTsKICAgICAgICAgIH0KICAgICAgICAgIGl0ZW0ubXVsdGlwbGVBY3RpdmVCb29sID0gIWl0ZW0ubXVsdGlwbGVBY3RpdmVCb29sOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmKHN0YXRlID09PSAnY2xlYXInKXsKICAgICAgICBsZXQgbGVuID0gdGhpcy5lZHJhd0NvbXBvbmVudHMubGVuZ3RoOwogICAgICAgIHRoaXMuZVN0YXRlcy5tdWx0aXBsZUFjdGl2ZUFyciA9IFtdOwogICAgICAgIGZvcihsZXQgaT1sZW47aS0tO2kgPjApIHsKICAgICAgICAgIHRoaXMuZWRyYXdDb21wb25lbnRzW2ldLm11bHRpcGxlQWN0aXZlQm9vbCA9IGZhbHNlOwogICAgICAgIH0KICAgICAgfWVsc2UgaWYoWydpc0FwcGx5U2hhZG93JywgJ2JvcmRlclJhZGl1cyddLmluZGV4T2Yoc3RhdGUpID4gLTEpIHsKICAgICAgICBsZXQgbGVuID0gdGhpcy5lU3RhdGVzLm11bHRpcGxlQWN0aXZlQXJyLmxlbmd0aDsKICAgICAgICBmb3IobGV0IGk9bGVuO2ktLTtpID4wKSB7CiAgICAgICAgICB0aGlzLmVTdGF0ZXMubXVsdGlwbGVBY3RpdmVBcnJbaV0uc3R5bGVbc3RhdGVdID0gdmFsdWU7CiAgICAgICAgfQogICAgICB9ZWxzZSBpZihzdGF0ZSA9PT0gJ2FsaWduJykgewogICAgICAgIHN3aXRjaCh2YWx1ZSkgewogICAgICAgICAgY2FzZSAndCcgOgogICAgICAgICAgICB0aGlzLm11bHRpcEFycmF5KCd0b3AnKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICdsJyA6CiAgICAgICAgICAgIHRoaXMubXVsdGlwQXJyYXkoJ2xlZnQnKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICdiJyA6CiAgICAgICAgICAgIHRoaXMubXVsdGlwQXJyYXkoJ2JvdHRvbScpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgJ3InIDoKICAgICAgICAgICAgdGhpcy5tdWx0aXBBcnJheSgncmlnaHQnKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICAvLyDliKDpmaTlpJrpgInlhYPntKAKICAgIGRlbE11bHRpcENvbXAoY29tcCwgaW5kZXgpIHsKICAgICAgdGhpcy5lU3RhdGVzLm11bHRpcGxlQWN0aXZlQXJyLnNwbGljZShpbmRleCwgMSk7CiAgICAgIGxldCBfaW5kZXggPSB0aGlzLmVkcmF3Q29tcG9uZW50cy5pbmRleE9mKGNvbXApOwogICAgICBpZihfaW5kZXggPiAtMSkgewogICAgICAgIHRoaXMuZWRyYXdDb21wb25lbnRzW19pbmRleF0ubXVsdGlwbGVBY3RpdmVCb29sID0gZmFsc2U7CiAgICAgIH0KICAgIH0sCiAgICBjaGFuZ2VDb25maWcoc3RhdGUsIHZhbHVlKXsKICAgICAgaWYoIXRoaXMuY29uZmlnc1tzdGF0ZV0pIHJldHVybjsKICAgICAgaWYoc3RhdGUgPT09ICdiZycpIHsKICAgICAgICB0aGlzLmNoYW5nZUJnSW1nKCkKICAgICAgfQogICAgICB0aGlzLmNvbmZpZ3Nbc3RhdGVdID0gdmFsdWU7CiAgICB9LAogICAgbXVsdGlwQXJyYXkocGFyYW0pIHsKICAgICAgbGV0IGxpc3QgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuZVN0YXRlcy5tdWx0aXBsZUFjdGl2ZUFycikpOwogICAgICBsaXN0LnNvcnQoZnVuY3Rpb24oYSwgYikgewogICAgICAgIHJldHVybiBbJ3RvcCcsICdsZWZ0J10uaW5kZXhPZihwYXJhbSkgPiAtMSA/IHBhcnNlSW50KGEuc3R5bGVbcGFyYW1dKSAtIHBhcnNlSW50KGIuc3R5bGVbcGFyYW1dKToKICAgICAgICAgIHBhcmFtID09PSAnYm90dG9tJyA/IHBhcnNlSW50KGIuc3R5bGUudG9wKSArIHBhcnNlSW50KGIuc3R5bGUuaGVpZ2h0KSAtIChwYXJzZUludChhLnN0eWxlLnRvcCkgKyBwYXJzZUludChhLnN0eWxlLmhlaWdodCkpIDoKICAgICAgICAgIHBhcnNlSW50KGIuc3R5bGUubGVmdCkgKyBwYXJzZUludChiLnN0eWxlLndpZHRoKSAtIChwYXJzZUludChhLnN0eWxlLmxlZnQpICsgcGFyc2VJbnQoYS5zdHlsZS53aWR0aCkpIAogICAgICB9KTsKICAgICAgbGV0IGxlbiA9IHRoaXMuZVN0YXRlcy5tdWx0aXBsZUFjdGl2ZUFyci5sZW5ndGg7CiAgICAgIGxldCByZXNPYmogPSBsaXN0WzBdOwogICAgICBpZihbJ3RvcCcsICdsZWZ0J10uaW5kZXhPZihwYXJhbSkgPiAtMSkgewogICAgICAgIGZvcihsZXQgaT0wO2k8bGVuO2krKykgewogICAgICAgICAgdGhpcy5lU3RhdGVzLm11bHRpcGxlQWN0aXZlQXJyW2ldLnN0eWxlW3BhcmFtXSA9IHJlc09iai5zdHlsZVtwYXJhbV07CiAgICAgICAgfQogICAgICB9ZWxzZSBpZihwYXJhbSA9PT0gJ2JvdHRvbScpIHsKICAgICAgICBsZXQgX2JvdHRvbSA9IHBhcnNlSW50KCByZXNPYmouc3R5bGUudG9wICkrIHBhcnNlSW50KHJlc09iai5zdHlsZS5oZWlnaHQpOwogICAgICAgIGZvcihsZXQgaT0wO2k8bGVuO2krKykgewogICAgICAgICAgY29uc29sZS5sb2coX2JvdHRvbSwgdGhpcy5lU3RhdGVzLm11bHRpcGxlQWN0aXZlQXJyW2ldLnN0eWxlLmhlaWdodCwgX2JvdHRvbS0gdGhpcy5lU3RhdGVzLm11bHRpcGxlQWN0aXZlQXJyW2ldLnN0eWxlLmhlaWdodCkKICAgICAgICAgIHRoaXMuZVN0YXRlcy5tdWx0aXBsZUFjdGl2ZUFycltpXS5zdHlsZS50b3AgPSBfYm90dG9tIC0gdGhpcy5lU3RhdGVzLm11bHRpcGxlQWN0aXZlQXJyW2ldLnN0eWxlLmhlaWdodDsKICAgICAgICB9CiAgICAgIH1lbHNlIGlmKHBhcmFtID09PSAncmlnaHQnKSB7CiAgICAgICAgbGV0IF9yaWdodCA9IHBhcnNlSW50KHJlc09iai5zdHlsZS5sZWZ0KSArIHBhcnNlSW50KHJlc09iai5zdHlsZS53aWR0aCk7CiAgICAgICAgZm9yKGxldCBpPTA7aTxsZW47aSsrKSB7CiAgICAgICAgICB0aGlzLmVTdGF0ZXMubXVsdGlwbGVBY3RpdmVBcnJbaV0uc3R5bGUubGVmdCA9IF9yaWdodCAtIHRoaXMuZVN0YXRlcy5tdWx0aXBsZUFjdGl2ZUFycltpXS5zdHlsZS53aWR0aDsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBpc01hYzpmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIC9tYWNpbnRvc2h8bWFjIG9zIHgvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpCiAgICB9LAogICAgY2FsY0FuZ2xlRGVncmVlcyh4LCB5KSB7CiAgICAgIGxldCB2YWwgPSAgTWF0aC5hdGFuMih5LCB4KSAqIDE4MCAvIE1hdGguUEk7CiAgICAgIHJldHVybiBNYXRoLmNlaWwodmFsKTsKICAgIH0sCiAgICBzZWxDb2xvcihjb21wLCBjb2xvcikgewogICAgICBpZih0aGlzLmVTdGF0ZXMuY3VycmVudEFjdGl2ZUluZGV4ID4gLTEgJiYgdGhpcy5lZHJhd0NvbXBvbmVudHNbdGhpcy5lU3RhdGVzLmN1cnJlbnRBY3RpdmVJbmRleF0pIHsKICAgICAgICB0aGlzLmVkcmF3Q29tcG9uZW50c1t0aGlzLmVTdGF0ZXMuY3VycmVudEFjdGl2ZUluZGV4XS5zdHlsZS5jb2xvciA9IGNvbG9yOwogICAgICB9CiAgICB9LAogICAgc2VsQmFja2dyb3VuZChjb21wLCBiZ0NvbG9yKSB7CiAgICAgIGlmKHRoaXMuZVN0YXRlcy5jdXJyZW50QWN0aXZlSW5kZXggPiAtMSAmJiB0aGlzLmVkcmF3Q29tcG9uZW50c1t0aGlzLmVTdGF0ZXMuY3VycmVudEFjdGl2ZUluZGV4XSkgewogICAgICAgIHRoaXMuZWRyYXdDb21wb25lbnRzW3RoaXMuZVN0YXRlcy5jdXJyZW50QWN0aXZlSW5kZXhdLnN0eWxlLmJhY2tncm91bmQgPSBiZ0NvbG9yOwogICAgICB9CiAgICB9LAogICAgc2NyZWVuOmZ1bmN0aW9uKCkgewogICAgICB0aGlzLmNvbmZpZ3MuYmdBbGxCb29sID0gIXRoaXMuY29uZmlncy5iZ0FsbEJvb2w7CiAgICAgIGlmKHRoaXMuY29uZmlncy5iZ0FsbEJvb2wpIHsKICAgICAgICAvLyB0aGlzLmNvbmZpZ3Mud2luZG93X3cgPSB3aW5kb3cuc2NyZWVuLndpZHRoID4gMTUwMCA/IHdpbmRvdy5zY3JlZW4ud2lkdGggOiAxNTAwOwogICAgICAgIC8vIHRoaXMuY29uZmlncy53aW5kb3dfaCA9IHdpbmRvdy5zY3JlZW4uaGVpZ2h0ID4gODAwID8gd2luZG93LnNjcmVlbi5oZWlnaHQgOiA4MDA7CiAgICAgICAgdGhpcy5jb25maWdzLndpbmRvd193ID0gMjk4NTsKICAgICAgICB0aGlzLmNvbmZpZ3Mud2luZG93X2ggPSAxNDQ1CiAgICAgICAgdGhpcy5jb25maWdzLnNjYWxlID0gMTsKICAgICAgfQogICAgfSwKICAgIGluaXRTdG9yYWdlRGF0YShjbGVhckJvb2wpIHsKICAgICAgaWYoIWNsZWFyQm9vbCAmJiB3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2JtX2RhdGFzJykpIHJldHVybjsKICAgICAgbGV0IHBhcmFtcyA9IHsKICAgICAgICAgIHNhdmVfZGF0YV9hdXRvOltdLAogICAgICAgICAgc2F2ZV9kYXRhX2N1c3RvbTpbXQogICAgICB9CiAgICAgIHdpbmRvdy5sb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnYm1fZGF0YXMnLCBKU09OLnN0cmluZ2lmeShwYXJhbXMpKTsKICAgIH0sCiAgICBzYXZlRGF0ZVRvU3RvcmFnZShkYXRhLCBzdGF0ZSkgewogICAgICBsZXQgc2F2ZURhdGEgPSBkYXRhIHx8IHRoaXMuZWRyYXdDb21wb25lbnRzOwogICAgICAvL+WtmOWCqOS8mOWMlu+8jOayoeacieWGheWuueeahOmhtemdouS4jemcgOimgeWtmOWCqAogICAgICBpZighc2F2ZURhdGEgfHwgQXJyYXkuaXNBcnJheShzYXZlRGF0YSkgJiYgc2F2ZURhdGEubGVuZ3RoID09PSAwKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGxldCBvYmogPSB7CiAgICAgICAgZGF0YTogc2F2ZURhdGEsCiAgICAgICAgdHlwZTogc3RhdGUgfHwgJ2F1dG8nLAogICAgICAgIHVwZGF0ZVRpbWU6bmV3IERhdGUoKQogICAgICB9OwogICAgICBpZighd2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtKCdibV9kYXRhcycpKSB7CiAgICAgICAgdGhpcy5pbml0U3RvcmFnZURhdGEoKTsKICAgICAgfQogICAgICBsZXQgcGFyYW1zID0gd2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtKCdibV9kYXRhcycpOwogICAgICBpZihwYXJhbXMgJiYgdHlwZW9mIHBhcmFtcyA9PT0gJ3N0cmluZycpIHsKICAgICAgICBwYXJhbXMgPSBKU09OLnBhcnNlKHBhcmFtcykKICAgICAgfQogICAgICBpZighdGhpcy53ZWJDb25maWcpIHsKICAgICAgICB0aGlzLmluaXRDb25maWcoKTsKICAgICAgfQogICAgICBpZihzdGF0ZSA9PT0gJ2N1c3RvbScpIHsKICAgICAgICBwYXJhbXMuc2F2ZV9kYXRhX2N1c3RvbS51bnNoaWZ0KG9iaik7CiAgICAgICAgaWYocGFyYW1zLnNhdmVfZGF0YV9jdXN0b20ubGVuZ3RoID4gIHRoaXMud2ViQ29uZmlnLmN1c3RvbSkgewogICAgICAgICAgcGFyYW1zLnNhdmVfZGF0YV9jdXN0b20gPSBwYXJhbXMuc2F2ZV9kYXRhX2N1c3RvbS5zbGljZSgwLCB0aGlzLndlYkNvbmZpZy5jdXN0b20pOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBwYXJhbXMuc2F2ZV9kYXRhX2F1dG8udW5zaGlmdChvYmopOwogICAgICAgIGlmKHBhcmFtcy5zYXZlX2RhdGFfYXV0by5sZW5ndGggPiAgdGhpcy53ZWJDb25maWcuYXV0bykgewogICAgICAgICAgcGFyYW1zLnNhdmVfZGF0YV9hdXRvID0gcGFyYW1zLnNhdmVfZGF0YV9hdXRvLnNsaWNlKDAsICB0aGlzLndlYkNvbmZpZy5hdXRvKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdGhpcy5fc2F2ZVdlYlN0b3JhZ2UocGFyYW1zKTsKICAgICAgdGhpcy5jdXJyZW50SGlzdG9yeUluZGV4ID0gLTE7CiAgICB9LAogICAgZ2V0U3RvcmFnZURhdGEocmVsb2FkQm9vbCkgewogICAgICBpZighcmVsb2FkQm9vbCkgewogICAgICAgIHRoaXMuYWN0aXZlSGlzdG9yeUJvb2wgPSAhdGhpcy5hY3RpdmVIaXN0b3J5Qm9vbDsKICAgICAgfQogICAgICB0aGlzLmN1cnJlbnRIaXN0b3J5SW5kZXggPSAtMTsKICAgICAgbGV0IHBhcmFtcyA9IHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnYm1fZGF0YXMnKTsKICAgICAgaWYocGFyYW1zICYmIHR5cGVvZiBwYXJhbXMgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgcGFyYW1zID0gSlNPTi5wYXJzZShwYXJhbXMpCiAgICAgIH0KICAgICAgbGV0IGxpc3QgPSBbXS5jb25jYXQocGFyYW1zLnNhdmVfZGF0YV9jdXN0b20sIHBhcmFtcy5zYXZlX2RhdGFfYXV0byk7CiAgICAgIHRoaXMuaGlzdG9yeUN1cnJuZXREYXRhID0gXy5vcmRlckJ5KGxpc3QsICd1cGRhdGVUaW1lJywgImRlc2MiKTsKICAgIH0sCiAgICBfc2F2ZVdlYlN0b3JhZ2UocGFyYW1zLCBkZWxTYXZlQm9vbCkgewogICAgICBsZXQgc2VjY01lc3NhZ2UgPSBkZWxTYXZlQm9vbCA/ICLliKDpmaTmiJDlip8iOiAi5L+d5a2Y5oiQ5YqfIjsKICAgICAgbGV0IGVyck1lc3NhZ2UgID0gZGVsU2F2ZUJvb2wgPyAi5Yig6Zmk5aSx6LSlIjogCiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kZVVSSUNvbXBvbmVudChKU09OLnN0cmluZ2lmeShsb2NhbFN0b3JhZ2UpLmxlbmd0aCkgPiAoMTAyNCAqIDEwMjQgKiA1IC0gMTAwKSA/ICfmlbDmja7otoXov4fljoblj7LmlbDmja7mnIDlpKflgLzvvIzor7fliKDpmaTljoblj7LkuI3pnIDopoHnmoTmlbDmja7ph43mlrDlrZjlgqgnIDoi5L+d5a2Y5pWw5o2u5Ye66ZSZIjsKICAgICAgdHJ5IHsKICAgICAgICB3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2JtX2RhdGFzJywgSlNPTi5zdHJpbmdpZnkocGFyYW1zKSk7CiAgICAgICAgdGhpcy5zYXZlRGF0YUluZm8oInN1Y2Nlc3MiLHNlY2NNZXNzYWdlKTsKICAgICAgfWNhdGNoIHsKICAgICAgICB0aGlzLnNhdmVEYXRhSW5mbygnZXJyb3InLGVyck1lc3NhZ2UpCiAgICAgIH0KICAgICAgaWYodGhpcy5hY3RpdmVIaXN0b3J5Qm9vbCkgewogICAgICAgIHRoaXMuZ2V0U3RvcmFnZURhdGEodHJ1ZSk7CiAgICAgIH0KICAgIH0sCiAgICBpbml0Q29uZmlnKCkgewogICAgICBpZih3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2JtX2RhdGFzJykpIHJldHVybjsKICAgICAgbGV0IHBhcmFtcyA9IHsKICAgICAgICBjdXN0b206NTAsCiAgICAgICAgYXV0bzo1MCwKICAgICAgfQogICAgICB3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2NvbmZpZ3MnLCBKU09OLnN0cmluZ2lmeShwYXJhbXMpKTsKICAgIH0sCiAgICBkZWxldGVIaXN0b3J5RGF0YShpbmRleCkgewogICAgICBsZXQgY3VycmVudERhdGEgPSB0aGlzLmhpc3RvcnlDdXJybmV0RGF0YVtpbmRleF07CiAgICAgIGlmKGN1cnJlbnREYXRhKSB7CiAgICAgICAgZGVsZXRlIGN1cnJlbnREYXRhLmlzQWN0aXZlOwogICAgICB9CiAgICAgIGlmKCF3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2JtX2RhdGFzJykpIHsKICAgICAgICB0aGlzLmluaXRTdG9yYWdlRGF0YSgpOwogICAgICB9CiAgICAgIGxldCBwYXJhbXMgPSB3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2JtX2RhdGFzJyk7CiAgICAgIGlmKHBhcmFtcyAmJiB0eXBlb2YgcGFyYW1zID09PSAnc3RyaW5nJykgewogICAgICAgIHBhcmFtcyA9IEpTT04ucGFyc2UocGFyYW1zKTsKICAgICAgfQogICAgICBpZihwYXJhbXMpIHsKICAgICAgICBsZXQgYyA9IHBhcmFtcy5zYXZlX2RhdGFfY3VzdG9tCiAgICAgICAgbGV0IGxlbl9jID0gIGMubGVuZ3RoOwogICAgICAgIGxldCBoYXNCb29sID0gZmFsc2U7CiAgICAgICAgZm9yKGxldCBpPTA7aTxsZW5fYztpKyspIHsKICAgICAgICAgIGxldCBpdGVtID0gY1tpXTsKICAgICAgICAgIGlmKGl0ZW0gJiYgY3VycmVudERhdGEgJiYgaXRlbS51cGRhdGVUaW1lID09PSBjdXJyZW50RGF0YS51cGRhdGVUaW1lKSB7CiAgICAgICAgICAgIHBhcmFtcy5zYXZlX2RhdGFfY3VzdG9tLnNwbGljZShpLCAxKTsKICAgICAgICAgICAgaGFzQm9vbCA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmKCFoYXNCb29sKSB7CiAgICAgICAgICBsZXQgYSA9IHBhcmFtcy5zYXZlX2RhdGFfYXV0bzsKICAgICAgICAgIGxldCBsZW5fYSA9IGEubGVuZ3RoOwogICAgICAgICAgZm9yKGxldCBpPTA7aTxsZW5fYTtpKyspIHsKICAgICAgICAgICAgbGV0IGl0ZW0gPSBhW2ldOwogICAgICAgICAgICBpZihpdGVtICYmIGN1cnJlbnREYXRhICYmIGl0ZW0udXBkYXRlVGltZSA9PT0gY3VycmVudERhdGEudXBkYXRlVGltZSkgewogICAgICAgICAgICAgIHBhcmFtcy5zYXZlX2RhdGFfYXV0by5zcGxpY2UoaSwgMSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdGhpcy5fc2F2ZVdlYlN0b3JhZ2UocGFyYW1zLCB0cnVlKQogICAgICB9CiAgICB9LAogICAgY2xlYXJTdG9yYWdlRGF0YSgpIHsKICAgICAgdGhpcy5pbml0U3RvcmFnZURhdGEodHJ1ZSk7CiAgICAgIHRoaXMuZ2V0U3RvcmFnZURhdGEodHJ1ZSk7CiAgICB9LAogICAgY2hhbmdlQmdJbWcodXJsKSB7CiAgICAgIHRoaXMuY29uZmlncy5iYWNrZ3JvdW5kVXJsID0gdXJsOwogICAgfSwKICAgIGluaXRIaXN0b3J5TGlzdFN0YXRlKGluZGV4KSB7CiAgICAgIHRoaXMuY3VycmVudEhpc3RvcnlJbmRleCA9IGluZGV4ID4gLTEgPyBpbmRleCA6IC0xOwogICAgICBpZihBcnJheS5pc0FycmF5KHRoaXMuaGlzdG9yeUN1cnJuZXREYXRhKSkgewogICAgICAgIGxldCBsZW4gPSB0aGlzLmhpc3RvcnlDdXJybmV0RGF0YS5sZW5ndGg7CiAgICAgICAgZm9yKGxldCBpPTA7aTxsZW47aSsrKSB7CiAgICAgICAgICAgIGlmKHRoaXMuaGlzdG9yeUN1cnJuZXREYXRhICYmIHRoaXMuaGlzdG9yeUN1cnJuZXREYXRhW2ldKSB7CiAgICAgICAgICAgICB0aGlzLmhpc3RvcnlDdXJybmV0RGF0YVtpXS5pc0FjdGl2ZSA9IGZhbHNlOwogICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBhcHBseUhpc3RvcnkobGlzdCkgewogICAgICB0aGlzLmVkcmF3Q29tcG9uZW50cyA9IGxpc3Q7CiAgICAgIHRoaXMuaW5pdENvbXBTdGF0ZSgpOwogICAgICB0aGlzLmNsb3NlSGlzdG9yeSgpOwogICAgfSwKICAgIGNsb3NlSGlzdG9yeSgpIHsKICAgICAgdGhpcy5hY3RpdmVIaXN0b3J5Qm9vbCA9IGZhbHNlOwogICAgfSwKICAgIGNsZXJhckhpc3RvcnlEYXRhKCl7CiAgICAgIHRoaXMuaW5pdFN0b3JhZ2VEYXRhKHRydWUpOwogICAgfSwKICAgIGVsaW1pbmF0ZUdob3N0aW5nKGV2ZW50KSB7CiAgICAgIGxldCBkcmFnSWNvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpOwogICAgICBkcmFnSWNvbi5zcmMgPSAnZGF0YTppbWFnZS9naWY7YmFzZTY0LFIwbEdPRGxoQVFBQkFJQUFBQUFBQVAvLy95SDVCQUVBQUFBQUxBQUFBQUFCQUFFQUFBSUJSQUE3JywKICAgICAgZHJhZ0ljb24ud2lkdGggPSAwOwogICAgICBkcmFnSWNvbi5oZWlnaHQgPSAwOwogICAgICBkcmFnSWNvbi5vcGFjaXR5ID0gMDsKICAgICAgaWYoZXZlbnQgJiYgZXZlbnQuZGF0YVRyYW5zZmVyKSB7CiAgICAgICAgZXZlbnQuZGF0YVRyYW5zZmVyLnNldERyYWdJbWFnZShkcmFnSWNvbiwwLCAwKTsKICAgICAgfQoKICAgIH0sCiAgICBzYXZlRGF0YUluZm86ZnVuY3Rpb24oc3RhdGUsIG1zZ3MpIHsKICAgICAgbGV0IHR5cGUgPSBzdGF0ZSB8fCAnc3VjY2Vzcyc7CiAgICAgIGxldCBtc2cgPSBtc2dzIHx8ICfmlbDmja7kv53lrZjmiJDlip/vvIEnOwogICAgICBWdWUuJHRvYXN0Lm9wZW4oewogICAgICAgIHR5cGU6dHlwZSwKICAgICAgICBtZXNzYWdlOm1zZywKICAgICAgICBwb3NpdGlvbjondG9wLXJpZ2h0JwogICAgICB9KTsKICAgIH0sCiAgfQp9Cg=="},{"version":3,"sources":["editor.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwDA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"editor.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div id=\"editor\">\n    <!-- 组件库 -->\n    <editor-comps \n      v-bind:elements=\"edrawComponents\"\n      v-bind:webConfig=\"webConfig\"\n      v-on:initCompsState=\"initComponentState\" \n      v-on:selectComp=\"selectComp\"></editor-comps>\n    \n    <!-- 画布 -->\n    <editor-canvas \n      v-bind:configs=\"configs\"\n      v-bind:edrawComps=\"edrawComponents\"\n      v-bind:currentActiveIndex=\"eStates.currentActiveIndex\"\n      v-bind:multipleActiveBool=\"eStates.multipleActiveBool\"\n      v-on:initCompsState=\"initComponentState\" \n      v-on:dragComp=\"dragCurrentComp\"\n      v-on:resizeByDragComp=\"resizeByDragComp\"\n      v-on:trans=\"transComp\"\n      v-on:changeTextVal=\"changeTextVal\"\n      v-on:screen=\"screen\"></editor-canvas>\n\n    <!-- 组件设置 -->\n    <editor-settings\n      v-bind:currentActiveIndex=\"eStates.currentActiveIndex\"\n      v-bind:currentElement=\"edrawComponents[eStates.currentActiveIndex]\"\n      v-bind:multipleActiveArr=\"eStates.multipleActiveArr\"\n      v-bind:configs=\"configs\"\n      v-on:delComp=\"delComp\"\n      v-on:delMultipComp=\"delMultipComp\"\n      v-on:setMultipleState=\"setMultipleState\"\n      v-on:changeConfig=\"changeConfig\"\n      v-on:download=\"download\"\n      v-on:screen=\"screen\"\n      v-on:saveDateToStorage=\"saveDateToStorage\"\n      v-on:getHistory=\"getStorageData\"\n      v-on:changeBgImg=\"changeBgImg\"\n      v-on:selColor=\"selColor\"\n      v-on:selBackground=\"selBackground\"></editor-settings>\n    \n    <editor-history \n      v-if=\"activeHistoryBool\"\n      v-bind:list=\"historyCurrnetData\"\n      v-bind:currentIndex=\"currentHistoryIndex\"\n      v-on:initState=\"initHistoryListState\"\n      v-on:applyHistory=\"applyHistory\"\n      v-on:closeHistory=\"closeHistory\"\n      v-on:deleteHistoryData=\"deleteHistoryData\"\n      v-on:clerarHistoryData=\"clearStorageData\"\n      ></editor-history>\n    <!-- 帮助 -->\n    <editor-help/>\n  </div>\n</template>\n\n<script>\nimport Vue from 'vue';\nimport EditorComps from './editor-comps';\nimport EditorCanvas from './editor-canvas';\nimport EditorSettings from './editor-settings';\nimport EditorHelp from './editor-help';\nimport EditorHistory from './editor-history';\nimport _ from 'lodash';  \n\nexport default {\n  name: 'Editor',\n  created:function() {\n    this.initStorageData();\n    this.initBindingEvent();\n    this.initData\n  },\n  mounted:function() {\n\n  },\n  \n  data(){\n     return {\n        eStates:{\n          currentActiveIndex:-1,\n          copyByKeyBool:false,\n          multipleActiveArr:[],\n        },\n        edrawComponents:[],\n        configs:{\n          bg:\"grid\",\n          pageName:'底图',\n          spacing:10,\n          scale:1,\n          dragIconSize:2,\n          Isometric_row:10,\n          Isometric_colu:10,\n          dowloadImgType:'png',\n          bgAllBool:false,\n          width: 2945,\n          height: 1445,\n          maxWidth:3445,\n          maxHieght:1505,\n          backgroundUrl:\"\",\n        },\n        webConfig: {\n          custom: 25,\n          auto:5,\n        },\n        historyCurrnetData:[],\n        currentHistoryIndex:-1,\n        activeHistoryBool:false\n     }\n  },\n  components: {\n    'editor-comps':EditorComps,\n    'editor-canvas':EditorCanvas,\n    'editor-settings':EditorSettings,\n    'editor-help':EditorHelp,\n    'editor-history':EditorHistory\n  },\n  methods: {\n    initData() {\n      this.activeHistoryBool = false;\n    },\n    initBindingEvent() {\n      document.addEventListener('keydown', this.kaydownFun, false);\n      document.addEventListener('mousedown', this.mousedownFun);\n      window.addEventListener('beforeunload', this.leaving);\n    },\n    leaving(event) {\n      // this.saveDateToStorage();\n      // console.log(event.returnValue)\n      let message = \"内容更改，注意截图缓存\"; \n      event.returnValue = message;\n      return message;\n    },\n    download:function() {\n      //TODO:页面下载\n    },\n    saveAs:function(img) {\n      let _dom = window.document.createElement('a');\n        _dom.href = img\n        _dom.dataset.downloadurl = ['image/png', 'IMG_DOWNLOAD_NAME', _dom.href].join(':');\n        document.body.appendChild(_dom);\n        _dom.click();\n        document.body.removeChild(_dom);\n    },\n    // 组件选择\n    selectComp(event, comp) {\n      let item = JSON.parse(JSON.stringify(comp));\n      if(!item) return;\n      this.initCompState();\n      item.isActive = true;\n      item.multipleActiveBool=false;\n      let rect = document.getElementById('canvas').getClientRects()[0];\n      let {\n        width, \n        height, \n        borderRadius, \n        rotate, \n        borderWidth, \n        background, \n        isApplyShadow, \n        bgiBool, \n        color,\n        border,\n        opacity } = item.defStyle;\n      let {clientX , clientY} = event;\n      let _style = {\n          width:width || 100,\n          height:height || 100,\n          top: clientY  - rect.top + 60 || 100,\n          left:clientX + 213 - rect.left || 100,\n          rotate: rotate || 0,\n          drag_start_x: 0, //拖拽相对\n          drag_start_y :0,\n          borderWidth:borderWidth || 0,\n          background:background,\n          isApplyShadow:isApplyShadow  === undefined || isApplyShadow === null ? 'true' : 'false',\n          position:'absolute',\n          isFixed:\"false\",\n          bgiBool:bgiBool || false, //材质\n          borderRadius:borderRadius || 0,\n          border:border ,\n          fontSize: 14,\n          opacity:opacity,\n          color: color\n      }\n      _style.left =Math.max(0,  Math.min(_style.left, this.configs.maxWidth));\n      _style.top =Math.max(0,  Math.min(_style.top, this.configs.maxHieght));\n      item.style = _style;\n      this.edrawComponents.push(item);\n      this.eStates.currentActiveIndex = this.edrawComponents.length -1;\n    },\n    initComponentState(current, event) {\n      if(current === undefined || current === null || current === -1) return;\n      if(event && (event.shiftKey || event.metaKey && this.isMac()) && event.button === 0 ) {\n        this.edrawComponents[current].isActive = false;\n        if(this.eStates.currentActiveIndex > -1) {\n          this.eStates.currentActiveIndex = -1;\n        }\n\n        // 多选操作缓存数组\n        const _multipActiveIndex = this.eStates.multipleActiveArr.indexOf(this.edrawComponents[current]);\n        if( _multipActiveIndex === -1) {\n          this.eStates.multipleActiveArr.push(this.edrawComponents[current])\n        }\n\n        if(this.edrawComponents[current].multipleActiveBool) {\n          this.edrawComponents[current].multipleActiveBool = false;\n          this.eStates.multipleActiveArr.splice(_multipActiveIndex, 1);\n        } else {\n          this.edrawComponents[current].multipleActiveBool = true;\n        }\n      }else {\n        this.initCompState();     \n        this.eStates.currentActiveIndex = current;\n        this.edrawComponents[current].isActive = true;\n      }\n    },\n    // 初始化画布内组件状态\n    initCompState() {\n      let len = this.edrawComponents.length;\n      this.eStates.multipleActiveArr = [];\n      for(let i=0;i<len;i++) {\n        this.edrawComponents[i].isActive = false;\n        this.edrawComponents[i].multipleActiveBool = false;\n      }\n      this.eStates.copyByKeyBool = false;\n    },\n    // 组件拖拽：shiftKey === true 处理多选\n    dragCurrentComp(event, comp, state, currentIndex, canvesRect) {\n      if(event && (event.shiftKey || event.metaKey && this.isMac())  ){\n        console.log('多选处理')\n      } else {\n        this.eStates.copyByKeyBool = false;\n        let _rect = document.getElementById('canvas').getClientRects()[0]\n        let _l =_rect.left;\n        let _t =_rect.left;\n        if(state === 'start') {\n          this.eStates.currentActiveIndex = currentIndex;\n          console.log( event.clientX , comp.style.left , _l , canvesRect.x, this.configs.scale)\n          comp.style.drag_start_x = event.clientX - comp.style.left - _l + canvesRect.x;\n          comp.style.drag_start_y = event.clientY - comp.style.top - _t + canvesRect.y;\n        }else if(state === 'drag'){\n          let _left = event.clientX  - comp.style.drag_start_x  - _l + canvesRect.x; \n          let _top = event.clientY - comp.style.drag_start_y - _t + canvesRect.y ;\n          if(_left <0 || _top < 0) return;\n          _left =Math.max(0,  Math.min(_left, this.configs.maxWidth));\n          _top = Math.max(0, Math.min(_top, this.configs.maxHieght));\n          comp.style.left = _left;\n          comp.style.top = _top ;\n        }\n        if(['start', 'drag'].indexOf(state) > -1) {\n          this.eliminateGhosting(event); // 消除拖拽鬼影\n        } \n        \n      }\n    },\n    resizeByDragComp(event, comp, state, arrow,currentIndex) {\n      if(event && (event.shiftKey || event.metaKey && this.isMac())  ){\n        console.log('多选处理')\n      } else {\n        this.eStates.copyByKeyBool = false;\n        let _l = document.getElementById('canvas').getClientRects()[0].left;\n        let _t = document.getElementById('canvas').getClientRects()[0].top;\n        if(state === 'start') {\n          this.eStates.currentActiveIndex = currentIndex;\n          comp.style.drag_start_x = arrow === 'r' ? comp.style.left:\n                                    arrow === 'l' ?comp.style.left + comp.style.width + _l - 213 :\n                                    10;\n          comp.style.drag_start_y = arrow === 'b' ? comp.style.top  :\n                                    arrow === 't' ?comp.style.top + comp.style.height  :\n                                    10;\n        }else if(state === 'drag'){\n          let _width = 0;\n          let _top = 0;\n          let _height = 0;\n     \n          switch(arrow) {\n            case 'r':\n              _width = parseInt((event.clientX- _l) /this.configs.scale) - comp.style.drag_start_x  + 213; \n              _width = Math.min(_width, this.configs.width) ;\n              comp.style.width = _width >= 10 ? _width: 10;\n              break;\n            case 'l':\n              comp.style.left = (event.clientX - _l)/this.configs.scale + 213 ; \n              _width = comp.style.drag_start_x - event.clientX /this.configs.scale ;\n              _width =Math.max(0,  Math.min(_width, this.configs.maxWidth));\n              comp.style.width = _width >= 10 ? _width: 10;\n              break;\n            case 't':\n              comp.style.top = (event.clientY -_t )/ this.configs.scale + 60;\n              _height = comp.style.drag_start_y - event.clientY /this.configs.scale;\n              _height =Math.max(10,  Math.min(_height, this.configs.maxWidth));\n              comp.style.height = _height >= 10 ? _height : 10;\n              break;\n            case 'b':\n              _top = _t >=0 ? ((event.clientY - _t) / this.configs.scale- comp.style.drag_start_y + 60) :event.clientY - comp.style.drag_start_y - _t  + 60;\n              _top = Math.max(10, Math.min(_top, this.configs.maxWidth));\n              comp.style.height = _top >= 10 ? _top: 10;\n              break;\n            default:\n              break\n          }\n        }\n      }\n    },\n    transComp(event, comp){\n        let _x = event.clientX - comp.style.left - comp.style.width / 2;\n        let _y = event.clientY - comp.style.top - comp.style.height / 2;\n        comp.style.rotate = this.calcAngleDegrees(_x, _y);\n    },\n    changeTextVal(event, item) {\n      let val = event.target.innerText;\n      if(event && item) {\n        item.value = val;\n        event.target.innerText = item.value;\n      }\n    },\n    // 组件删除\n    delComp(index, state) {\n      if(state === 'multipleDel') {\n        let len = this.edrawComponents.length;\n        this.eStates.multipleActiveArr = [];\n        for(let i=len;i--;i >0) {\n          let multipBool = this.edrawComponents[i].multipleActiveBool;\n          if(multipBool) {\n            this.edrawComponents.splice(i,1)\n          }\n        }\n      } else {\n        if(this.eStates.currentActiveIndex > -1 &&this.edrawComponents.length > 0) {\n          this.edrawComponents.splice(this.eStates.currentActiveIndex,1)\n          this.eStates.currentActiveIndex = -1;\n        }\n      }\n    },\n    // 键盘事件\n    kaydownFun(event) {\n      if(event.key === 'v' && document.activeElement.nodeName === 'INPUT') {\n        return;\n      }else if(event.key === 'c' &&  document.activeElement.nodeName === 'INPUT') {\n        document.activeElement.blur();\n      }\n      if(event.target.nodeName === 'INPUT' && this.eStates.copyByKeyBool) {\n         this.eStates.copyByKeyBool = false;\n      }\n      if(event.key === 'c') {\n        this.eStates.copyByKeyBool = true;\n      }else if(this.eStates.copyByKeyBool && event.key === 'v') {\n        this.copyCurrentComp();\n      }else if(event.target.nodeName !== 'INPUT'){\n        if(['ArrowUp','ArrowDown','ArrowLeft',\"ArrowRight\"].indexOf(event['code'])> -1) {\n          event.preventDefault();\n          if(this.eStates.currentActiveIndex > -1 && this.eStates.multipleActiveArr.length === 0) {\n            this.arrowItem(event['code'], this.edrawComponents[this.eStates.currentActiveIndex])\n          }else if(this.eStates.multipleActiveArr.length > 0){\n            let len = this.eStates.multipleActiveArr.length;\n            for(let i=0;i<len;i++){\n               this.arrowItem(event['code'], this.eStates.multipleActiveArr[i])\n            }\n          }\n        }\n      }\n      if(event.key === 'Delete' || this.isMac() && event.key === 'Backspace')  {\n        if(!(event.target.innerHTML && event.target.contentEditable) || event.target.contentEditable === 'inherit') {\n          this.delComp();\n        }\n      }\n    },\n    arrowItem(arrow, obj) {\n      if(arrow && obj) {\n        switch (arrow) {\n          case 'ArrowUp' :\n            obj.style.top = (obj.style.top - 1) > 0 ? ( obj.style.top - 1) : 0;\n            break;\n          case 'ArrowDown' :\n            obj.style.top = obj.style.top + 1;\n            break;\n          case 'ArrowLeft' :\n            obj.style.left = (obj.style.left -1 )> 0? (obj.style.left -1) : 0;\n            break;\n          case 'ArrowRight':\n            obj.style.left =  obj.style.left +1;\n            break;\n          default:\n            break;\n        }\n      }\n    },\n    // 多选事件\n    mousedownFun(event) {\n      this.eliminateGhosting(event); // 消除拖拽鬼影\n      if(event && event.shiftKey && this.eStates.currentActiveIndex > -1) {\n        this.edrawComponents[this.eStates.currentActiveIndex].isActive = false;\n        this.eStates.currentActiveIndex = -1;\n      }\n      if((!event.shiftKey || !event.metaKey && this.isMac()) && event.button === 0 \n        && event.target.id==='canvas' \n        && !event.target.classList.contains('comp-element')) {\n        this.eStates.copyByKeyBool = false;\n        this.initCompState();\n      } \n    },\n    // 创建当前组件\n    copyCurrentComp:function() {\n      let _currComp = this.edrawComponents[this.eStates.currentActiveIndex];\n      if(!_currComp) return;\n      _currComp.isActive = false;\n      let _copy = JSON.parse(JSON.stringify(_currComp));\n      let _style = _currComp.style;\n      let _val = 10;\n      let _h = _val;\n      _copy.style.top = parseInt(_style.height) + parseInt(_style.top) + parseInt(_h);\n      _copy.style.top = Math.max(0, Math.min(_copy.style.top, this.configs.maxHieght));\n      _copy.isActive = true;\n      this.edrawComponents.push(_copy);\n      this.eStates.currentActiveIndex = this.edrawComponents.length - 1; //更新激活组件的下标\n    },\n    // 多选操作:反选/清空多选/属性应用\n    setMultipleState:function(state, value) {\n      if(state === 'Isometric') {\n        for(let i = this.eStates.multipleActiveArr.length-1;i>=0;i--) {\n          let obj = this.eStates.multipleActiveArr[i];\n          let bool = obj['multipleActiveBool'];\n          if(!bool) {\n            this.eStates.multipleActiveArr.splice(i,1);\n          }\n        }\n        let len = this.eStates.multipleActiveArr.length;\n        let val = 0;\n        if(value === 'row') {\n          this.eStates.multipleActiveArr =  this.eStates.multipleActiveArr.sort(function(a,b){\n            return parseInt(a.style.left) - parseInt(b.style.left);\n          })\n          for(let i=0;i< len;i++) {\n            let item = this.eStates.multipleActiveArr[i];\n            if(i>0) {\n              item.style.left = val;\n            }\n            val = parseInt(item.style.left) + parseInt(item.style.width) + parseInt(this.configs.Isometric_row);\n            val = Math.max(0, Math.min(val, this.configs.maxWidth));\n          }\n        } else {\n          this.eStates.multipleActiveArr =  this.eStates.multipleActiveArr.sort(function(a,b){\n            return parseInt(a.style.top) - parseInt(b.style.top) ;\n          })\n          for(let i=0;i< len;i++) {\n            let item = this.eStates.multipleActiveArr[i];\n            if(i>0) {\n              item.style.top = val;\n            }\n            val = parseInt(item.style.height) + parseInt(item.style.top) + parseInt(this.configs.Isometric_colu);\n            val = Math.max(0,  Math.min(val, this.configs.maxHieght));\n          }\n        }     \n      }else if(state === 'reSel') {\n        let len = this.edrawComponents.length;\n        this.eStates.multipleActiveArr = [];\n        for(let i=len;i--;i >0) {\n          let item = this.edrawComponents[i];\n          if(!item.multipleActiveBool) {  \n            this.eStates.multipleActiveArr.push(item);\n          }\n          item.multipleActiveBool = !item.multipleActiveBool;\n        }\n      } else if(state === 'clear'){\n        let len = this.edrawComponents.length;\n        this.eStates.multipleActiveArr = [];\n        for(let i=len;i--;i >0) {\n          this.edrawComponents[i].multipleActiveBool = false;\n        }\n      }else if(['isApplyShadow', 'borderRadius'].indexOf(state) > -1) {\n        let len = this.eStates.multipleActiveArr.length;\n        for(let i=len;i--;i >0) {\n          this.eStates.multipleActiveArr[i].style[state] = value;\n        }\n      }else if(state === 'align') {\n        switch(value) {\n          case 't' :\n            this.multipArray('top');\n            break;\n          case 'l' :\n            this.multipArray('left');\n            break;\n          case 'b' :\n            this.multipArray('bottom');\n            break;\n          case 'r' :\n            this.multipArray('right');\n            break;\n          default:\n            break;\n        }\n      }\n    },\n    // 删除多选元素\n    delMultipComp(comp, index) {\n      this.eStates.multipleActiveArr.splice(index, 1);\n      let _index = this.edrawComponents.indexOf(comp);\n      if(_index > -1) {\n        this.edrawComponents[_index].multipleActiveBool = false;\n      }\n    },\n    changeConfig(state, value){\n      if(!this.configs[state]) return;\n      if(state === 'bg') {\n        this.changeBgImg()\n      }\n      this.configs[state] = value;\n    },\n    multipArray(param) {\n      let list = JSON.parse(JSON.stringify(this.eStates.multipleActiveArr));\n      list.sort(function(a, b) {\n        return ['top', 'left'].indexOf(param) > -1 ? parseInt(a.style[param]) - parseInt(b.style[param]):\n          param === 'bottom' ? parseInt(b.style.top) + parseInt(b.style.height) - (parseInt(a.style.top) + parseInt(a.style.height)) :\n          parseInt(b.style.left) + parseInt(b.style.width) - (parseInt(a.style.left) + parseInt(a.style.width)) \n      });\n      let len = this.eStates.multipleActiveArr.length;\n      let resObj = list[0];\n      if(['top', 'left'].indexOf(param) > -1) {\n        for(let i=0;i<len;i++) {\n          this.eStates.multipleActiveArr[i].style[param] = resObj.style[param];\n        }\n      }else if(param === 'bottom') {\n        let _bottom = parseInt( resObj.style.top )+ parseInt(resObj.style.height);\n        for(let i=0;i<len;i++) {\n          console.log(_bottom, this.eStates.multipleActiveArr[i].style.height, _bottom- this.eStates.multipleActiveArr[i].style.height)\n          this.eStates.multipleActiveArr[i].style.top = _bottom - this.eStates.multipleActiveArr[i].style.height;\n        }\n      }else if(param === 'right') {\n        let _right = parseInt(resObj.style.left) + parseInt(resObj.style.width);\n        for(let i=0;i<len;i++) {\n          this.eStates.multipleActiveArr[i].style.left = _right - this.eStates.multipleActiveArr[i].style.width;\n        }\n      }\n    },\n    isMac:function() {\n      return /macintosh|mac os x/i.test(navigator.userAgent)\n    },\n    calcAngleDegrees(x, y) {\n      let val =  Math.atan2(y, x) * 180 / Math.PI;\n      return Math.ceil(val);\n    },\n    selColor(comp, color) {\n      if(this.eStates.currentActiveIndex > -1 && this.edrawComponents[this.eStates.currentActiveIndex]) {\n        this.edrawComponents[this.eStates.currentActiveIndex].style.color = color;\n      }\n    },\n    selBackground(comp, bgColor) {\n      if(this.eStates.currentActiveIndex > -1 && this.edrawComponents[this.eStates.currentActiveIndex]) {\n        this.edrawComponents[this.eStates.currentActiveIndex].style.background = bgColor;\n      }\n    },\n    screen:function() {\n      this.configs.bgAllBool = !this.configs.bgAllBool;\n      if(this.configs.bgAllBool) {\n        // this.configs.window_w = window.screen.width > 1500 ? window.screen.width : 1500;\n        // this.configs.window_h = window.screen.height > 800 ? window.screen.height : 800;\n        this.configs.window_w = 2985;\n        this.configs.window_h = 1445\n        this.configs.scale = 1;\n      }\n    },\n    initStorageData(clearBool) {\n      if(!clearBool && window.localStorage.getItem('bm_datas')) return;\n      let params = {\n          save_data_auto:[],\n          save_data_custom:[]\n      }\n      window.localStorage.setItem('bm_datas', JSON.stringify(params));\n    },\n    saveDateToStorage(data, state) {\n      let saveData = data || this.edrawComponents;\n      //存储优化，没有内容的页面不需要存储\n      if(!saveData || Array.isArray(saveData) && saveData.length === 0) {\n        return;\n      }\n      let obj = {\n        data: saveData,\n        type: state || 'auto',\n        updateTime:new Date()\n      };\n      if(!window.localStorage.getItem('bm_datas')) {\n        this.initStorageData();\n      }\n      let params = window.localStorage.getItem('bm_datas');\n      if(params && typeof params === 'string') {\n        params = JSON.parse(params)\n      }\n      if(!this.webConfig) {\n        this.initConfig();\n      }\n      if(state === 'custom') {\n        params.save_data_custom.unshift(obj);\n        if(params.save_data_custom.length >  this.webConfig.custom) {\n          params.save_data_custom = params.save_data_custom.slice(0, this.webConfig.custom);\n        }\n      } else {\n        params.save_data_auto.unshift(obj);\n        if(params.save_data_auto.length >  this.webConfig.auto) {\n          params.save_data_auto = params.save_data_auto.slice(0,  this.webConfig.auto);\n        }\n      }\n      this._saveWebStorage(params);\n      this.currentHistoryIndex = -1;\n    },\n    getStorageData(reloadBool) {\n      if(!reloadBool) {\n        this.activeHistoryBool = !this.activeHistoryBool;\n      }\n      this.currentHistoryIndex = -1;\n      let params = window.localStorage.getItem('bm_datas');\n      if(params && typeof params === 'string') {\n        params = JSON.parse(params)\n      }\n      let list = [].concat(params.save_data_custom, params.save_data_auto);\n      this.historyCurrnetData = _.orderBy(list, 'updateTime', \"desc\");\n    },\n    _saveWebStorage(params, delSaveBool) {\n      let seccMessage = delSaveBool ? \"删除成功\": \"保存成功\";\n      let errMessage  = delSaveBool ? \"删除失败\": \n                        encodeURIComponent(JSON.stringify(localStorage).length) > (1024 * 1024 * 5 - 100) ? '数据超过历史数据最大值，请删除历史不需要的数据重新存储' :\"保存数据出错\";\n      try {\n        window.localStorage.setItem('bm_datas', JSON.stringify(params));\n        this.saveDataInfo(\"success\",seccMessage);\n      }catch {\n        this.saveDataInfo('error',errMessage)\n      }\n      if(this.activeHistoryBool) {\n        this.getStorageData(true);\n      }\n    },\n    initConfig() {\n      if(window.localStorage.getItem('bm_datas')) return;\n      let params = {\n        custom:50,\n        auto:50,\n      }\n      window.localStorage.setItem('configs', JSON.stringify(params));\n    },\n    deleteHistoryData(index) {\n      let currentData = this.historyCurrnetData[index];\n      if(currentData) {\n        delete currentData.isActive;\n      }\n      if(!window.localStorage.getItem('bm_datas')) {\n        this.initStorageData();\n      }\n      let params = window.localStorage.getItem('bm_datas');\n      if(params && typeof params === 'string') {\n        params = JSON.parse(params);\n      }\n      if(params) {\n        let c = params.save_data_custom\n        let len_c =  c.length;\n        let hasBool = false;\n        for(let i=0;i<len_c;i++) {\n          let item = c[i];\n          if(item && currentData && item.updateTime === currentData.updateTime) {\n            params.save_data_custom.splice(i, 1);\n            hasBool = true;\n          }\n        }\n        if(!hasBool) {\n          let a = params.save_data_auto;\n          let len_a = a.length;\n          for(let i=0;i<len_a;i++) {\n            let item = a[i];\n            if(item && currentData && item.updateTime === currentData.updateTime) {\n              params.save_data_auto.splice(i, 1);\n            }\n          }\n        }\n        this._saveWebStorage(params, true)\n      }\n    },\n    clearStorageData() {\n      this.initStorageData(true);\n      this.getStorageData(true);\n    },\n    changeBgImg(url) {\n      this.configs.backgroundUrl = url;\n    },\n    initHistoryListState(index) {\n      this.currentHistoryIndex = index > -1 ? index : -1;\n      if(Array.isArray(this.historyCurrnetData)) {\n        let len = this.historyCurrnetData.length;\n        for(let i=0;i<len;i++) {\n            if(this.historyCurrnetData && this.historyCurrnetData[i]) {\n             this.historyCurrnetData[i].isActive = false;\n           }\n        }\n      }\n    },\n    applyHistory(list) {\n      this.edrawComponents = list;\n      this.initCompState();\n      this.closeHistory();\n    },\n    closeHistory() {\n      this.activeHistoryBool = false;\n    },\n    clerarHistoryData(){\n      this.initStorageData(true);\n    },\n    eliminateGhosting(event) {\n      let dragIcon = document.createElement('img');\n      dragIcon.src = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7',\n      dragIcon.width = 0;\n      dragIcon.height = 0;\n      dragIcon.opacity = 0;\n      if(event && event.dataTransfer) {\n        event.dataTransfer.setDragImage(dragIcon,0, 0);\n      }\n\n    },\n    saveDataInfo:function(state, msgs) {\n      let type = state || 'success';\n      let msg = msgs || '数据保存成功！';\n      Vue.$toast.open({\n        type:type,\n        message:msg,\n        position:'top-right'\n      });\n    },\n  }\n}\n</script>\n\n<style>\n\n#editor {\n  margin-top: 60px;\n  padding: 0;\n  position: relative;\n  color: #2c3e50;\n  display: grid;\n  grid-template-columns: 205px auto 205px;\n}\n</style>\n"]}]}