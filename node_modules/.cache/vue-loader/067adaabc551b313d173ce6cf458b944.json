{"remainingRequest":"/Users/liangma/Desktop/workspace/BaseMap/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/liangma/Desktop/workspace/BaseMap/src/components/editor.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/liangma/Desktop/workspace/BaseMap/src/components/editor.vue","mtime":1589124374956},{"path":"/Users/liangma/Desktop/workspace/BaseMap/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/liangma/Desktop/workspace/BaseMap/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/liangma/Desktop/workspace/BaseMap/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/liangma/Desktop/workspace/BaseMap/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBFZGl0b3JDb21wcyBmcm9tICcuL2VkaXRvci1jb21wcyc7CmltcG9ydCBFZGl0b3JDYW52YXMgZnJvbSAnLi9lZGl0b3ItY2FudmFzJzsKaW1wb3J0IEVkaXRvclNldHRpbmdzIGZyb20gJy4vZWRpdG9yLXNldHRpbmdzJzsKaW1wb3J0IEVkaXRvckhlbHAgZnJvbSAnLi9lZGl0b3ItaGVscCc7CmltcG9ydCBFZGl0b3JIaXN0b3J5IGZyb20gJy4vZWRpdG9yLWhpc3RvcnknOwoKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICdFZGl0b3InLAogIGNyZWF0ZWQ6ZnVuY3Rpb24oKSB7CiAgICB0aGlzLmluaXRTdG9yYWdlRGF0YSgpOwogICAgdGhpcy5pbml0QmluZGluZ0V2ZW50KCk7CiAgfSwKICBkYXRhKCl7CiAgICAgcmV0dXJuIHsKICAgICAgICBlU3RhdGVzOnsKICAgICAgICAgIGN1cnJlbnRBY3RpdmVJbmRleDotMSwKICAgICAgICAgIGNvcHlCeUtleUJvb2w6ZmFsc2UsCiAgICAgICAgICBtdWx0aXBsZUFjdGl2ZUFycjpbXSwKICAgICAgICB9LAogICAgICAgIGVkcmF3Q29tcG9uZW50czpbXSwKICAgICAgICBjb25maWdzOnsKICAgICAgICAgIGJnOiJncmlkIiwKICAgICAgICAgIHBhZ2VOYW1lOiflupXlm74nLAogICAgICAgICAgc3BhY2luZzoxMCwKICAgICAgICAgIHNjYWxlOjEsCiAgICAgICAgICBJc29tZXRyaWNfcm93OjEwLAogICAgICAgICAgSXNvbWV0cmljX2NvbHU6MTAsCiAgICAgICAgICBkb3dsb2FkSW1nVHlwZToncG5nJywKICAgICAgICAgIGJnQWxsQm9vbDpmYWxzZSwKICAgICAgICAgIHdpbmRvd193OjE5MjAsCiAgICAgICAgICB3aW5kb3dfaDo5MDAsCiAgICAgICAgICBiYWNrZ3JvdW5kVXJsOiIiCiAgICAgICAgfSwKICAgICAgICBoaXN0b3J5Q3Vycm5ldERhdGE6W10sCiAgICAgICAgY3VycmVudEhpc3RvcnlJbmRleDotMSwKICAgICAgICBhY3RpdmVIaXN0b3J5Qm9vbDpmYWxzZQogICAgIH0KICB9LAogIGNvbXBvbmVudHM6IHsKICAgICdlZGl0b3ItY29tcHMnOkVkaXRvckNvbXBzLAogICAgJ2VkaXRvci1jYW52YXMnOkVkaXRvckNhbnZhcywKICAgICdlZGl0b3Itc2V0dGluZ3MnOkVkaXRvclNldHRpbmdzLAogICAgJ2VkaXRvci1oZWxwJzpFZGl0b3JIZWxwLAogICAgJ2VkaXRvci1oaXN0b3J5JzpFZGl0b3JIaXN0b3J5CiAgfSwKICBtZXRob2RzOiB7CiAgICBpbml0RGF0YSgpIHsKICAgICAgdGhpcy5hY3RpdmVIaXN0b3J5Qm9vbCA9IGZhbHNlOwogICAgfSwKICAgIGluaXRCaW5kaW5nRXZlbnQoKSB7CiAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCB0aGlzLmtheWRvd25GdW4sIGZhbHNlKTsKICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgdGhpcy5tb3VzZWRvd25GdW4pOwogICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignYmVmb3JldW5sb2FkJywgdGhpcy5sZWF2aW5nKTsKICAgIH0sCiAgICBsZWF2aW5nKGV2ZW50KSB7CiAgICAgIHRoaXMuc2F2ZURhdGVUb1N0b3JhZ2UoKTsKICAgICAgY29uc29sZS5sb2coZXZlbnQucmV0dXJuVmFsdWUpCiAgICAgIC8vIGxldCBtZXNzYWdlID0gIuWGheWuueabtOaUue+8jOazqOaEj+aIquWbvue8k+WtmCI7IAogICAgICAvLyBldmVudC5yZXR1cm5WYWx1ZSA9IG1lc3NhZ2U7CiAgICAgIC8vIHJldHVybiBtZXNzYWdlOwogICAgfSwKICAgIGRvd25sb2FkOmZ1bmN0aW9uKCkgewogICAgICAvL1RPRE866aG16Z2i5LiL6L29CiAgICB9LAogICAgc2F2ZUFzOmZ1bmN0aW9uKGltZykgewogICAgICBsZXQgX2RvbSA9IHdpbmRvdy5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7CiAgICAgICAgX2RvbS5ocmVmID0gaW1nCiAgICAgICAgX2RvbS5kYXRhc2V0LmRvd25sb2FkdXJsID0gWydpbWFnZS9wbmcnLCAnSU1HX0RPV05MT0FEX05BTUUnLCBfZG9tLmhyZWZdLmpvaW4oJzonKTsKICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKF9kb20pOwogICAgICAgIF9kb20uY2xpY2soKTsKICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKF9kb20pOwogICAgfSwKICAgIC8vIOe7hOS7tumAieaLqQogICAgc2VsZWN0Q29tcChldmVudCwgY29tcCkgewogICAgICBsZXQgaXRlbSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoY29tcCkpOwogICAgICBpZighaXRlbSkgcmV0dXJuOwogICAgICB0aGlzLmluaXRDb21wU3RhdGUoKTsKICAgICAgaXRlbS5pc0FjdGl2ZSA9IHRydWU7CiAgICAgIGl0ZW0ubXVsdGlwbGVBY3RpdmVCb29sPWZhbHNlOwogICAgICBsZXQge3dpZHRoLCBoZWlnaHQsIGJvcmRlclJhZGl1cywgcm90YXRlLCBib3JkZXJXaWR0aCwgYmFja2dyb3VuZH0gPSBpdGVtLmRlZlN0eWxlOwogICAgICBsZXQge2NsaWVudFggLCBjbGllbnRZfSA9IGV2ZW50OwogICAgICBsZXQgX3N0eWxlID0gewogICAgICAgICAgd2lkdGg6d2lkdGggfHwgMTAwLAogICAgICAgICAgaGVpZ2h0OmhlaWdodCB8fCAxMDAsCiAgICAgICAgICB0b3A6IGNsaWVudFkgfHwgMTAwLAogICAgICAgICAgbGVmdDpjbGllbnRYIHx8IDEwMCwKICAgICAgICAgIHJvdGF0ZTogcm90YXRlIHx8IDAsCiAgICAgICAgICBkcmFnX3N0YXJ0X3g6IDAsIC8v5ouW5ou955u45a+5CiAgICAgICAgICBkcmFnX3N0YXJ0X3kgOjAsCiAgICAgICAgICBib3JkZXJXaWR0aDpib3JkZXJXaWR0aCB8fCAwLAogICAgICAgICAgYmFja2dyb3VuZDpiYWNrZ3JvdW5kLAogICAgICAgICAgcG9zaXRpb246J2Fic29sdXRlJywKICAgICAgICAgIGlzQXBwbHlTaGFkb3c6J3RydWUnLAogICAgICAgICAgaXNGaXhlZDoiZmFsc2UiLAogICAgICAgICAgYm9yZGVyUmFkaXVzOmJvcmRlclJhZGl1cyB8fCAwCiAgICAgIH0KICAgICAgaXRlbS5zdHlsZSA9IF9zdHlsZTsKICAgICAgdGhpcy5lZHJhd0NvbXBvbmVudHMucHVzaChpdGVtKTsKICAgICAgdGhpcy5lU3RhdGVzLmN1cnJlbnRBY3RpdmVJbmRleCA9IHRoaXMuZWRyYXdDb21wb25lbnRzLmxlbmd0aCAtMTsKICAgIH0sCiAgICBpbml0Q29tcG9uZW50U3RhdGUoY3VycmVudCwgZXZlbnQpIHsKICAgICAgaWYoY3VycmVudCA9PT0gdW5kZWZpbmVkIHx8IGN1cnJlbnQgPT09IG51bGwgfHwgY3VycmVudCA9PT0gLTEpIHJldHVybjsKICAgICAgaWYoZXZlbnQgJiYgKGV2ZW50LmN0cmxLZXkgfHwgZXZlbnQubWV0YUtleSAmJiB0aGlzLmlzTWFjKCkpICYmIGV2ZW50LmJ1dHRvbiA9PT0gMCApIHsKICAgICAgICB0aGlzLmVkcmF3Q29tcG9uZW50c1tjdXJyZW50XS5pc0FjdGl2ZSA9IGZhbHNlOwogICAgICAgIGlmKHRoaXMuZVN0YXRlcy5jdXJyZW50QWN0aXZlSW5kZXggPiAtMSkgewogICAgICAgICAgdGhpcy5lU3RhdGVzLmN1cnJlbnRBY3RpdmVJbmRleCA9IC0xOwogICAgICAgIH0KCiAgICAgICAgLy8g5aSa6YCJ5pON5L2c57yT5a2Y5pWw57uECiAgICAgICAgY29uc3QgX211bHRpcEFjdGl2ZUluZGV4ID0gdGhpcy5lU3RhdGVzLm11bHRpcGxlQWN0aXZlQXJyLmluZGV4T2YodGhpcy5lZHJhd0NvbXBvbmVudHNbY3VycmVudF0pOwogICAgICAgIGlmKCBfbXVsdGlwQWN0aXZlSW5kZXggPT09IC0xKSB7CiAgICAgICAgICB0aGlzLmVTdGF0ZXMubXVsdGlwbGVBY3RpdmVBcnIucHVzaCh0aGlzLmVkcmF3Q29tcG9uZW50c1tjdXJyZW50XSkKICAgICAgICB9CgogICAgICAgIGlmKHRoaXMuZWRyYXdDb21wb25lbnRzW2N1cnJlbnRdLm11bHRpcGxlQWN0aXZlQm9vbCkgewogICAgICAgICAgdGhpcy5lZHJhd0NvbXBvbmVudHNbY3VycmVudF0ubXVsdGlwbGVBY3RpdmVCb29sID0gZmFsc2U7CiAgICAgICAgICB0aGlzLmVTdGF0ZXMubXVsdGlwbGVBY3RpdmVBcnIuc3BsaWNlKF9tdWx0aXBBY3RpdmVJbmRleCwgMSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuZWRyYXdDb21wb25lbnRzW2N1cnJlbnRdLm11bHRpcGxlQWN0aXZlQm9vbCA9IHRydWU7CiAgICAgICAgfQogICAgICB9ZWxzZSB7CiAgICAgICAgdGhpcy5pbml0Q29tcFN0YXRlKCk7ICAgICAKICAgICAgICB0aGlzLmVTdGF0ZXMuY3VycmVudEFjdGl2ZUluZGV4ID0gY3VycmVudDsKICAgICAgICB0aGlzLmVkcmF3Q29tcG9uZW50c1tjdXJyZW50XS5pc0FjdGl2ZSA9IHRydWU7CiAgICAgIH0KCiAgICB9LAogICAgLy8g5Yid5aeL5YyW55S75biD5YaF57uE5Lu254q25oCBCiAgICBpbml0Q29tcFN0YXRlKCkgewogICAgICBsZXQgbGVuID0gdGhpcy5lZHJhd0NvbXBvbmVudHMubGVuZ3RoOwogICAgICB0aGlzLmVTdGF0ZXMubXVsdGlwbGVBY3RpdmVBcnIgPSBbXTsKICAgICAgZm9yKGxldCBpPTA7aTxsZW47aSsrKSB7CiAgICAgICAgdGhpcy5lZHJhd0NvbXBvbmVudHNbaV0uaXNBY3RpdmUgPSBmYWxzZTsKICAgICAgICB0aGlzLmVkcmF3Q29tcG9uZW50c1tpXS5tdWx0aXBsZUFjdGl2ZUJvb2wgPSBmYWxzZTsKICAgICAgfQogICAgICB0aGlzLmVTdGF0ZXMuY29weUJ5S2V5Qm9vbCA9IGZhbHNlOwogICAgfSwKICAgIC8vIOe7hOS7tuaLluaLve+8mmN0cmxrZXkgPT09IHRydWUg5aSE55CG5aSa6YCJCiAgICBkcmFnQ3VycmVudENvbXAoZXZlbnQsIGNvbXAsIHN0YXRlLCBjdXJyZW50SW5kZXgsIGNhbnZlc1JlY3QpIHsKICAgICAgaWYoZXZlbnQgJiYgKGV2ZW50LmN0cmxLZXkgfHwgZXZlbnQubWV0YUtleSAmJiB0aGlzLmlzTWFjKCkpICApewogICAgICAgIGNvbnNvbGUubG9nKCflpJrpgInlpITnkIYnKQogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZVN0YXRlcy5jb3B5QnlLZXlCb29sID0gZmFsc2U7CiAgICAgICAgaWYoc3RhdGUgPT09ICdzdGFydCcpIHsKICAgICAgICAgIHRoaXMuZVN0YXRlcy5jdXJyZW50QWN0aXZlSW5kZXggPSBjdXJyZW50SW5kZXg7CiAgICAgICAgICBjb21wLnN0eWxlLmRyYWdfc3RhcnRfeCA9IGV2ZW50LmNsaWVudFggLSBjb21wLnN0eWxlLmxlZnQ7CiAgICAgICAgICBjb21wLnN0eWxlLmRyYWdfc3RhcnRfeSA9IGV2ZW50LmNsaWVudFkgLSBjb21wLnN0eWxlLnRvcDsKICAgICAgICB9ZWxzZSBpZihzdGF0ZSA9PT0gJ2RyYWcnKXsKICAgICAgICAgIGxldCBfbGVmdCA9IGV2ZW50LmNsaWVudFggLSBjb21wLnN0eWxlLmRyYWdfc3RhcnRfeDsgCiAgICAgICAgICBsZXQgX3RvcCA9IGV2ZW50LmNsaWVudFkgLSBjb21wLnN0eWxlLmRyYWdfc3RhcnRfeTsKICAgICAgICAgIGlmKF9sZWZ0IDwwIHx8IF90b3AgPCAwKSByZXR1cm47CiAgICAgICAgICBsZXQgbGVmdCA9IChfbGVmdCAtIGNhbnZlc1JlY3QueCkgPj0gMCA/IF9sZWZ0IDogY2FudmVzUmVjdC54OyAvLyDlpITnkIZsZWZ057yW6L6R6Zeu6aKYCiAgICAgICAgICBsZXQgdG9wID0gKF90b3AgLSBjYW52ZXNSZWN0LnkpID49IDAgPyBfdG9wIDogY2FudmVzUmVjdC55OyAvLyDlpITnkIZ0b3DovrnnlYzpl67popgKICAgICAgICAgIGNvbXAuc3R5bGUubGVmdCA9IGxlZnQ7CiAgICAgICAgICBjb21wLnN0eWxlLnRvcCA9IHRvcDsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICByZXNpemVCeURyYWdDb21wKGV2ZW50LCBjb21wLCBzdGF0ZSwgYXJyb3csY3VycmVudEluZGV4KSB7CiAgICAgIGlmKGV2ZW50ICYmIChldmVudC5jdHJsS2V5IHx8IGV2ZW50Lm1ldGFLZXkgJiYgdGhpcy5pc01hYygpKSAgKXsKICAgICAgICBjb25zb2xlLmxvZygn5aSa6YCJ5aSE55CGJykKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmVTdGF0ZXMuY29weUJ5S2V5Qm9vbCA9IGZhbHNlOwogICAgICAgIGlmKHN0YXRlID09PSAnc3RhcnQnKSB7CiAgICAgICAgICB0aGlzLmVTdGF0ZXMuY3VycmVudEFjdGl2ZUluZGV4ID0gY3VycmVudEluZGV4OwogICAgICAgICAgY29tcC5zdHlsZS5kcmFnX3N0YXJ0X3ggPSBhcnJvdyA9PT0gJ3InID8gY29tcC5zdHlsZS5sZWZ0IDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJyb3cgPT09ICdsJyA/Y29tcC5zdHlsZS5sZWZ0ICsgY29tcC5zdHlsZS53aWR0aCA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEwOwogICAgICAgICAgY29tcC5zdHlsZS5kcmFnX3N0YXJ0X3kgPSBhcnJvdyA9PT0gJ2InID8gY29tcC5zdHlsZS50b3AgOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcnJvdyA9PT0gJ3QnID9jb21wLnN0eWxlLnRvcCArIGNvbXAuc3R5bGUuaGVpZ2h0IDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMTA7CiAgICAgICAgfWVsc2UgaWYoc3RhdGUgPT09ICdkcmFnJyl7CiAgICAgICAgICBsZXQgX3dpZHRoID0gMDsKICAgICAgICAgIGxldCBfdG9wID0gMDsKICAgICAgICAgIGxldCBfaGVpZ2h0ID0gMDsKICAgICAgICAgIHN3aXRjaChhcnJvdykgewogICAgICAgICAgICBjYXNlICdyJzoKICAgICAgICAgICAgICBfd2lkdGggPSBldmVudC5jbGllbnRYIC0gY29tcC5zdHlsZS5kcmFnX3N0YXJ0X3g7IAogICAgICAgICAgICAgIGNvbXAuc3R5bGUud2lkdGggPSBfd2lkdGggPj0gMTAgPyBfd2lkdGg6IDEwOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdsJzoKICAgICAgICAgICAgICBjb21wLnN0eWxlLmxlZnQgPSBldmVudC5jbGllbnRYOwogICAgICAgICAgICAgIF93aWR0aCA9IGNvbXAuc3R5bGUuZHJhZ19zdGFydF94IC0gZXZlbnQuY2xpZW50WCA7IAogICAgICAgICAgICAgIGNvbXAuc3R5bGUud2lkdGggPSBfd2lkdGggPj0gMTAgPyBfd2lkdGg6IDEwOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICd0JzoKICAgICAgICAgICAgICBjb21wLnN0eWxlLnRvcCA9IGV2ZW50LmNsaWVudFk7CiAgICAgICAgICAgICAgX2hlaWdodCA9IGNvbXAuc3R5bGUuZHJhZ19zdGFydF95IC0gZXZlbnQuY2xpZW50WTsKICAgICAgICAgICAgICBjb21wLnN0eWxlLmhlaWdodCA9IF9oZWlnaHQgPj0gMTAgPyBfaGVpZ2h0IDogMTA7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ2InOgogICAgICAgICAgICAgIF90b3AgPSBldmVudC5jbGllbnRZIC0gY29tcC5zdHlsZS5kcmFnX3N0YXJ0X3k7CiAgICAgICAgICAgICAgY29tcC5zdHlsZS5oZWlnaHQgPSBfdG9wID49IDEwID8gX3RvcDogMTA7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIH0KCiAgICAgICAgfWVsc2UgewogICAgICAgICAgbGV0IF93aWR0aCA9IDA7CiAgICAgICAgICBsZXQgX3RvcCA9IDA7CiAgICAgICAgICBsZXQgX2hlaWdodCA9IDA7CiAgICAgICAgICBzd2l0Y2goYXJyb3cpIHsKICAgICAgICAgICAgY2FzZSAncic6CiAgICAgICAgICAgICAgX3dpZHRoID0gZXZlbnQuY2xpZW50WCAtIGNvbXAuc3R5bGUuZHJhZ19zdGFydF94OyAKICAgICAgICAgICAgICBjb21wLnN0eWxlLndpZHRoID0gX3dpZHRoID4gMTAgPyBfd2lkdGg6IDEwOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdsJzoKICAgICAgICAgICAgICBjb21wLnN0eWxlLmxlZnQgPSBldmVudC5jbGllbnRYOwogICAgICAgICAgICAgIF93aWR0aCA9IGNvbXAuc3R5bGUuZHJhZ19zdGFydF94IC0gZXZlbnQuY2xpZW50WCA7IAogICAgICAgICAgICAgIGNvbXAuc3R5bGUud2lkdGggPSBfd2lkdGggPj0gMTAgPyBfd2lkdGg6IDEwOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICd0JzoKICAgICAgICAgICAgICBjb21wLnN0eWxlLnRvcCA9IGV2ZW50LmNsaWVudFk7CiAgICAgICAgICAgICAgX2hlaWdodCA9IGNvbXAuc3R5bGUuZHJhZ19zdGFydF95IC0gZXZlbnQuY2xpZW50WTsKICAgICAgICAgICAgICBjb21wLnN0eWxlLmhlaWdodCA9IF9oZWlnaHQgPj0gMTAgPyBfaGVpZ2h0IDogMTA7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ2InOgogICAgICAgICAgICAgICBfdG9wID0gZXZlbnQuY2xpZW50WSAtIGNvbXAuc3R5bGUuZHJhZ19zdGFydF95OwogICAgICAgICAgICAgIGNvbXAuc3R5bGUuaGVpZ2h0ID0gX3RvcCA+PSAxMCA/IF90b3A6IDEwOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgdHJhbnNDb21wKGV2ZW50LCBjb21wKXsKICAgICAgICBsZXQgX3ggPSBldmVudC5jbGllbnRYIC0gY29tcC5zdHlsZS5sZWZ0IC0gY29tcC5zdHlsZS53aWR0aCAvIDI7CiAgICAgICAgbGV0IF95ID0gZXZlbnQuY2xpZW50WSAtIGNvbXAuc3R5bGUudG9wIC0gY29tcC5zdHlsZS5oZWlnaHQgLyAyOwogICAgICAgIGNvbXAuc3R5bGUucm90YXRlID0gdGhpcy5jYWxjQW5nbGVEZWdyZWVzKF94LCBfeSk7CiAgICB9LAogICAgLy8g57uE5Lu25Yig6ZmkCiAgICBkZWxDb21wKGluZGV4LCBzdGF0ZSkgewogICAgICBpZihzdGF0ZSA9PT0gJ211bHRpcGxlRGVsJykgewogICAgICAgIGxldCBsZW4gPSB0aGlzLmVkcmF3Q29tcG9uZW50cy5sZW5ndGg7CiAgICAgICAgdGhpcy5lU3RhdGVzLm11bHRpcGxlQWN0aXZlQXJyID0gW107CiAgICAgICAgZm9yKGxldCBpPWxlbjtpLS07aSA+MCkgewogICAgICAgICAgbGV0IG11bHRpcEJvb2wgPSB0aGlzLmVkcmF3Q29tcG9uZW50c1tpXS5tdWx0aXBsZUFjdGl2ZUJvb2w7CiAgICAgICAgICBpZihtdWx0aXBCb29sKSB7CiAgICAgICAgICAgIHRoaXMuZWRyYXdDb21wb25lbnRzLnNwbGljZShpLDEpCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGlmKHRoaXMuZVN0YXRlcy5jdXJyZW50QWN0aXZlSW5kZXggPiAtMSAmJnRoaXMuZWRyYXdDb21wb25lbnRzLmxlbmd0aCA+IDApIHsKICAgICAgICAgIHRoaXMuZWRyYXdDb21wb25lbnRzLnNwbGljZSh0aGlzLmVTdGF0ZXMuY3VycmVudEFjdGl2ZUluZGV4LDEpCiAgICAgICAgICB0aGlzLmVTdGF0ZXMuY3VycmVudEFjdGl2ZUluZGV4ID0gLTE7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgLy8g6ZSu55uY5LqL5Lu2CiAgICBrYXlkb3duRnVuKGV2ZW50KSB7CiAgICAgIGlmKGV2ZW50LmtleSA9PT0gJ2MnKSB7CiAgICAgICAgdGhpcy5lU3RhdGVzLmNvcHlCeUtleUJvb2wgPSB0cnVlOwogICAgICB9ZWxzZSBpZih0aGlzLmVTdGF0ZXMuY29weUJ5S2V5Qm9vbCAmJiBldmVudC5rZXkgPT09ICd2JykgewogICAgICAgIHRoaXMuY29weUN1cnJlbnRDb21wKCk7CiAgICAgIH1lbHNlIHsKICAgICAgICBpZihbJ0Fycm93VXAnLCdBcnJvd0Rvd24nLCdBcnJvd0xlZnQnLCJBcnJvd1JpZ2h0Il0uaW5kZXhPZihldmVudFsnY29kZSddKT4gLTEpIHsKICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICBpZih0aGlzLmVTdGF0ZXMuY3VycmVudEFjdGl2ZUluZGV4ID4gLTEgJiYgdGhpcy5lU3RhdGVzLm11bHRpcGxlQWN0aXZlQXJyLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICB0aGlzLmFycm93SXRlbShldmVudFsnY29kZSddLCB0aGlzLmVkcmF3Q29tcG9uZW50c1t0aGlzLmVTdGF0ZXMuY3VycmVudEFjdGl2ZUluZGV4XSkKICAgICAgICAgIH1lbHNlIGlmKHRoaXMuZVN0YXRlcy5tdWx0aXBsZUFjdGl2ZUFyci5sZW5ndGggPiAwKXsKICAgICAgICAgICAgbGV0IGxlbiA9IHRoaXMuZVN0YXRlcy5tdWx0aXBsZUFjdGl2ZUFyci5sZW5ndGg7CiAgICAgICAgICAgIGZvcihsZXQgaT0wO2k8bGVuO2krKyl7CiAgICAgICAgICAgICAgIHRoaXMuYXJyb3dJdGVtKGV2ZW50Wydjb2RlJ10sIHRoaXMuZVN0YXRlcy5tdWx0aXBsZUFjdGl2ZUFycltpXSkKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBpZihldmVudC5rZXkgPT09ICdEZWxldGUnIHx8IHRoaXMuaXNNYWMoKSAmJiBldmVudC5rZXkgPT09ICdCYWNrc3BhY2UnKSAgewogICAgICAgIHRoaXMuZGVsQ29tcCgpOwogICAgICB9CiAgICB9LAogICAgYXJyb3dJdGVtKGFycm93LCBvYmopIHsKICAgICAgaWYoYXJyb3cgJiYgb2JqKSB7CiAgICAgICAgc3dpdGNoIChhcnJvdykgewogICAgICAgICAgY2FzZSAnQXJyb3dVcCcgOgogICAgICAgICAgICBvYmouc3R5bGUudG9wID0gKG9iai5zdHlsZS50b3AgLSAxKSA+IDAgPyAoIG9iai5zdHlsZS50b3AgLSAxKSA6IDA7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAnQXJyb3dEb3duJyA6CiAgICAgICAgICAgIG9iai5zdHlsZS50b3AgPSBvYmouc3R5bGUudG9wICsgMTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICdBcnJvd0xlZnQnIDoKICAgICAgICAgICAgb2JqLnN0eWxlLmxlZnQgPSAob2JqLnN0eWxlLmxlZnQgLTEgKT4gMD8gKG9iai5zdHlsZS5sZWZ0IC0xKSA6IDA7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAnQXJyb3dSaWdodCc6CiAgICAgICAgICAgIG9iai5zdHlsZS5sZWZ0ID0gIG9iai5zdHlsZS5sZWZ0ICsxOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIC8vIOWkmumAieS6i+S7tgogICAgbW91c2Vkb3duRnVuKGV2ZW50KSB7CiAgICAgIGlmKCghZXZlbnQuY3RybEtleSB8fCAhZXZlbnQubWV0YUtleSAmJiB0aGlzLmlzTWFjKCkpICYmIGV2ZW50LmJ1dHRvbiA9PT0gMCAKICAgICAgICAmJiBldmVudC50YXJnZXQuaWQ9PT0nY2FudmFzJyAKICAgICAgICAmJiAhZXZlbnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnY29tcC1lbGVtZW50JykpIHsKICAgICAgICB0aGlzLmVTdGF0ZXMuY29weUJ5S2V5Qm9vbCA9IGZhbHNlOwogICAgICAgIHRoaXMuaW5pdENvbXBTdGF0ZSgpOwogICAgICB9IAogICAgfSwKICAgIC8vIOWIm+W7uuW9k+WJjee7hOS7tgogICAgY29weUN1cnJlbnRDb21wOmZ1bmN0aW9uKCkgewogICAgICBsZXQgX2N1cnJDb21wID0gdGhpcy5lZHJhd0NvbXBvbmVudHNbdGhpcy5lU3RhdGVzLmN1cnJlbnRBY3RpdmVJbmRleF07CiAgICAgIGlmKCFfY3VyckNvbXApIHJldHVybjsKICAgICAgX2N1cnJDb21wLmlzQWN0aXZlID0gZmFsc2U7CiAgICAgIGxldCBfY29weSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoX2N1cnJDb21wKSk7CiAgICAgIGxldCBfc3R5bGUgPSBfY3VyckNvbXAuc3R5bGU7CiAgICAgIGxldCBfaCA9IHRoaXMuY29uZmlncy5Jc29tZXRyaWNfY29sdSA+IDE/IHRoaXMuY29uZmlncy5Jc29tZXRyaWNfY29sdSA6IDE7CiAgICAgIF9jb3B5LnN0eWxlLnRvcCA9IF9zdHlsZS5oZWlnaHQgKyBfc3R5bGUudG9wICsgX2g7CiAgICAgIF9jb3B5LmlzQWN0aXZlID0gdHJ1ZTsKICAgICAgdGhpcy5lZHJhd0NvbXBvbmVudHMucHVzaChfY29weSk7CiAgICAgIHRoaXMuZVN0YXRlcy5jdXJyZW50QWN0aXZlSW5kZXggPSB0aGlzLmVkcmF3Q29tcG9uZW50cy5sZW5ndGggLSAxOyAvL+abtOaWsOa/gOa0u+e7hOS7tueahOS4i+aghwogICAgfSwKICAgIC8vIOWkmumAieaTjeS9nDrlj43pgIkv5riF56m65aSa6YCJL+WxnuaAp+W6lOeUqAogICAgc2V0TXVsdGlwbGVTdGF0ZTpmdW5jdGlvbihzdGF0ZSwgdmFsdWUpIHsKICAgICAgaWYoc3RhdGUgPT09ICdJc29tZXRyaWMnKSB7CiAgICAgICAgZm9yKGxldCBpID0gdGhpcy5lU3RhdGVzLm11bHRpcGxlQWN0aXZlQXJyLmxlbmd0aC0xO2k+PTA7aS0tKSB7CiAgICAgICAgICBsZXQgb2JqID0gdGhpcy5lU3RhdGVzLm11bHRpcGxlQWN0aXZlQXJyW2ldOwogICAgICAgICAgbGV0IGJvb2wgPSBvYmpbJ211bHRpcGxlQWN0aXZlQm9vbCddOwogICAgICAgICAgaWYoIWJvb2wpIHsKICAgICAgICAgICAgdGhpcy5lU3RhdGVzLm11bHRpcGxlQWN0aXZlQXJyLnNwbGljZShpLDEpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBsZXQgbGVuID0gdGhpcy5lU3RhdGVzLm11bHRpcGxlQWN0aXZlQXJyLmxlbmd0aDsKICAgICAgICBsZXQgdmFsID0gMDsKICAgICAgICBpZih2YWx1ZSA9PT0gJ3JvdycpIHsKICAgICAgICAgIHRoaXMuZVN0YXRlcy5tdWx0aXBsZUFjdGl2ZUFyciA9ICB0aGlzLmVTdGF0ZXMubXVsdGlwbGVBY3RpdmVBcnIuc29ydChmdW5jdGlvbihhLGIpewogICAgICAgICAgICByZXR1cm4gYS5zdHlsZS5sZWZ0IC0gYi5zdHlsZS5sZWZ0OwogICAgICAgICAgfSkKICAgICAgICAgIGZvcihsZXQgaT0wO2k8IGxlbjtpKyspIHsKICAgICAgICAgICAgbGV0IGl0ZW0gPSB0aGlzLmVTdGF0ZXMubXVsdGlwbGVBY3RpdmVBcnJbaV07CiAgICAgICAgICAgIGlmKGk+MCkgewogICAgICAgICAgICAgIGl0ZW0uc3R5bGUubGVmdCA9IHZhbDsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YWwgPSBpdGVtLnN0eWxlLmxlZnQgKyBpdGVtLnN0eWxlLndpZHRoICsgcGFyc2VJbnQodGhpcy5jb25maWdzLklzb21ldHJpY19yb3cpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLmVTdGF0ZXMubXVsdGlwbGVBY3RpdmVBcnIgPSAgdGhpcy5lU3RhdGVzLm11bHRpcGxlQWN0aXZlQXJyLnNvcnQoZnVuY3Rpb24oYSxiKXsKICAgICAgICAgICAgcmV0dXJuIGEuc3R5bGUudG9wIC0gYi5zdHlsZS50b3AgOwogICAgICAgICAgfSkKICAgICAgICAgIGZvcihsZXQgaT0wO2k8IGxlbjtpKyspIHsKICAgICAgICAgICAgbGV0IGl0ZW0gPSB0aGlzLmVTdGF0ZXMubXVsdGlwbGVBY3RpdmVBcnJbaV07CiAgICAgICAgICAgIGlmKGk+MCkgewogICAgICAgICAgICAgIGl0ZW0uc3R5bGUudG9wID0gdmFsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhbCA9IGl0ZW0uc3R5bGUuaGVpZ2h0ICsgaXRlbS5zdHlsZS50b3AgKyBwYXJzZUludCh0aGlzLmNvbmZpZ3MuSXNvbWV0cmljX2NvbHUpOwogICAgICAgICAgICBjb25zb2xlLmxvZyhpLCAgdGhpcy5jb25maWdzLklzb21ldHJpY19jb2x1LCB2YWwpCiAgICAgICAgICB9CiAgICAgICAgfSAgICAgCiAgICAgIH1lbHNlIGlmKHN0YXRlID09PSAncmVTZWwnKSB7CiAgICAgICAgbGV0IGxlbiA9IHRoaXMuZWRyYXdDb21wb25lbnRzLmxlbmd0aDsKICAgICAgICB0aGlzLmVTdGF0ZXMubXVsdGlwbGVBY3RpdmVBcnIgPSBbXTsKICAgICAgICBmb3IobGV0IGk9bGVuO2ktLTtpID4wKSB7CiAgICAgICAgICBsZXQgaXRlbSA9IHRoaXMuZWRyYXdDb21wb25lbnRzW2ldOwogICAgICAgICAgaWYoIWl0ZW0ubXVsdGlwbGVBY3RpdmVCb29sKSB7ICAKICAgICAgICAgICAgdGhpcy5lU3RhdGVzLm11bHRpcGxlQWN0aXZlQXJyLnB1c2goaXRlbSk7CiAgICAgICAgICB9CiAgICAgICAgICBpdGVtLm11bHRpcGxlQWN0aXZlQm9vbCA9ICFpdGVtLm11bHRpcGxlQWN0aXZlQm9vbDsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZihzdGF0ZSA9PT0gJ2NsZWFyJyl7CiAgICAgICAgbGV0IGxlbiA9IHRoaXMuZWRyYXdDb21wb25lbnRzLmxlbmd0aDsKICAgICAgICB0aGlzLmVTdGF0ZXMubXVsdGlwbGVBY3RpdmVBcnIgPSBbXTsKICAgICAgICBmb3IobGV0IGk9bGVuO2ktLTtpID4wKSB7CiAgICAgICAgICB0aGlzLmVkcmF3Q29tcG9uZW50c1tpXS5tdWx0aXBsZUFjdGl2ZUJvb2wgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH1lbHNlIGlmKFsnaXNBcHBseVNoYWRvdycsICdib3JkZXJSYWRpdXMnXS5pbmRleE9mKHN0YXRlKSA+IC0xKSB7CiAgICAgICAgbGV0IGxlbiA9IHRoaXMuZVN0YXRlcy5tdWx0aXBsZUFjdGl2ZUFyci5sZW5ndGg7CiAgICAgICAgZm9yKGxldCBpPWxlbjtpLS07aSA+MCkgewogICAgICAgICAgdGhpcy5lU3RhdGVzLm11bHRpcGxlQWN0aXZlQXJyW2ldLnN0eWxlW3N0YXRlXSA9IHZhbHVlOwogICAgICAgIH0KICAgICAgfWVsc2UgaWYoc3RhdGUgPT09ICdhbGlnbicpIHsKICAgICAgICBzd2l0Y2godmFsdWUpIHsKICAgICAgICAgIGNhc2UgJ3QnIDoKICAgICAgICAgICAgdGhpcy5tdWx0aXBBcnJheSgndG9wJyk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAnbCcgOgogICAgICAgICAgICB0aGlzLm11bHRpcEFycmF5KCdsZWZ0Jyk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAnYicgOgogICAgICAgICAgICB0aGlzLm11bHRpcEFycmF5KCdib3R0b20nKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICdyJyA6CiAgICAgICAgICAgIHRoaXMubXVsdGlwQXJyYXkoJ3JpZ2h0Jyk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgLy8g5Yig6Zmk5aSa6YCJ5YWD57SgCiAgICBkZWxNdWx0aXBDb21wKGNvbXAsIGluZGV4KSB7CiAgICAgIHRoaXMuZVN0YXRlcy5tdWx0aXBsZUFjdGl2ZUFyci5zcGxpY2UoaW5kZXgsIDEpOwogICAgICBsZXQgX2luZGV4ID0gdGhpcy5lZHJhd0NvbXBvbmVudHMuaW5kZXhPZihjb21wKTsKICAgICAgaWYoX2luZGV4ID4gLTEpIHsKICAgICAgICB0aGlzLmVkcmF3Q29tcG9uZW50c1tfaW5kZXhdLm11bHRpcGxlQWN0aXZlQm9vbCA9IGZhbHNlOwogICAgICB9CiAgICB9LAogICAgY2hhbmdlQ29uZmlnKHN0YXRlLCB2YWx1ZSl7CiAgICAgIGlmKCF0aGlzLmNvbmZpZ3Nbc3RhdGVdKSByZXR1cm47CiAgICAgIHRoaXMuY29uZmlnc1tzdGF0ZV0gPSB2YWx1ZTsKICAgIH0sCiAgICBtdWx0aXBBcnJheShwYXJhbSkgewogICAgICBsZXQgbGlzdCA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5lU3RhdGVzLm11bHRpcGxlQWN0aXZlQXJyKSk7CiAgICAgIGxpc3Quc29ydChmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgcmV0dXJuIFsndG9wJywgJ2xlZnQnXS5pbmRleE9mKHBhcmFtKSA+IC0xID8gYS5zdHlsZVtwYXJhbV0gLSBiLnN0eWxlW3BhcmFtXToKICAgICAgICAgIHBhcmFtID09PSAnYm90dG9tJyA/ICBiLnN0eWxlLnRvcCArIGIuc3R5bGUuaGVpZ2h0IC0gKGEuc3R5bGUudG9wICsgYS5zdHlsZS5oZWlnaHQpIDoKICAgICAgICAgIGIuc3R5bGUubGVmdCArIGIuc3R5bGUud2lkdGggLSAoYS5zdHlsZS5sZWZ0ICsgYS5zdHlsZS53aWR0aCkgCiAgICAgIH0pOwogICAgICBsZXQgbGVuID0gdGhpcy5lU3RhdGVzLm11bHRpcGxlQWN0aXZlQXJyLmxlbmd0aDsKICAgICAgbGV0IHJlc09iaiA9IGxpc3RbMF07CiAgICAgIGlmKFsndG9wJywgJ2xlZnQnXS5pbmRleE9mKHBhcmFtKSA+IC0xKSB7CiAgICAgICAgZm9yKGxldCBpPTA7aTxsZW47aSsrKSB7CiAgICAgICAgICB0aGlzLmVTdGF0ZXMubXVsdGlwbGVBY3RpdmVBcnJbaV0uc3R5bGVbcGFyYW1dID0gcmVzT2JqLnN0eWxlW3BhcmFtXTsKICAgICAgICB9CiAgICAgIH1lbHNlIGlmKHBhcmFtID09PSAnYm90dG9tJykgewogICAgICAgIGxldCBfYm90dG9tID0gcmVzT2JqLnN0eWxlLnRvcCArIHJlc09iai5zdHlsZS5oZWlnaHQ7CiAgICAgICAgZm9yKGxldCBpPTA7aTxsZW47aSsrKSB7CiAgICAgICAgICB0aGlzLmVTdGF0ZXMubXVsdGlwbGVBY3RpdmVBcnJbaV0uc3R5bGUudG9wID0gX2JvdHRvbSAtIHRoaXMuZVN0YXRlcy5tdWx0aXBsZUFjdGl2ZUFycltpXS5zdHlsZS5oZWlnaHQ7CiAgICAgICAgfQogICAgICB9ZWxzZSBpZihwYXJhbSA9PT0gJ3JpZ2h0JykgewogICAgICAgIGxldCBfcmlnaHQgPSByZXNPYmouc3R5bGUubGVmdCArIHJlc09iai5zdHlsZS53aWR0aDsKICAgICAgICBmb3IobGV0IGk9MDtpPGxlbjtpKyspIHsKICAgICAgICAgIHRoaXMuZVN0YXRlcy5tdWx0aXBsZUFjdGl2ZUFycltpXS5zdHlsZS5sZWZ0ID0gX3JpZ2h0IC0gdGhpcy5lU3RhdGVzLm11bHRpcGxlQWN0aXZlQXJyW2ldLnN0eWxlLndpZHRoOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGlzTWFjOmZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gL21hY2ludG9zaHxtYWMgb3MgeC9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkKICAgIH0sCiAgICBjYWxjQW5nbGVEZWdyZWVzKHgsIHkpIHsKICAgICAgbGV0IHZhbCA9ICBNYXRoLmF0YW4yKHksIHgpICogMTgwIC8gTWF0aC5QSTsKICAgICAgcmV0dXJuIE1hdGguY2VpbCh2YWwpOwogICAgfSwKICAgIHNjcmVlbjpmdW5jdGlvbigpIHsKICAgICAgdGhpcy5jb25maWdzLmJnQWxsQm9vbCA9ICF0aGlzLmNvbmZpZ3MuYmdBbGxCb29sOwogICAgICBpZih0aGlzLmNvbmZpZ3MuYmdBbGxCb29sKSB7CiAgICAgICAgdGhpcy5jb25maWdzLndpbmRvd193ID0gd2luZG93LnNjcmVlbi53aWR0aCA+IDE1MDAgPyB3aW5kb3cuc2NyZWVuLndpZHRoIDogMTUwMDsKICAgICAgICB0aGlzLmNvbmZpZ3Mud2luZG93X2ggPSB3aW5kb3cuc2NyZWVuLmhlaWdodCA+IDgwMCA/IHdpbmRvdy5zY3JlZW4uaGVpZ2h0IDogODAwOwogICAgICAgIHRoaXMuY29uZmlncy5zY2FsZSA9IDE7CiAgICAgIH0KICAgIH0sCiAgICBpbml0U3RvcmFnZURhdGEoY2xlYXJCb29sKSB7CiAgICAgIGlmKCFjbGVhckJvb2wgJiYgd2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtKCdibV9kYXRhcycpKSByZXR1cm47CiAgICAgIGxldCBwYXJhbXMgPSB7CiAgICAgICAgICBzYXZlX2RhdGFfYXV0bzpbXSwKICAgICAgICAgIHNhdmVfZGF0YV9jdXN0b206W10KICAgICAgfQogICAgICB3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2JtX2RhdGFzJywgSlNPTi5zdHJpbmdpZnkocGFyYW1zKSkKICAgIH0sCiAgICBzYXZlRGF0ZVRvU3RvcmFnZShkYXRhLCBzdGF0ZSkgewogICAgICBsZXQgc2F2ZURhdGEgPSBkYXRhIHx8IHRoaXMuZWRyYXdDb21wb25lbnRzOwoKICAgICAgLy/lrZjlgqjkvJjljJbvvIzmsqHmnInlhoXlrrnnmoTpobXpnaLkuI3pnIDopoHlrZjlgqgKICAgICAgaWYoIXNhdmVEYXRhIHx8IEFycmF5LmlzQXJyYXkoc2F2ZURhdGEpICYmIHNhdmVEYXRhLmxlbmd0aCA9PT0gMCkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBsZXQgb2JqID0gewogICAgICAgIGRhdGE6IHNhdmVEYXRhLAogICAgICAgIHR5cGU6IHN0YXRlIHx8ICdhdXRvJywKICAgICAgICB1cGRhdGVUaW1lOm5ldyBEYXRlKCkKICAgICAgfTsKICAgICAgaWYoIXdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnYm1fZGF0YXMnKSkgewogICAgICAgIHRoaXMuaW5pdFN0b3JhZ2VEYXRhKCk7CiAgICAgIH0KICAgICAgbGV0IHBhcmFtcyA9IHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnYm1fZGF0YXMnKTsKICAgICAgaWYocGFyYW1zICYmIHR5cGVvZiBwYXJhbXMgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgcGFyYW1zID0gSlNPTi5wYXJzZShwYXJhbXMpCiAgICAgIH0KICAgICAgaWYoc3RhdGUgPT09ICdjdXN0b20nKSB7CiAgICAgICAgcGFyYW1zLnNhdmVfZGF0YV9jdXN0b20udW5zaGlmdChvYmopOwogICAgICAgIGlmKHBhcmFtcy5zYXZlX2RhdGFfY3VzdG9tLmxlbmd0aCA+IDUwKSB7CiAgICAgICAgICBwYXJhbXMuc2F2ZV9kYXRhX2N1c3RvbSA9IHBhcmFtcy5zYXZlX2RhdGFfY3VzdG9tLnNsaWNlKDAsIDUwKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcGFyYW1zLnNhdmVfZGF0YV9hdXRvLnVuc2hpZnQob2JqKTsKICAgICAgICBpZihwYXJhbXMuc2F2ZV9kYXRhX2F1dG8ubGVuZ3RoID4gNTApIHsKICAgICAgICAgIHBhcmFtcy5zYXZlX2RhdGFfYXV0byA9IHBhcmFtcy5zYXZlX2RhdGFfYXV0by5zbGljZSgwLCA1MCk7CiAgICAgICAgfQogICAgICB9CgogICAgICB3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2JtX2RhdGFzJywgSlNPTi5zdHJpbmdpZnkocGFyYW1zKSk7CiAgICB9LAogICAgZ2V0U3RvcmFnZURhdGEoKSB7CiAgICAgIHRoaXMuYWN0aXZlSGlzdG9yeUJvb2wgPSAhdGhpcy5hY3RpdmVIaXN0b3J5Qm9vbDsKICAgICAgdGhpcy5jdXJyZW50SGlzdG9yeUluZGV4ID0gLTE7CiAgICAgIGxldCBwYXJhbXMgPSB3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2JtX2RhdGFzJyk7CiAgICAgIGlmKHBhcmFtcyAmJiB0eXBlb2YgcGFyYW1zID09PSAnc3RyaW5nJykgewogICAgICAgIHBhcmFtcyA9IEpTT04ucGFyc2UocGFyYW1zKQogICAgICB9CiAgICAgIHRoaXMuaGlzdG9yeUN1cnJuZXREYXRhID0gW10uY29uY2F0KHBhcmFtcy5zYXZlX2RhdGFfY3VzdG9tLCBwYXJhbXMuc2F2ZV9kYXRhX2F1dG8pOwogICAgfSwKICAgIGNoYW5nZUJnSW1nKHVybCkgewogICAgICB0aGlzLmNvbmZpZ3MuYmFja2dyb3VuZFVybCA9IHVybDsKICAgIH0sCiAgICBjbGVhclN0b3JhZ2VEYXRhKCkgewogICAgICB0aGlzLmluaXRTdG9yYWdlRGF0YSh0cnVlKTsKICAgIH0sCiAgICBpbml0SGlzdG9yeUxpc3RTdGF0ZShpbmRleCkgewogICAgICB0aGlzLmN1cnJlbnRIaXN0b3J5SW5kZXggPSBpbmRleCA+IC0xID8gaW5kZXggOiAtMTsKICAgICAgaWYoQXJyYXkuaXNBcnJheSh0aGlzLmhpc3RvcnlDdXJybmV0RGF0YSkpIHsKICAgICAgICBsZXQgbGVuID0gdGhpcy5oaXN0b3J5Q3Vycm5ldERhdGEubGVuZ3RoOwogICAgICAgIGZvcihsZXQgaT0wO2k8bGVuO2krKykgewogICAgICAgICAgdGhpcy5oaXN0b3J5Q3Vycm5ldERhdGFbaV0uaXNBY3RpdmUgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBhcHBseUhpc3RvcnkobGlzdCkgewogICAgICB0aGlzLnNhdmVEYXRlVG9TdG9yYWdlKCkKICAgICAgdGhpcy5lZHJhd0NvbXBvbmVudHMgPSBsaXN0OwogICAgICB0aGlzLmluaXRDb21wU3RhdGUoKTsKICAgICAgdGhpcy5jbG9zZUhpc3RvcnkoKTsKICAgIH0sCiAgICBjbG9zZUhpc3RvcnkoKSB7CiAgICAgIHRoaXMuYWN0aXZlSGlzdG9yeUJvb2wgPSBmYWxzZTsKICAgIH0KICB9Cn0K"},{"version":3,"sources":["editor.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkDA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"editor.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div id=\"editor\">\n    <!-- 组件库 -->\n    <editor-comps \n      v-bind:elements=\"edrawComponents\"\n      v-on:initCompsState=\"initComponentState\" \n      v-on:selectComp=\"selectComp\"></editor-comps>\n    \n    <!-- 画布 -->\n    <editor-canvas \n\n      v-bind:configs=\"configs\"\n      v-bind:edrawComps=\"edrawComponents\"\n      v-bind:currentActiveIndex=\"eStates.currentActiveIndex\"\n      v-bind:multipleActiveBool=\"eStates.multipleActiveBool\"\n      v-on:initCompsState=\"initComponentState\" \n      v-on:dragComp=\"dragCurrentComp\"\n      v-on:resizeByDragComp=\"resizeByDragComp\"\n      v-on:trans=\"transComp\"\n      v-on:screen=\"screen\"></editor-canvas>\n\n    <!-- 组件设置 -->\n    <editor-settings\n      v-bind:currentActiveIndex=\"eStates.currentActiveIndex\"\n      v-bind:currentElement=\"edrawComponents[eStates.currentActiveIndex]\"\n      v-bind:multipleActiveArr=\"eStates.multipleActiveArr\"\n      v-bind:configs=\"configs\"\n      v-on:delComp=\"delComp\"\n      v-on:delMultipComp=\"delMultipComp\"\n      v-on:setMultipleState=\"setMultipleState\"\n      v-on:changeConfig=\"changeConfig\"\n      v-on:download=\"download\"\n      v-on:screen=\"screen\"\n      v-on:saveDateToStorage=\"saveDateToStorage\"\n      v-on:getHistory=\"getStorageData\"\n      v-on:changeBgImg=\"changeBgImg\"></editor-settings>\n    \n    <editor-history\n      v-if=\"activeHistoryBool\"\n      v-bind:list=\"historyCurrnetData\"\n      v-bind:currentIndex=\"currentHistoryIndex\"\n      v-on:initState=\"initHistoryListState\"\n      v-on:applyHistory=\"applyHistory\"\n      v-on:closeHistory=\"closeHistory\"></editor-history>\n    <!-- 帮助 -->\n    <editor-help/>\n  </div>\n</template>\n\n<script>\nimport EditorComps from './editor-comps';\nimport EditorCanvas from './editor-canvas';\nimport EditorSettings from './editor-settings';\nimport EditorHelp from './editor-help';\nimport EditorHistory from './editor-history';\n\nexport default {\n  name: 'Editor',\n  created:function() {\n    this.initStorageData();\n    this.initBindingEvent();\n  },\n  data(){\n     return {\n        eStates:{\n          currentActiveIndex:-1,\n          copyByKeyBool:false,\n          multipleActiveArr:[],\n        },\n        edrawComponents:[],\n        configs:{\n          bg:\"grid\",\n          pageName:'底图',\n          spacing:10,\n          scale:1,\n          Isometric_row:10,\n          Isometric_colu:10,\n          dowloadImgType:'png',\n          bgAllBool:false,\n          window_w:1920,\n          window_h:900,\n          backgroundUrl:\"\"\n        },\n        historyCurrnetData:[],\n        currentHistoryIndex:-1,\n        activeHistoryBool:false\n     }\n  },\n  components: {\n    'editor-comps':EditorComps,\n    'editor-canvas':EditorCanvas,\n    'editor-settings':EditorSettings,\n    'editor-help':EditorHelp,\n    'editor-history':EditorHistory\n  },\n  methods: {\n    initData() {\n      this.activeHistoryBool = false;\n    },\n    initBindingEvent() {\n      document.addEventListener('keydown', this.kaydownFun, false);\n      document.addEventListener('mousedown', this.mousedownFun);\n      window.addEventListener('beforeunload', this.leaving);\n    },\n    leaving(event) {\n      this.saveDateToStorage();\n      console.log(event.returnValue)\n      // let message = \"内容更改，注意截图缓存\"; \n      // event.returnValue = message;\n      // return message;\n    },\n    download:function() {\n      //TODO:页面下载\n    },\n    saveAs:function(img) {\n      let _dom = window.document.createElement('a');\n        _dom.href = img\n        _dom.dataset.downloadurl = ['image/png', 'IMG_DOWNLOAD_NAME', _dom.href].join(':');\n        document.body.appendChild(_dom);\n        _dom.click();\n        document.body.removeChild(_dom);\n    },\n    // 组件选择\n    selectComp(event, comp) {\n      let item = JSON.parse(JSON.stringify(comp));\n      if(!item) return;\n      this.initCompState();\n      item.isActive = true;\n      item.multipleActiveBool=false;\n      let {width, height, borderRadius, rotate, borderWidth, background} = item.defStyle;\n      let {clientX , clientY} = event;\n      let _style = {\n          width:width || 100,\n          height:height || 100,\n          top: clientY || 100,\n          left:clientX || 100,\n          rotate: rotate || 0,\n          drag_start_x: 0, //拖拽相对\n          drag_start_y :0,\n          borderWidth:borderWidth || 0,\n          background:background,\n          position:'absolute',\n          isApplyShadow:'true',\n          isFixed:\"false\",\n          borderRadius:borderRadius || 0\n      }\n      item.style = _style;\n      this.edrawComponents.push(item);\n      this.eStates.currentActiveIndex = this.edrawComponents.length -1;\n    },\n    initComponentState(current, event) {\n      if(current === undefined || current === null || current === -1) return;\n      if(event && (event.ctrlKey || event.metaKey && this.isMac()) && event.button === 0 ) {\n        this.edrawComponents[current].isActive = false;\n        if(this.eStates.currentActiveIndex > -1) {\n          this.eStates.currentActiveIndex = -1;\n        }\n\n        // 多选操作缓存数组\n        const _multipActiveIndex = this.eStates.multipleActiveArr.indexOf(this.edrawComponents[current]);\n        if( _multipActiveIndex === -1) {\n          this.eStates.multipleActiveArr.push(this.edrawComponents[current])\n        }\n\n        if(this.edrawComponents[current].multipleActiveBool) {\n          this.edrawComponents[current].multipleActiveBool = false;\n          this.eStates.multipleActiveArr.splice(_multipActiveIndex, 1);\n        } else {\n          this.edrawComponents[current].multipleActiveBool = true;\n        }\n      }else {\n        this.initCompState();     \n        this.eStates.currentActiveIndex = current;\n        this.edrawComponents[current].isActive = true;\n      }\n\n    },\n    // 初始化画布内组件状态\n    initCompState() {\n      let len = this.edrawComponents.length;\n      this.eStates.multipleActiveArr = [];\n      for(let i=0;i<len;i++) {\n        this.edrawComponents[i].isActive = false;\n        this.edrawComponents[i].multipleActiveBool = false;\n      }\n      this.eStates.copyByKeyBool = false;\n    },\n    // 组件拖拽：ctrlkey === true 处理多选\n    dragCurrentComp(event, comp, state, currentIndex, canvesRect) {\n      if(event && (event.ctrlKey || event.metaKey && this.isMac())  ){\n        console.log('多选处理')\n      } else {\n        this.eStates.copyByKeyBool = false;\n        if(state === 'start') {\n          this.eStates.currentActiveIndex = currentIndex;\n          comp.style.drag_start_x = event.clientX - comp.style.left;\n          comp.style.drag_start_y = event.clientY - comp.style.top;\n        }else if(state === 'drag'){\n          let _left = event.clientX - comp.style.drag_start_x; \n          let _top = event.clientY - comp.style.drag_start_y;\n          if(_left <0 || _top < 0) return;\n          let left = (_left - canvesRect.x) >= 0 ? _left : canvesRect.x; // 处理left编辑问题\n          let top = (_top - canvesRect.y) >= 0 ? _top : canvesRect.y; // 处理top边界问题\n          comp.style.left = left;\n          comp.style.top = top;\n        }\n      }\n    },\n    resizeByDragComp(event, comp, state, arrow,currentIndex) {\n      if(event && (event.ctrlKey || event.metaKey && this.isMac())  ){\n        console.log('多选处理')\n      } else {\n        this.eStates.copyByKeyBool = false;\n        if(state === 'start') {\n          this.eStates.currentActiveIndex = currentIndex;\n          comp.style.drag_start_x = arrow === 'r' ? comp.style.left :\n                                    arrow === 'l' ?comp.style.left + comp.style.width :\n                                    10;\n          comp.style.drag_start_y = arrow === 'b' ? comp.style.top :\n                                    arrow === 't' ?comp.style.top + comp.style.height :\n                                    10;\n        }else if(state === 'drag'){\n          let _width = 0;\n          let _top = 0;\n          let _height = 0;\n          switch(arrow) {\n            case 'r':\n              _width = event.clientX - comp.style.drag_start_x; \n              comp.style.width = _width >= 10 ? _width: 10;\n              break;\n            case 'l':\n              comp.style.left = event.clientX;\n              _width = comp.style.drag_start_x - event.clientX ; \n              comp.style.width = _width >= 10 ? _width: 10;\n              break;\n            case 't':\n              comp.style.top = event.clientY;\n              _height = comp.style.drag_start_y - event.clientY;\n              comp.style.height = _height >= 10 ? _height : 10;\n              break;\n            case 'b':\n              _top = event.clientY - comp.style.drag_start_y;\n              comp.style.height = _top >= 10 ? _top: 10;\n              break;\n            default:\n              break\n          }\n\n        }else {\n          let _width = 0;\n          let _top = 0;\n          let _height = 0;\n          switch(arrow) {\n            case 'r':\n              _width = event.clientX - comp.style.drag_start_x; \n              comp.style.width = _width > 10 ? _width: 10;\n              break;\n            case 'l':\n              comp.style.left = event.clientX;\n              _width = comp.style.drag_start_x - event.clientX ; \n              comp.style.width = _width >= 10 ? _width: 10;\n              break;\n            case 't':\n              comp.style.top = event.clientY;\n              _height = comp.style.drag_start_y - event.clientY;\n              comp.style.height = _height >= 10 ? _height : 10;\n              break;\n            case 'b':\n               _top = event.clientY - comp.style.drag_start_y;\n              comp.style.height = _top >= 10 ? _top: 10;\n              break;\n            default:\n              break\n          }\n        }\n      }\n    },\n    transComp(event, comp){\n        let _x = event.clientX - comp.style.left - comp.style.width / 2;\n        let _y = event.clientY - comp.style.top - comp.style.height / 2;\n        comp.style.rotate = this.calcAngleDegrees(_x, _y);\n    },\n    // 组件删除\n    delComp(index, state) {\n      if(state === 'multipleDel') {\n        let len = this.edrawComponents.length;\n        this.eStates.multipleActiveArr = [];\n        for(let i=len;i--;i >0) {\n          let multipBool = this.edrawComponents[i].multipleActiveBool;\n          if(multipBool) {\n            this.edrawComponents.splice(i,1)\n          }\n        }\n      } else {\n        if(this.eStates.currentActiveIndex > -1 &&this.edrawComponents.length > 0) {\n          this.edrawComponents.splice(this.eStates.currentActiveIndex,1)\n          this.eStates.currentActiveIndex = -1;\n        }\n      }\n    },\n    // 键盘事件\n    kaydownFun(event) {\n      if(event.key === 'c') {\n        this.eStates.copyByKeyBool = true;\n      }else if(this.eStates.copyByKeyBool && event.key === 'v') {\n        this.copyCurrentComp();\n      }else {\n        if(['ArrowUp','ArrowDown','ArrowLeft',\"ArrowRight\"].indexOf(event['code'])> -1) {\n          event.preventDefault();\n          if(this.eStates.currentActiveIndex > -1 && this.eStates.multipleActiveArr.length === 0) {\n            this.arrowItem(event['code'], this.edrawComponents[this.eStates.currentActiveIndex])\n          }else if(this.eStates.multipleActiveArr.length > 0){\n            let len = this.eStates.multipleActiveArr.length;\n            for(let i=0;i<len;i++){\n               this.arrowItem(event['code'], this.eStates.multipleActiveArr[i])\n            }\n          }\n        }\n      }\n      if(event.key === 'Delete' || this.isMac() && event.key === 'Backspace')  {\n        this.delComp();\n      }\n    },\n    arrowItem(arrow, obj) {\n      if(arrow && obj) {\n        switch (arrow) {\n          case 'ArrowUp' :\n            obj.style.top = (obj.style.top - 1) > 0 ? ( obj.style.top - 1) : 0;\n            break;\n          case 'ArrowDown' :\n            obj.style.top = obj.style.top + 1;\n            break;\n          case 'ArrowLeft' :\n            obj.style.left = (obj.style.left -1 )> 0? (obj.style.left -1) : 0;\n            break;\n          case 'ArrowRight':\n            obj.style.left =  obj.style.left +1;\n            break;\n          default:\n            break;\n        }\n      }\n    },\n    // 多选事件\n    mousedownFun(event) {\n      if((!event.ctrlKey || !event.metaKey && this.isMac()) && event.button === 0 \n        && event.target.id==='canvas' \n        && !event.target.classList.contains('comp-element')) {\n        this.eStates.copyByKeyBool = false;\n        this.initCompState();\n      } \n    },\n    // 创建当前组件\n    copyCurrentComp:function() {\n      let _currComp = this.edrawComponents[this.eStates.currentActiveIndex];\n      if(!_currComp) return;\n      _currComp.isActive = false;\n      let _copy = JSON.parse(JSON.stringify(_currComp));\n      let _style = _currComp.style;\n      let _h = this.configs.Isometric_colu > 1? this.configs.Isometric_colu : 1;\n      _copy.style.top = _style.height + _style.top + _h;\n      _copy.isActive = true;\n      this.edrawComponents.push(_copy);\n      this.eStates.currentActiveIndex = this.edrawComponents.length - 1; //更新激活组件的下标\n    },\n    // 多选操作:反选/清空多选/属性应用\n    setMultipleState:function(state, value) {\n      if(state === 'Isometric') {\n        for(let i = this.eStates.multipleActiveArr.length-1;i>=0;i--) {\n          let obj = this.eStates.multipleActiveArr[i];\n          let bool = obj['multipleActiveBool'];\n          if(!bool) {\n            this.eStates.multipleActiveArr.splice(i,1);\n          }\n        }\n        let len = this.eStates.multipleActiveArr.length;\n        let val = 0;\n        if(value === 'row') {\n          this.eStates.multipleActiveArr =  this.eStates.multipleActiveArr.sort(function(a,b){\n            return a.style.left - b.style.left;\n          })\n          for(let i=0;i< len;i++) {\n            let item = this.eStates.multipleActiveArr[i];\n            if(i>0) {\n              item.style.left = val;\n            }\n            val = item.style.left + item.style.width + parseInt(this.configs.Isometric_row);\n          }\n        } else {\n          this.eStates.multipleActiveArr =  this.eStates.multipleActiveArr.sort(function(a,b){\n            return a.style.top - b.style.top ;\n          })\n          for(let i=0;i< len;i++) {\n            let item = this.eStates.multipleActiveArr[i];\n            if(i>0) {\n              item.style.top = val;\n            }\n            val = item.style.height + item.style.top + parseInt(this.configs.Isometric_colu);\n            console.log(i,  this.configs.Isometric_colu, val)\n          }\n        }     \n      }else if(state === 'reSel') {\n        let len = this.edrawComponents.length;\n        this.eStates.multipleActiveArr = [];\n        for(let i=len;i--;i >0) {\n          let item = this.edrawComponents[i];\n          if(!item.multipleActiveBool) {  \n            this.eStates.multipleActiveArr.push(item);\n          }\n          item.multipleActiveBool = !item.multipleActiveBool;\n        }\n      } else if(state === 'clear'){\n        let len = this.edrawComponents.length;\n        this.eStates.multipleActiveArr = [];\n        for(let i=len;i--;i >0) {\n          this.edrawComponents[i].multipleActiveBool = false;\n        }\n      }else if(['isApplyShadow', 'borderRadius'].indexOf(state) > -1) {\n        let len = this.eStates.multipleActiveArr.length;\n        for(let i=len;i--;i >0) {\n          this.eStates.multipleActiveArr[i].style[state] = value;\n        }\n      }else if(state === 'align') {\n        switch(value) {\n          case 't' :\n            this.multipArray('top');\n            break;\n          case 'l' :\n            this.multipArray('left');\n            break;\n          case 'b' :\n            this.multipArray('bottom');\n            break;\n          case 'r' :\n            this.multipArray('right');\n            break;\n          default:\n            break;\n        }\n      }\n    },\n    // 删除多选元素\n    delMultipComp(comp, index) {\n      this.eStates.multipleActiveArr.splice(index, 1);\n      let _index = this.edrawComponents.indexOf(comp);\n      if(_index > -1) {\n        this.edrawComponents[_index].multipleActiveBool = false;\n      }\n    },\n    changeConfig(state, value){\n      if(!this.configs[state]) return;\n      this.configs[state] = value;\n    },\n    multipArray(param) {\n      let list = JSON.parse(JSON.stringify(this.eStates.multipleActiveArr));\n      list.sort(function(a, b) {\n        return ['top', 'left'].indexOf(param) > -1 ? a.style[param] - b.style[param]:\n          param === 'bottom' ?  b.style.top + b.style.height - (a.style.top + a.style.height) :\n          b.style.left + b.style.width - (a.style.left + a.style.width) \n      });\n      let len = this.eStates.multipleActiveArr.length;\n      let resObj = list[0];\n      if(['top', 'left'].indexOf(param) > -1) {\n        for(let i=0;i<len;i++) {\n          this.eStates.multipleActiveArr[i].style[param] = resObj.style[param];\n        }\n      }else if(param === 'bottom') {\n        let _bottom = resObj.style.top + resObj.style.height;\n        for(let i=0;i<len;i++) {\n          this.eStates.multipleActiveArr[i].style.top = _bottom - this.eStates.multipleActiveArr[i].style.height;\n        }\n      }else if(param === 'right') {\n        let _right = resObj.style.left + resObj.style.width;\n        for(let i=0;i<len;i++) {\n          this.eStates.multipleActiveArr[i].style.left = _right - this.eStates.multipleActiveArr[i].style.width;\n        }\n      }\n    },\n    isMac:function() {\n      return /macintosh|mac os x/i.test(navigator.userAgent)\n    },\n    calcAngleDegrees(x, y) {\n      let val =  Math.atan2(y, x) * 180 / Math.PI;\n      return Math.ceil(val);\n    },\n    screen:function() {\n      this.configs.bgAllBool = !this.configs.bgAllBool;\n      if(this.configs.bgAllBool) {\n        this.configs.window_w = window.screen.width > 1500 ? window.screen.width : 1500;\n        this.configs.window_h = window.screen.height > 800 ? window.screen.height : 800;\n        this.configs.scale = 1;\n      }\n    },\n    initStorageData(clearBool) {\n      if(!clearBool && window.localStorage.getItem('bm_datas')) return;\n      let params = {\n          save_data_auto:[],\n          save_data_custom:[]\n      }\n      window.localStorage.setItem('bm_datas', JSON.stringify(params))\n    },\n    saveDateToStorage(data, state) {\n      let saveData = data || this.edrawComponents;\n\n      //存储优化，没有内容的页面不需要存储\n      if(!saveData || Array.isArray(saveData) && saveData.length === 0) {\n        return;\n      }\n      let obj = {\n        data: saveData,\n        type: state || 'auto',\n        updateTime:new Date()\n      };\n      if(!window.localStorage.getItem('bm_datas')) {\n        this.initStorageData();\n      }\n      let params = window.localStorage.getItem('bm_datas');\n      if(params && typeof params === 'string') {\n        params = JSON.parse(params)\n      }\n      if(state === 'custom') {\n        params.save_data_custom.unshift(obj);\n        if(params.save_data_custom.length > 50) {\n          params.save_data_custom = params.save_data_custom.slice(0, 50);\n        }\n      } else {\n        params.save_data_auto.unshift(obj);\n        if(params.save_data_auto.length > 50) {\n          params.save_data_auto = params.save_data_auto.slice(0, 50);\n        }\n      }\n\n      window.localStorage.setItem('bm_datas', JSON.stringify(params));\n    },\n    getStorageData() {\n      this.activeHistoryBool = !this.activeHistoryBool;\n      this.currentHistoryIndex = -1;\n      let params = window.localStorage.getItem('bm_datas');\n      if(params && typeof params === 'string') {\n        params = JSON.parse(params)\n      }\n      this.historyCurrnetData = [].concat(params.save_data_custom, params.save_data_auto);\n    },\n    changeBgImg(url) {\n      this.configs.backgroundUrl = url;\n    },\n    clearStorageData() {\n      this.initStorageData(true);\n    },\n    initHistoryListState(index) {\n      this.currentHistoryIndex = index > -1 ? index : -1;\n      if(Array.isArray(this.historyCurrnetData)) {\n        let len = this.historyCurrnetData.length;\n        for(let i=0;i<len;i++) {\n          this.historyCurrnetData[i].isActive = false;\n        }\n      }\n    },\n    applyHistory(list) {\n      this.saveDateToStorage()\n      this.edrawComponents = list;\n      this.initCompState();\n      this.closeHistory();\n    },\n    closeHistory() {\n      this.activeHistoryBool = false;\n    }\n  }\n}\n</script>\n\n<style>\n\n#editor {\n  margin-top: 60px;\n  padding: 0;\n  position: relative;\n  color: #2c3e50;\n  display: grid;\n  grid-template-columns: 205px auto 205px;\n}\n</style>\n"]}]}